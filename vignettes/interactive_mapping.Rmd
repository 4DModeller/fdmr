---
title: "Plotting interactive maps"
output: html_notebook
---
4DModeller provides some simple map plotting functions that help you create maps from many different types of data.

In this tutorial we'll create plot our data using an interactive RShiny app. This lets us explore different layers of our data and have dynamic control over how it looks.

First we need to retrieve one of our tutorial datasets. This dataset contains data about rainfall near the [Kvilldal](https://www.statkraft.com/about-statkraft/where-we-operate/norway/kvilldal-hydropower-plant/) hydroelectric power plant in Southern Norway.

```{r}
fdmr::retrieve_tutorial_data(dataset = "hydro")
```

We want to create a plot on the map covering the rain catchment area around the power plant. To do this we read in a GeoJSON file containing the coordinates of the catchment area and make sure it's in the correct coordinate reference system to plot on our map.

```{r}
norway_polygon_location <- fdmr::get_tutorial_datapath(filename="Kvilldal_Catch_Boundary.geojson")
norway_polygon <- rgdal::readOGR(norway_polygon_location)
norway_polygon <- sf::st_as_sf(norway_polygon,
    coords = c("longitude", "latitude"),
    crs = "+proj=utm +zone=32"
)

norway_polygon <- sf::st_transform(norway_polygon, crs = "+proj=longlat +datum=WGS84")
```

Next we read ECMWF Reanalysis v5 (ERA5) precipitation data from a NetCDF file.

```{r}
era5_data_filepath <- fdmr::get_tutorial_datapath(filename="era5_land_daily.nc")
era5_precip <- raster::stack(era5_data_filepath)
era5_precip <- raster::projectRaster(era5_precip, crs = "+proj=utm +zone=32")
```

The data is now ready to pass to our interactive plotting function.

```{r}
fdmr::plot_interactive_map(raster_data = era5_precip, polygon_data = norway_polygon)
```



