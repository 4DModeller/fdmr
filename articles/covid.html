<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="fdmr">
<title>COVID-19 • fdmr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="COVID-19">
<meta property="og:description" content="fdmr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">fdmr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/FourDModelleR.html">Getting started</a>
    <a class="dropdown-item" href="../articles/covid.html">COVID-19</a>
    <a class="dropdown-item" href="../articles/hydro.html">Hydrology</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/GlobalMass/processing/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">


<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>COVID-19</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/GlobalMass/processing/blob/HEAD/vignettes/covid.Rmd" class="external-link"><code>vignettes/covid.Rmd</code></a></small>
      <div class="d-none name"><code>covid.Rmd</code></div>
    </div>

    
    
<div class="section level2" number="1">
<h2 id="modelling-covid-19-infection-across-england">
<span class="header-section-number">1</span> Modelling COVID-19 infection across England<a class="anchor" aria-label="anchor" href="#modelling-covid-19-infection-across-england"></a>
</h2>
<p>In this tutorial we’ll cover some of the work we did as part of our study into fitting a Bayesian spatio-temporal model to predict the COVID-19 infection rate across England.</p>
<p>We’ll cover …</p>
</div>
<div class="section level2" number="2">
<h2 id="study-aim-and-data-description">
<span class="header-section-number">2</span> Study aim and data description<a class="anchor" aria-label="anchor" href="#study-aim-and-data-description"></a>
</h2>
<p>The COVID-19 pandemic has had a profound impact on global health and economies, with the spread and evolution of the virus becoming a major concern for health authorities and policymakers. In this study, we aim to investigate the spread and evolution of COVID-19 occurrences across England. The aim of the study is two-fold: on the one hand, fitting a Bayesian spatio-temporal model to predict the COVID-19 infection rate across mainland England over space and time; on the other hand, investigating the impacts of socioeconomic, demographic and environmental factors on COVID-19 infection.</p>
<p>The first thing is to load all the packages used in the COVID-19 case study.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/spdep/" class="external-link">spdep</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://rgdal.r-forge.r-project.org" class="external-link">rgdal</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">gridExtra</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">INLA</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.inlabru.org" class="external-link">inlabru</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/raster" class="external-link">raster</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/leaflet/" class="external-link">leaflet</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://scales.r-lib.org" class="external-link">scales</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/GlobalMass/processing" class="external-link">fdmr</a></span><span class="op">)</span></span></code></pre></div>
<p>The study region is mainland England, which is partitioned into 6789 neighbourhoods at the Middle Layer Super Output Area (MSOA) scale. The shapefile of the study region <code>shape</code> is a <code>SpatialPolygonsDataFrame</code>, which is used to map the data. It stores the location, shape and attributes of geographic features for the neighbourhoods.</p>
<p>We first need to retrieve the data from the fdmr example data store and unpack it and we’ll use <code>retrieve_tutorial_data</code> to do this.</p>
<blockquote>
<p><strong><em>NOTE:</em></strong> Download the tar file from the URL I sent and pass the path to this file to the function. This process will be streamlined once we know what we can host publicly.</p>
</blockquote>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tarpath</span> <span class="op">&lt;-</span> <span class="st">"/example/path/covid19_example.tar.bz2"</span></span>
<span><span class="fu">fdmr</span><span class="fu">::</span><span class="fu">retrieve_tutorial_data</span><span class="op">(</span>tarball_path <span class="op">=</span> <span class="va">tarpath</span><span class="op">)</span></span></code></pre></div>
<p>Next we’ll use the <code>load_tutorial_data</code> function to load in the spatial data we want.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sp_data</span> <span class="op">&lt;-</span> <span class="fu">fdmr</span><span class="fu">::</span><span class="fu">load_tutorial_data</span><span class="op">(</span>filename <span class="op">=</span> <span class="st">"spatial_data.rds"</span><span class="op">)</span></span></code></pre></div>
<p>Now we make a map of the study region</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sp_data</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">mapp</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">domain</span> <span class="op">&lt;-</span> <span class="va">sp_data</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">mapp</span></span>
<span></span>
<span><span class="fu">fdmr</span><span class="fu">::</span><span class="fu">plot_map</span><span class="op">(</span>data <span class="op">=</span> <span class="va">sp_data</span>, domain <span class="op">=</span> <span class="va">domain</span>, add_scale_bar <span class="op">=</span> <span class="cn">TRUE</span>, polygon_fill_opacity <span class="op">=</span> <span class="fl">0.5</span>, fill_colour_weight <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span></span></code></pre></div>
<p>The COVID-19 data and the related covariate information are included in our tutorial data package. We’ll load in the data using same process we used above.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">covid19_data</span> <span class="op">&lt;-</span> <span class="fu">fdmr</span><span class="fu">::</span><span class="fu">load_tutorial_data</span><span class="op">(</span>filename <span class="op">=</span> <span class="st">"covid19_data.rds"</span><span class="op">)</span></span></code></pre></div>
<p>Then the first 6 rows of the data set can be viewed using the following code</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">covid19_data</span><span class="op">)</span></span></code></pre></div>
<p>The response variable in this study is the weekly reported number of COVID-19 cases in each of the 6789 neighbourhoods in main England over the period from 2020-03-07 to 2022-03-26.</p>
<p>Each week is defined to range from Saturday to Friday. Variable <code>date</code> indicates the start date of each observation week and variable <code>week</code> indicates the week number that the data are collected from. Therefore, the time frame of our study is from the week beginning March 7, 2020 to the week beginning March 26, 2022 inclusive, which spans 108 weeks. Variables <code>LONG</code> and <code>LAT</code> indicate the longitude and latitude for each neighbourhood.</p>
<p>We plot the weekly number of reported COVID-19 cases spanning the 108 weeks:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">breaks_vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2020-03-07"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2022-03-26"</span><span class="op">)</span>,</span>
<span>  by <span class="op">=</span> <span class="st">"3 week"</span></span>
<span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2022-03-26"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cases_week</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">covid19_data</span>, <span class="va">date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>cases <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">cases</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">fdmr</span><span class="fu">::</span><span class="fu">plot_barchart</span><span class="op">(</span>data <span class="op">=</span> <span class="va">cases_week</span>, x <span class="op">=</span> <span class="va">cases_week</span><span class="op">$</span><span class="va">date</span>, y <span class="op">=</span> <span class="va">cases_week</span><span class="op">$</span><span class="va">cases</span>, breaks <span class="op">=</span> <span class="va">breaks_vec</span>, x_label <span class="op">=</span> <span class="st">"Date"</span>, y_label <span class="op">=</span> <span class="st">"Number of cases"</span><span class="op">)</span></span></code></pre></div>
<p>A number of studies have linked different socioeconomic, demographic and environmental factors to explain the variation in COVID-19 infection rates across space (<span class="citation">Sun, Hu, and Xie (<a href="#ref-sun2021spatial" role="doc-biblioref">2021</a>)</span>, <span class="citation">Choi et al. (<a href="#ref-choi2021studying" role="doc-biblioref">2021</a>)</span>, <span class="citation">Akinwumiju et al. (<a href="#ref-akinwumiju2022geospatial" role="doc-biblioref">2022</a>)</span>, <span class="citation">Al Kindi et al. (<a href="#ref-al2021demographic" role="doc-biblioref">2021</a>)</span>, <span class="citation">Kim et al. (<a href="#ref-kim2021covid" role="doc-biblioref">2021</a>)</span>, <span class="citation">Wang et al. (<a href="#ref-wang2020high" role="doc-biblioref">2020</a>)</span>, <span class="citation">Berg, Present, and Richardson (<a href="#ref-berg2021long" role="doc-biblioref">2021</a>)</span>). Based on the past studies and data availability, we selected a set of potential socioeconomic, demographic and environmental variables for our model. These covariate data were collected for each MSOA in England, and can be accessed at <a href="https://www.nomisweb.co.uk/census/2021/bulk" class="external-link">https://www.nomisweb.co.uk/census/2021/bulk</a> and <a href="https://uk-air.defra.gov.uk/data/pcm-data" class="external-link">https://uk-air.defra.gov.uk/data/pcm-data</a>. We also considered two other covariates related to health care for possible inclusion in the model, because existing studies have shown that they may affect infection rates of COVID-19 (<span class="citation">Harris and Brunsdon (<a href="#ref-harris2021measuring" role="doc-biblioref">2021</a>)</span>, <span class="citation">Lee et al. (<a href="#ref-lee2022quantifying" role="doc-biblioref">2022</a>)</span>). Table 1 provides the full descriptions of the variables.</p>
<table class="table">
<caption>Table1: Descriptions of the covariates in the study</caption>
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<thead><tr class="header">
<th>Covariate</th>
<th>Full description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>IMD</td>
<td>Index of multiple deprivation score for how deprived the area is. A lower index indicates a higher level of deprivation.</td>
</tr>
<tr class="even">
<td>Care home beds</td>
<td>The number of care home beds per adult population</td>
</tr>
<tr class="odd">
<td>Accident and Emergency</td>
<td>There is a hospital that has emergency facilities or not</td>
</tr>
<tr class="even">
<td>Percentage of Chinese (%)</td>
<td>Percentage of people who are Chinese descent</td>
</tr>
<tr class="odd">
<td>Percentage of Indian (%)</td>
<td>Percentage of people who are Indian descent</td>
</tr>
<tr class="even">
<td>Percentage of Pakistani (%)</td>
<td>Percentage of people who are Pakistani descent</td>
</tr>
<tr class="odd">
<td>Percentage of Bangladeshis (%)</td>
<td>Percentage of people who are Bangladeshis descent</td>
</tr>
<tr class="even">
<td>Percentage of African (%)</td>
<td>Percentage of people who are African</td>
</tr>
<tr class="odd">
<td>Percentage of Caribbean (%)</td>
<td>Percentage of people who are Caribbean descent</td>
</tr>
<tr class="even">
<td>Percentage of white British (%)</td>
<td>Percentage of people who are white British</td>
</tr>
<tr class="odd">
<td>Age 18-29 (%)</td>
<td>Percentage of the adult population who aged 18-29</td>
</tr>
<tr class="even">
<td>Age 30-44 (%)</td>
<td>Percentage of the adult population who aged 30-44</td>
</tr>
<tr class="odd">
<td>Age 45-64 (%)</td>
<td>Percentage of the adult population who aged 45-64</td>
</tr>
<tr class="even">
<td>Age &gt;=65 (%)</td>
<td>Percentage of the adult population who aged 65 and over</td>
</tr>
<tr class="odd">
<td>
<span class="math inline">\(\text{PM}_{2.5}\)</span> (<span class="math inline">\(\mu g m^{-3}\)</span>)</td>
<td>Annual mean concentrations of fine particulate matter</td>
</tr>
<tr class="even">
<td>
<span class="math inline">\(\text{N0}_{2}\)</span> (<span class="math inline">\(\mu g m^{-3}\)</span>)</td>
<td>Annual mean concentrations of nitrogen dioxide</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2" number="3">
<h2 id="model-specification">
<span class="header-section-number">3</span> Model specification<a class="anchor" aria-label="anchor" href="#model-specification"></a>
</h2>
<p>We use a Bayesian hierarchical model to predict the spatio-temporal COVID-19 infection rate at the neighbourhood level in England. Let <span class="math inline">\(Y_{it}\)</span> denotes the weekly number of reported COVID cases for neighbourhood <span class="math inline">\(i=1,\ldots, n(=6789)\)</span> and week <span class="math inline">\(t=1,\ldots, T(=108)\)</span> and <span class="math inline">\(N_{it}\)</span> denotes the (official) estimated population living in neighbourhood <span class="math inline">\(i\)</span> and week <span class="math inline">\(t\)</span>. Note that in our data the population size for each neighbourhood is obtained from the 2021 census and does not change over time, i.e., <span class="math inline">\(N_{i1}=N_{i2}=\ldots = N_{i,108}\)</span> for all <span class="math inline">\(i\)</span>. <span class="math inline">\(Y_{it}\)</span> is assumed to have a Poisson distribution with parameters (<span class="math inline">\(N_{it}\)</span>, <span class="math inline">\(\theta_{it}\)</span>), where <span class="math inline">\(\theta_{it}\)</span> is the true unobserved COVID-19 infection rate / risk in neighbourhood <span class="math inline">\(i\)</span> and week <span class="math inline">\(t\)</span>. We follow a standard path in modelling <span class="math inline">\(\theta_{it}\)</span> with a log link to the Poisson and start with a model where the linear predictor decomposes additively into a set of covariates and a Gaussian latent process characterizing the infection of the disease after the covariate effects have been accounted for. The proposed model is given by</p>
<p><span class="math display">\[\begin{align}
\nonumber  Y_{it}\vert N_{it}, \theta_{it} &amp;\sim \text{Poisson}(N_{it}\theta_{it}),\ \  i=1,\ldots,n;\ \  t=1,\ldots,T,\\
log(\theta_{it} )&amp;=\boldsymbol{x_{it}^{\top}}\boldsymbol{\beta}+S(i,t).
\end{align}\]</span></p>
<p>A vector of covariates (if needed) is given by <span class="math inline">\(\boldsymbol{x_{it}}\)</span> for neighbourhood <span class="math inline">\(i\)</span> and time period <span class="math inline">\(t\)</span>. <span class="math inline">\(\boldsymbol\beta\)</span> is a vector of regression parameters. <span class="math inline">\(S(i,t)\)</span> is a spatio-temporal random effect at location <span class="math inline">\(i\)</span> and time <span class="math inline">\(t\)</span>, which is modelled by</p>
<p><span class="math display">\[S(i,t)=\alpha \times S(i,t-1)+\omega(i,t).\]</span></p>
<p>Here <span class="math inline">\(S(i,t)\)</span> follows a stationary distribution of a first-order autoregressive process (AR(1)) and <span class="math inline">\(\alpha\)</span> is the temporal dependence parameter that takes on a value in the interval [-1,1], with <span class="math inline">\(\alpha=1\)</span> indicating strong temporal dependence (a first-order random walk), while <span class="math inline">\(\alpha=0\)</span> corresponds to independence across time. <span class="math inline">\(\omega(i,t)\)</span> is a spatial random effect that is assumed to arise from a multivariate normal distribution. Each <span class="math inline">\(\omega(i,t)\)</span> follows a zero-mean Gaussian field which is assumed to be temporally independent but spatially dependent at each time period with Matérn covariance function given by</p>
<p><span class="math display">\[\text{Cov}(\omega(i,t), \omega(j,t))=\frac{\sigma^2}{2^{\nu-1}\Gamma(\nu)}(\kappa||i-j||)^{\nu}K_{\nu}(\kappa||i-j||),\]</span>
where <span class="math inline">\(K_{\nu}(\cdot)\)</span> is the modified Bessel function of second kind, and <span class="math inline">\(\Gamma(\nu)\)</span> is the Gamma function. The Matérn covariance function has three hyperparameters:</p>
<ol style="list-style-type: decimal">
<li>
<span class="math inline">\(\sigma^2\)</span> controls the marginal variance of the process S(i,t).</li>
<li>
<span class="math inline">\(\kappa\)</span> controls the spatial correlation range, which can be defined as <span class="math inline">\(\rho=\sqrt{8\nu}/\kappa\)</span>.</li>
<li>
<span class="math inline">\(\nu\)</span> controls the smoothness, where higher values leads to processes that are more smoother.</li>
</ol>
<p>The model is implemented through the INLA-SPDE approach in R programming. A few steps are needed before fitting the model:</p>
<ol style="list-style-type: decimal">
<li>Create a triangulated mesh of the study region</li>
<li>Build the SPDE model based on the mesh and set priors for the spatial parameters</li>
<li>Define how the process evolves over time and set prior for the temporal parameter</li>
<li>Define the model formula</li>
</ol>
</div>
<div class="section level2" number="4">
<h2 id="mesh-construction">
<span class="header-section-number">4</span> Mesh construction<a class="anchor" aria-label="anchor" href="#mesh-construction"></a>
</h2>
<p>To implement the SPDE approach, it is necessary to discretize the space by creating a triangulated mesh that establishes a set of artificial neighbors across the study region (i.e., mainland England). This allows for the calculation of spatial autocorrelation between observations. The construction of the mesh has an impact on the model inferences and predictions. Therefore, it is crucial to develop a good mesh to ensure that the results are not overly sensitive to the mesh. Although the construction of the mesh varies depending on the case study, there are some guidelines available to produce an optimal mesh. In this vignette we will construct a two-dimensional mesh using the INLA::inla.mesh.2d() function. The locations of all neighbourhoods are passed to the function argument “loc” as initial mesh nodes, and then other arguments in the function are tuned to adjust the shape and resolution of the mesh as necessary.</p>
<p>Argument “max.edge” determines the maximum permitted length for a triangle (lower values for max.edge result in higher mesh resolution). This argument can take either a scalar value, which controls the triangle edge lengths in the inner domain, or a length-two vector that controls edge lengths both in the inner domain and in the outer extension to avoid the boundary effect. Although there is no standard for setting a correct value for the max.edge, a value for max.edge that is too close to the spatial range (i.e., a low resolution) will complicate the process of fitting a smooth SPDE. Specifically, the Gaussian random field approximation might deviate strongly from the desired Matern structure, and the marginal variance will vary over the domain rather than being constant, which violates the assumption of a stationary Gaussian process. Conversely, if the max.edge value is too small compared to the spatial range (i.e., a high resolution), the mesh will contain an excessive number of vertices, resulting in a more computationally intensive fitting process that may not necessarily yield improved results. A number of research studies have suggested the max.edge value for the inner domain to be between 1/3 to 1/10 times smaller than the spatial range (note that the spatial range parameter in INLA GMRF is the distance at which the correlation drops to about 0.13). Since the spatial range cannot be known until the model has been fitted, an initial guess needs to be made and 1/5 of the spatial domain is often used in practice. Here, we define the argument “max.edge” such that the outer extension has a triangle density two times lower than than the inner domain (i.e., twice the triangle length for the outer extension edges), so that the original spatial domain is extended without increasing too much computational burden.</p>
<p><span class="citation">Lindgren and Rue (<a href="#ref-lindgren2015bayesian" role="doc-biblioref">2015</a>)</span> suggested extending the domain of interest by a distance at least equal to the spatial range to avoid the boundary effect. The function argument “offset” specifies the size of the inner and outer extensions around the data locations. In this study, we expand the inner domain by 1/4 of the spatial range initially assumed, and the outer domain by the same amount as the spatial range. In addition, we also use the parameter “cutoff” to avoid building too many small triangles where we have some very close input locations. It defines the minimum allowed distance between observation points. Points with a distance less than the cutoff value will be considered as a single mesh vertex. Here we choose a cutoff value equal to 1/7 of the max.edge value of the inner domain. The mesh for our study region is displayed in Figure <a href="#fig:plotmesh"><strong>??</strong></a>, where the blue dots represent the locations of the neighbourhoods.</p>
<p>Here we use the <code><a href="https://rdrr.io/pkg/INLA/man/inla.mesh.2d.html" class="external-link">INLA::inla.mesh.2d</a></code> to construct our mesh.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">initial_range</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">sp_data</span><span class="op">@</span><span class="va">data</span><span class="op">[</span>, <span class="st">"LONG"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fl">5</span></span>
<span></span>
<span><span class="va">max_edge</span> <span class="op">&lt;-</span> <span class="va">initial_range</span> <span class="op">/</span> <span class="fl">8</span></span>
<span></span>
<span><span class="va">mesh</span> <span class="op">&lt;-</span> <span class="fu">INLA</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.mesh.2d.html" class="external-link">inla.mesh.2d</a></span><span class="op">(</span></span>
<span>  loc <span class="op">=</span> <span class="va">sp_data</span><span class="op">@</span><span class="va">data</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"LONG"</span>, <span class="st">"LAT"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  max.edge <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span> <span class="op">*</span> <span class="va">max_edge</span>,</span>
<span>  offset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">initial_range</span> <span class="op">/</span> <span class="fl">4</span>, <span class="va">initial_range</span><span class="op">)</span>,</span>
<span>  cutoff <span class="op">=</span> <span class="va">max_edge</span> <span class="op">/</span> <span class="fl">7</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">point_data</span> <span class="op">&lt;-</span> <span class="va">sp_data</span><span class="op">@</span><span class="va">data</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"LONG"</span>, <span class="st">"LAT"</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="fu">fdmr</span><span class="fu">::</span><span class="fu">plot_mesh</span><span class="op">(</span>mesh <span class="op">=</span> <span class="va">mesh</span>, point_data <span class="op">=</span> <span class="va">point_data</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2" number="5">
<h2 id="build-the-spde-model-on-the-mesh-and-set-priors-for-the-spatial-parameters">
<span class="header-section-number">5</span> Build the SPDE model on the mesh and set priors for the spatial parameters<a class="anchor" aria-label="anchor" href="#build-the-spde-model-on-the-mesh-and-set-priors-for-the-spatial-parameters"></a>
</h2>
<p>We use the INLA::inla.spde2.pcmatern() function to build the SPDE model and specify Penalised Complexity (PC) priors for the parameters of the Matérn field. PC priors for the parameters range and marginal standard deviation of the Matérn field are specified by setting the values <span class="math inline">\(m_r\)</span>, <span class="math inline">\(p_r\)</span>, <span class="math inline">\(m_\sigma\)</span> and <span class="math inline">\(p_\sigma\)</span> in the relations that P(spatial range&lt;<span class="math inline">\(m_r\)</span>)= <span class="math inline">\(p_r\)</span>, and P(<span class="math inline">\(\sigma&gt;m_\sigma\)</span>)= <span class="math inline">\(p_\sigma\)</span>. The spatial range of the process is the distance at which the correlation between two values is close to 0.1. In this study we use a prior of P(spatial range&lt;0.296)= 0.5 for the spatial range parameter based on an exploratory variogram analysis. It means that the probability that the spatial range is smaller than 0.296 degrees of latitude (which is equivalent to 32.856 kilometers) is 0.5. <span class="math inline">\(\sigma\)</span> controls the marginal standard deviation of the process, and is specified a prior of P(<span class="math inline">\(\sigma\)</span> &gt;1)= 0.01.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prior_range</span> <span class="op">&lt;-</span> <span class="va">initial_range</span></span>
<span><span class="va">spde</span> <span class="op">&lt;-</span> <span class="fu">INLA</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.spde2.pcmatern.html" class="external-link">inla.spde2.pcmatern</a></span><span class="op">(</span></span>
<span>  mesh <span class="op">=</span> <span class="va">mesh</span>,</span>
<span>  prior.range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">prior_range</span>, <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>  prior.sigma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.01</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2" number="6">
<h2 id="define-how-the-process-evolves-over-time-and-set-prior-for-the-temporal-parameter">
<span class="header-section-number">6</span> Define how the process evolves over time and set prior for the temporal parameter<a class="anchor" aria-label="anchor" href="#define-how-the-process-evolves-over-time-and-set-prior-for-the-temporal-parameter"></a>
</h2>
<p>The previous step has specified that in each of the time periods the spatial locations are linked by the SPDE model. Now we assume that across time the process evolves according to a first order autoregressive (AR(1)) process. We specify a PC prior for the temporal autocorrelation parameter <span class="math inline">\(\alpha \in [-1,1]\)</span>. The prior is given by <code>rhoprior</code>, which is a PC prior with P(<span class="math inline">\(\alpha&gt;0\)</span>)=0.9.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rhoprior</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>theta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>prior <span class="op">=</span> <span class="st">"pccor1"</span>, param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.9</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>In order to fit the model, we also need to define a temporal index (must be an integer starting at 1) and the number of discrete time points we want to model.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">group_index</span> <span class="op">&lt;-</span> <span class="va">covid19_data</span><span class="op">$</span><span class="va">week</span></span>
<span><span class="va">n_groups</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">covid19_data</span><span class="op">$</span><span class="va">week</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We will use the function <code><a href="https://inlabru-org.github.io/inlabru/reference/bru.html" class="external-link">bru()</a></code> of package <code>inlabru</code> to fit the model. <code>bru</code> expects the coordinates of the data, thus we transform <code>covid19_data</code> data set to a SpatialPointsDataFrame using the function <code><a href="https://rdrr.io/pkg/sp/man/coordinates.html" class="external-link">coordinates()</a></code> of the <code>sp</code> package.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">sp</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/sp/man/coordinates.html" class="external-link">coordinates</a></span><span class="op">(</span><span class="va">covid19_data</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"LONG"</span>, <span class="st">"LAT"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2" number="7">
<h2 id="define-the-model-formula">
<span class="header-section-number">7</span> Define the model formula<a class="anchor" aria-label="anchor" href="#define-the-model-formula"></a>
</h2>
<p>In order to fit the spatio-temporal model, a model formula needs to be defined, by including the response in the left-hand side and the fixed and random effects in the right-hand side.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">formula</span> <span class="op">&lt;-</span> <span class="va">cases</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">Intercept</span> <span class="op">+</span> <span class="va">IMD</span> <span class="op">+</span></span>
<span>  <span class="va">carebeds.ratio</span> <span class="op">+</span> <span class="va">AandETRUE</span> <span class="op">+</span></span>
<span>  <span class="va">perc.chinese</span> <span class="op">+</span> <span class="va">perc.indian</span> <span class="op">+</span> <span class="va">perc.bangladeshi</span> <span class="op">+</span> <span class="va">perc.pakistani</span> <span class="op">+</span> <span class="va">perc.ba</span> <span class="op">+</span> <span class="va">perc.bc</span> <span class="op">+</span> <span class="va">perc.wb</span> <span class="op">+</span></span>
<span>  <span class="va">age1</span> <span class="op">+</span> <span class="va">age2</span> <span class="op">+</span> <span class="va">age3</span> <span class="op">+</span> <span class="va">age4</span> <span class="op">+</span></span>
<span>  <span class="va">pm25</span> <span class="op">+</span> <span class="va">no2</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/f.html" class="external-link">f</a></span><span class="op">(</span></span>
<span>    main <span class="op">=</span> <span class="va">coordinates</span>,</span>
<span>    model <span class="op">=</span> <span class="va">spde</span>,</span>
<span>    group <span class="op">=</span> <span class="va">group.index</span>,</span>
<span>    ngroup <span class="op">=</span> <span class="va">n_groups</span>,</span>
<span>    control.group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      model <span class="op">=</span> <span class="st">"ar1"</span>,</span>
<span>      hyper <span class="op">=</span> <span class="va">rhoprior</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2" number="8">
<h2 id="fit-the-model">
<span class="header-section-number">8</span> Fit the model<a class="anchor" aria-label="anchor" href="#fit-the-model"></a>
</h2>
<p>Finally, we fit the spatio-temporal model using spde approach and AR(1) process by calling the function <code><a href="https://inlabru-org.github.io/inlabru/reference/bru.html" class="external-link">bru()</a></code> of the package <code>inlabru</code>.</p>
<blockquote>
<p><strong><em>NOTE:</em></strong> Since the data size is quite large the memory requirements of this function call are high. We recommend running on a suitable high memory (HOW MUCH IS ENOUGH?) system. In our case it takes about 13 hours to complete.</p>
</blockquote>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># inlabru.model&lt;-bru(formula, data = COVID19dat,</span></span>
<span><span class="co">#                    family = "poisson",</span></span>
<span><span class="co">#                    E = COVID19dat$Population,</span></span>
<span><span class="co">#                    control.family = list(link = "log"),</span></span>
<span><span class="co">#                    control.predictor = list(link = 1),</span></span>
<span><span class="co">#                    options = list(</span></span>
<span><span class="co">#                      control.inla = list(</span></span>
<span><span class="co">#                        reordering = "metis",</span></span>
<span><span class="co">#                        int.strategy = "eb"),</span></span>
<span><span class="co">#                       verbose = TRUE,</span></span>
<span><span class="co">#                      inla.mode="experimental"</span></span>
<span><span class="co">#                    )</span></span>
<span><span class="co"># )</span></span></code></pre></div>
</div>
<div class="section level2" number="9">
<h2 id="results">
<span class="header-section-number">9</span> Results<a class="anchor" aria-label="anchor" href="#results"></a>
</h2>
<p>We can inspect the results by typing summary(inlabru_model),which shows the parameter estimates of the fixed and random effects. The marginal distributions of the hyperparameters can also be obtained as follows.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">inlabru_model</span><span class="op">)</span></span>
<span></span>
<span><span class="va">model_summary_fixed</span> <span class="op">&lt;-</span> <span class="va">inlabru_model</span><span class="op">$</span><span class="va">summary.fixed</span></span>
<span><span class="va">model_hyperparams</span> <span class="op">&lt;-</span> <span class="va">inlabru_model</span><span class="op">$</span><span class="va">marginals.hyperpar</span></span></code></pre></div>
<div class="section level3" number="9.1">
<h3 id="summary-of-the-parameter-estimates-of-the-fixed-effects">
<span class="header-section-number">9.1</span> Summary of the parameter estimates of the fixed effects<a class="anchor" aria-label="anchor" href="#summary-of-the-parameter-estimates-of-the-fixed-effects"></a>
</h3>
<p>The model summary is provided in the tutorial data package so we’ll load that now.</p>
<blockquote>
<p><strong><em>NOTE:</em></strong> If you’ve run the full model above you don’t need to load in the files below.</p>
</blockquote>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_summary</span> <span class="op">&lt;-</span> <span class="fu">fdmr</span><span class="fu">::</span><span class="fu">load_tutorial_data</span><span class="op">(</span>filename <span class="op">=</span> <span class="st">"model_summary.rds"</span><span class="op">)</span></span>
<span><span class="va">model_summary_fixed</span> <span class="op">&lt;-</span> <span class="fu">fdmr</span><span class="fu">::</span><span class="fu">load_tutorial_data</span><span class="op">(</span>filename <span class="op">=</span> <span class="st">"model_summary_fixed.rds"</span><span class="op">)</span></span>
<span><span class="va">model_hyperparams</span> <span class="op">&lt;-</span> <span class="fu">fdmr</span><span class="fu">::</span><span class="fu">load_tutorial_data</span><span class="op">(</span>filename <span class="op">=</span> <span class="st">"model_hyperparams.rds"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">model_summary_fixed</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">model_summary_fixed</span><span class="op">)</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>Table 2 reports the regression coefficient values, the estimated relative risks and 95% credible intervals between each covariate and COVID infection from our model. The estimated relative risks and 95% credible intervals are computed by exponentially transforming the regression coefficients associated with the covariates described in Table 1. The relative risks relate to realistic increases in each covariate, which are given in brackets in column 1 of the table.</p>
<table class="table">
<caption>Table2: Estimated relative risks and 95% credible intervals for the effects of each covariate on COVID-19 infection.</caption>
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th>Covariate</th>
<th>Regression coefficient</th>
<th>Relative risks (95% CI)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>IMD (10)</td>
<td>-0.0005</td>
<td>0.9949 (0.9937, 0.9961)</td>
</tr>
<tr class="even">
<td>Percentage of Chinese (1)</td>
<td>-0.0030</td>
<td>0.9969 (0.9957, 0.9982)</td>
</tr>
<tr class="odd">
<td>Percentage of Indian (1)</td>
<td>0.0024</td>
<td>1.0024 (1.0020, 1.0028)</td>
</tr>
<tr class="even">
<td>Percentage of Pakistani (1)</td>
<td>0.0023</td>
<td>1.0023 (1.0020, 1.0027)</td>
</tr>
<tr class="odd">
<td>Percentage of Bangladeshis (1)</td>
<td>0.0014</td>
<td>1.0014 (1.0010, 1.0018))</td>
</tr>
<tr class="even">
<td>Percentage of African (1)</td>
<td>-0.0039</td>
<td>0.9961 (0.9955, 0.9966)</td>
</tr>
<tr class="odd">
<td>Percentage of Caribbean (1)</td>
<td>0.0083</td>
<td>1.0084 (1.0073, 1.0095)</td>
</tr>
<tr class="even">
<td>Percentage of white British (%)</td>
<td>0.0044</td>
<td>1.0044 (1.0041, 1.0047)</td>
</tr>
<tr class="odd">
<td>Age 18-29 (1)</td>
<td>-0.0038</td>
<td>0.9962 (0.9958, 0.9965)</td>
</tr>
<tr class="even">
<td>Age 30-44 (1)</td>
<td>0.0003</td>
<td>1.0003 (0.9998, 1.0009)</td>
</tr>
<tr class="odd">
<td>Age 45-64 (1)</td>
<td>0.0024</td>
<td>1.0024 (1.0018, 1.0030)</td>
</tr>
<tr class="even">
<td>Age &gt;=65 (1)</td>
<td>-0.0063</td>
<td>0.9937 (0.9932, 0.9941)</td>
</tr>
<tr class="odd">
<td>
<span class="math inline">\(\text{PM}_{2.5}\)</span> (1 <span class="math inline">\(\mu g m^{-3}\)</span>)</td>
<td>0.0041</td>
<td>1.0041 (1.0002, 1.0080)</td>
</tr>
<tr class="even">
<td>
<span class="math inline">\(\text{N0}_{2}\)</span> (10 <span class="math inline">\(\mu g m^{-3}\)</span>)</td>
<td>0.0002</td>
<td>1.0015 (0.9915, 1.0116)</td>
</tr>
<tr class="odd">
<td>Care home beds (0.01)</td>
<td>1.1166</td>
<td>1.0112 (1.0103, 1.0121)</td>
</tr>
<tr class="even">
<td>Accident and Emergency (TRUE)</td>
<td>0.0049</td>
<td>1.0050 (1.0018, 1.0081)</td>
</tr>
</tbody>
</table>
<p>The table shows clear evidence that a high level of socio-economic deprivation is associated with increased COVID-19 incidence. An increase of 10 scores in IMD is significantly associated with a 0.5% decreased infection rate. The number of care home beds per adult is also significantly associated with COVID infection, because if a neighbourhood increases its care home beds ratio by 0.01, the estimated risk increases by around 1.1%. In addition, having a hospital with emergency facilities in a neighbourhood is diagnosed positively and significantly associated with higher infection risk (RR:1.0050, 95% CI: 1.0018-1.0081).</p>
<p>Ethnicity appears overall to have a strong association with COVID-19 infection. Neighbourhoods with a greater percentage of Chinese population have lower risk of infections. However, Indian and Pakistani ethnic groups have been found to have a small detrimental effect of COVID infection, with risk increasing by 0.2% as the percentage of Indian or Pakistani ethnic groups in a neighbourhood increases by 1%. African population is associated with decreased risk of COVID-19 infection (RR:0.9961, 95% CI: 0.9955-0.9966), whereas Caribbean population has statistically higher COVID-19 infections (RR: 1.0084, 95% CI: 1.0073-1.0095). Neighbourhoods with a greater percentage of white British have higher risk of infections, with a 1% increase in the population being associated with a statistically significant 0.4% increase in COVID infection.</p>
<p>In addition, we have also found that infection rate is lower in both neighbourhoods with greater population percentages of adults age 65 years and older (RR: 0.9937, 95% CI: 0.9932–0.9941) and neighbourhoods with greater percentages of adults age 18–29 years (RR: 0.9962, 95% CI: 0.9958–0.9965). In contrast, the population between 30 and 44 years old and the population between 45 and 64 years old are positively associated with risk of infections, although the result for the former is not significant. Finally, elevated <span class="math inline">\(\text{PM}_{2.5}\)</span> concentrations are statistically significantly associated with COVID-19 incidence, with a <span class="math inline">\(1 \ \mu g m^{-3}\)</span> increase in concentrations being associated with between a 0.02% and a 0.80% increased risk. A <span class="math inline">\(10 \ \mu g m^{-3}\)</span> increase in <span class="math inline">\(\text{NO}_2\)</span> concentrations is associated with a positive, but insignificant increase in the relative risk of COVID infections (RR: 1.0015, 95% CI: 0.9915, 1.0116).</p>
</div>
<div class="section level3" number="9.2">
<h3 id="summary-of-the-hyperparameters">
<span class="header-section-number">9.2</span> Summary of the hyperparameters<a class="anchor" aria-label="anchor" href="#summary-of-the-hyperparameters"></a>
</h3>
<p>The parameter estimates of the spatial range parameter, marginal standard deviation of the latent Gaussian process and the AR(1) coefficient are</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_summary</span><span class="op">$</span><span class="va">inla</span><span class="op">$</span><span class="va">hyperpar</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span></code></pre></div>
<p>To plot the posterior distributions of the spatial range, the standard deviation and temporal dependence parameters of the spatio-temporal random effect, we create a list named list_marginals containing the posterior distributions for each parameter. From this list, we generate a data frame margs, and include an additional column named ‘parameter’ which specifies the name of the corresponding distribution for each parameter. Spatial range is estimated to be 0.297, and AR(1) coefficient is estimated to be 0.839, indicating a high level of temporal dependence.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">list_marginals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"Spatial range"</span> <span class="op">=</span> <span class="va">model_hyperparams</span><span class="op">$</span><span class="va">`Range for f`</span>,</span>
<span>  <span class="st">"Stdev"</span> <span class="op">=</span> <span class="va">model_hyperparams</span><span class="op">$</span><span class="va">`Stdev for f`</span>,</span>
<span>  <span class="st">"AR(1)"</span> <span class="op">=</span> <span class="va">model_hyperparams</span><span class="op">$</span><span class="va">`GroupRho for f`</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">margs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">list_marginals</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">margs</span><span class="op">$</span><span class="va">parameter</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">list_marginals</span><span class="op">)</span>,</span>
<span>  times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">list_marginals</span>, <span class="va">nrow</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">margs</span><span class="op">$</span><span class="va">parameter</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">margs</span><span class="op">$</span><span class="va">parameter</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Spatial range"</span>, <span class="st">"Stdev"</span>, <span class="st">"AR(1)"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">margs</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">parameter</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">"Density"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3" number="9.3">
<h3 id="temporal-evolution-of-infection-rate-predictions">
<span class="header-section-number">9.3</span> Temporal evolution of infection rate predictions<a class="anchor" aria-label="anchor" href="#temporal-evolution-of-infection-rate-predictions"></a>
</h3>
<p>The infection rate predictions from the model can be computed using the following codes, and are saved in a data frame called “predictions”.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred.mean</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">inlabru_model</span><span class="op">$</span><span class="va">summary.fitted.values</span><span class="op">$</span><span class="va">mean</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">covid19_data</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">pred.25</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">inlabru_model</span><span class="op">$</span><span class="va">summary.fitted.values</span><span class="op">$</span><span class="va">`0.025quant`</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">covid19_data</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">pred.975</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">inlabru_model</span><span class="op">$</span><span class="va">summary.fitted.values</span><span class="op">$</span><span class="va">`0.975quant`</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">covid19_data</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">predictions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind.data.frame</a></span><span class="op">(</span></span>
<span>  <span class="va">covid19_data</span><span class="op">$</span><span class="va">date</span>,</span>
<span>  <span class="va">covid19_data</span><span class="op">$</span><span class="va">week</span>,</span>
<span>  <span class="st">"pred.mean"</span> <span class="op">=</span> <span class="va">pred.mean</span>,</span>
<span>  <span class="st">"pred.25"</span> <span class="op">=</span> <span class="va">pred.25</span>,</span>
<span>  <span class="st">"pred.975"</span> <span class="op">=</span> <span class="va">pred.975</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The date frame “predictions” is provided in the tutorial data package, we’ll load that in now.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">predictions</span> <span class="op">&lt;-</span> <span class="fu">fdmr</span><span class="fu">::</span><span class="fu">load_tutorial_data</span><span class="op">(</span>filename <span class="op">=</span> <span class="st">"predictions.rds"</span><span class="op">)</span></span></code></pre></div>
<p>Figure <a href="#fig:boxps"><strong>??</strong></a> displays the boxplots of the predicted infection risk for all neighbourhoods over time. It can be seen that health inequalities in COVID infection exist in England, as there are large differences between the estimated disease risks. Figure <a href="#fig:plotmeanrisk"><strong>??</strong></a> provides the line plot for the average predicted risk with 95% credible intervals by week across England. The COVID infection risk witnessed a series of fluctuations over the study period within the range between 0.0002 and 0.05, while an overall upward temporal trend can be observed. There was an initial peak in mid-November 2020, after which the infection levels declined before rising again in mid-December 2020, which were driven by the emergence of the Alpha variant and peaked in early January 2021. In the week of 5 June 2021, the infection rate began rising again until mid-July when it was estimated at 0.5%, after which the risk fell and then remained steady by November. However, the infection reached its highest point in the week of 8 January 2022 at 2.0%, which then decreased substantially until early March 2022.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">breaks_vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2020-03-07"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">predictions</span><span class="op">$</span><span class="va">date</span><span class="op">)</span>,</span>
<span>  by <span class="op">=</span> <span class="st">"3 week"</span></span>
<span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2022-03-26"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">fdmr</span><span class="fu">::</span><span class="fu">plot_boxplot</span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">predictions</span>,</span>
<span>  x <span class="op">=</span> <span class="va">predictions</span><span class="op">$</span><span class="va">date</span>,</span>
<span>  y <span class="op">=</span> <span class="va">predictions</span><span class="op">$</span><span class="va">pred.mean</span>,</span>
<span>  breaks <span class="op">=</span> <span class="va">breaks_vec</span>,</span>
<span>  x_label <span class="op">=</span> <span class="st">"Week of date"</span>,</span>
<span>  y_label <span class="op">=</span> <span class="st">"Infection risk"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mean_week</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">predictions</span>, <span class="va">date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span></span>
<span>  mean.prev <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">pred.mean</span><span class="op">)</span>,</span>
<span>  lc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">pred.25</span><span class="op">)</span>,</span>
<span>  uC <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">pred.975</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">fdmr</span><span class="fu">::</span><span class="fu">plot_line_average</span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">mean_week</span>,</span>
<span>  x <span class="op">=</span> <span class="va">mean_week</span><span class="op">$</span><span class="va">date</span>,</span>
<span>  y1 <span class="op">=</span> <span class="va">mean_week</span><span class="op">$</span><span class="va">mean.prev</span>,</span>
<span>  y2 <span class="op">=</span> <span class="va">mean_week</span><span class="op">$</span><span class="va">lc</span>,</span>
<span>  y3 <span class="op">=</span> <span class="va">mean_week</span><span class="op">$</span><span class="va">uC</span>,</span>
<span>  breaks <span class="op">=</span> <span class="va">breaks_vec</span>,</span>
<span>  x_label <span class="op">=</span> <span class="st">"Week of date"</span>,</span>
<span>  y_label <span class="op">=</span> <span class="st">"Average risk"</span>,</span>
<span>  y_lim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.025</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Finally, Figure <a href="#fig:mapaverisk"><strong>??</strong></a> shows the spatial pattern of the time averaged risks of infection in England.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">average_risk_by_nb</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">predictions</span>, <span class="va">MSOA11CD</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>ave.risk <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">pred.mean</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sp_data</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">ave.risk</span> <span class="op">&lt;-</span> <span class="va">average_risk_by_nb</span><span class="op">$</span><span class="va">ave.risk</span></span>
<span></span>
<span><span class="va">domain</span> <span class="op">&lt;-</span> <span class="va">sp_data</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">ave.risk</span></span>
<span><span class="va">legend_values</span> <span class="op">&lt;-</span> <span class="va">sp_data</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">ave.risk</span></span>
<span></span>
<span><span class="fu">fdmr</span><span class="fu">::</span><span class="fu">plot_map</span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">sp_data</span>,</span>
<span>  domain <span class="op">=</span> <span class="va">domain</span>,</span>
<span>  palette <span class="op">=</span> <span class="st">"Reds"</span>,</span>
<span>  legend_values <span class="op">=</span> <span class="va">legend_values</span>,</span>
<span>  legend_title <span class="op">=</span> <span class="st">"Risk"</span>,</span>
<span>  add_scale_bar <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  polygon_fill_opacity <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>  fill_colour_weight <span class="op">=</span> <span class="fl">1.0</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3" number="9.4">
<h3 id="evaluate-the-performance-of-prediction">
<span class="header-section-number">9.4</span> Evaluate the performance of prediction<a class="anchor" aria-label="anchor" href="#evaluate-the-performance-of-prediction"></a>
</h3>
<p>Measuring the prediction accuracy of a model is a critical aspect of evaluating its performance, especially in the context of time-series data where new information becomes available over time. To measure the prediction accuracy of the model, a moving time series window of training and validation data was considered when new data comes in throughout the pandemic. This approach allows the model to continuously update its parameters based on the latest available data, rather than relying on a static dataset that may not reflect the current situation. We started with an initial training dataset of 96 weeks from 2020/03/07 to 2022/01/01, and then used this to predict the infection risk <span class="math inline">\(\theta_{i,t}\)</span> for week <span class="math inline">\(t = 97\)</span> and all neighbourhoods <span class="math inline">\(i\)</span>. The prediction was then compared to the actual observed values to determine the accuracy of the model. This process is repeated for each subsequent week as new data becomes available.</p>
<p>The accuracy of risk prediction is measured by the root mean square error (RMSE), bias and coverage probabilities of the 95% credible intervals for the corresponding risk estimates. RMSE quantifies the average magnitude of the differences between the predicted and the observed values, and a lower value indicates better prediction performance. The <span class="math inline">\(\text{RMSE}_t\)</span> of the risk estimates in week <span class="math inline">\(t\)</span> over all neighbourhoods is calculated as</p>
<p><span class="math display">\[\text{RMSE}_t=\sqrt{\frac{1}{n_t}\sum_{i=1}^{n_t}(\hat{\theta}_{it}-\theta_{it})^2},\]</span>
where <span class="math inline">\(\hat{\theta}_{it}\)</span> and <span class="math inline">\(\theta_{it}\)</span> are the predicted and observed infection risk in neighbourhood <span class="math inline">\(i\)</span> and week <span class="math inline">\(t\)</span> respectively. <span class="math inline">\(n_t\)</span> is the total number of neighbourhoods with reported COVID infection data in week <span class="math inline">\(t\)</span>. Bias measures the average difference between the predicted and the observed values. The bias of the risk predictions of all neighbourhoods in week <span class="math inline">\(t\)</span> is calculated as
<span class="math display">\[\text{Bias}_t=\frac{1}{n_t}\sum_{i=1}^{n_t}(\hat{\theta}_{it}-\theta_{it}).\]</span></p>
<p>The uncertainty of the risk predictions can be measured by the coverage probabilities of the 95% credible intervals. The 95% coverage probability (denoted <span class="math inline">\(\text{CP}_t\)</span>) is computed as the proportion of the 95% credible intervals for <span class="math inline">\(\hat{\theta}_{it}\)</span> that contain the observed risk.</p>
<p>In addition, to measure the magnitude of the differences between the predicted and observed values in relation to the observed values, the relative root mean square error (R-RMSE) and relative bias (R-Bias) are also computed. The relative root mean square error (<span class="math inline">\(\text{R-RMSE}_t\)</span>) is calculated as</p>
<p><span class="math display">\[
\text{R-RMSE}_t=\sqrt{\frac{1}{n_t}\sum_{i=1}^{n_t}\left(\frac{\hat{\theta}_{it}-\theta_{it}}{\theta_{it}}\right)^2}.\]</span></p>
<p>The relative bias (<span class="math inline">\(\text{R-Bias}_t\)</span>) is calculated as
<span class="math display">\[
\text{R-Bias}_t=\frac{1}{n_t}\sum_{i=1}^{n_t}\left(\frac{\hat{\theta}_{it}-\theta_{it}}{\theta_{it}}\right).
\]</span></p>
<p>As new data comes in every week, all previous data are used for training the model, and the <span class="math inline">\(\text{RMSE}_t\)</span>, <span class="math inline">\(\text{R-RMSE}_t\)</span>, <span class="math inline">\(\text{Bias}_t\)</span>, <span class="math inline">\(\text{R-Bias}_t\)</span> and <span class="math inline">\(\text{CP}_t\)</span> are updated using new validation data of week <span class="math inline">\(t\)</span>. Finally, we create time series of <span class="math inline">\(\text{RMSE}_t\)</span>, <span class="math inline">\(\text{Bias}_t\)</span> and <span class="math inline">\(\text{CP}_t\)</span> over week <span class="math inline">\(t\)</span> in <span class="math inline">\((97,\ldots, 108)\)</span>, which summarise the progress of the predictive capabilities of the model over time.</p>
<p>The values of <span class="math inline">\(\text{RMSE}_t\)</span>, <span class="math inline">\(\text{Bias}_t\)</span>, <span class="math inline">\(\text{CP}_t\)</span>, <span class="math inline">\(\text{R-RMSE}_t\)</span> and <span class="math inline">\(\text{R-Bias}_t\)</span> for week <span class="math inline">\(t\)</span> in <span class="math inline">\((97,\ldots, 108)\)</span> are stored in the tutorial data package and we’ll load the <code>data.frame</code> containing that data now.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">predmetrics</span> <span class="op">&lt;-</span> <span class="fu">fdmr</span><span class="fu">::</span><span class="fu">load_tutorial_data</span><span class="op">(</span>filename <span class="op">=</span> <span class="st">"predmetrics.rds"</span><span class="op">)</span></span></code></pre></div>
<p>Figure <a href="#fig:performancePlots"><strong>??</strong></a> displays the time series plots for <span class="math inline">\(\text{RMSE}_t\)</span>, <span class="math inline">\(\text{Bias}_t\)</span> and <span class="math inline">\(\text{CP}_t\)</span>. The plots suggest that our model performs well in predicting the rate of COVID-19 infection, because the RMSE and bias values are very low (close to 0) compared to the range of the observed risks, and the coverage probabilities are close to their nominal 0.95 level. Table 3 provides the median and mean values for <span class="math inline">\(\text{RMSE}_t\)</span>, <span class="math inline">\(\text{Bias}_t\)</span>, <span class="math inline">\(\text{CP}_t\)</span>,<span class="math inline">\(\text{R-RMSE}_t\)</span> and <span class="math inline">\(\text{R-Bias}_t\)</span> for <span class="math inline">\(t \in (97, . . . , 108)\)</span>.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">breaks_vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">predmetrics</span><span class="op">$</span><span class="va">date</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">predmetrics</span><span class="op">$</span><span class="va">date</span><span class="op">)</span>,</span>
<span>  by <span class="op">=</span> <span class="st">"1 week"</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">RMSEt</span> <span class="op">&lt;-</span> <span class="va">predmetrics</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"date"</span>, <span class="st">"RMSEt"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">Biast</span> <span class="op">&lt;-</span> <span class="va">predmetrics</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"date"</span>, <span class="st">"Biast"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">CPt</span> <span class="op">&lt;-</span> <span class="va">predmetrics</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"date"</span>, <span class="st">"CPt"</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">g1</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">fdmr</span><span class="fu">::</span><span class="fu">plot_timeseries</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">RMSEt</span>,</span>
<span>    x <span class="op">=</span> <span class="va">RMSEt</span><span class="op">$</span><span class="va">date</span>,</span>
<span>    y <span class="op">=</span> <span class="va">RMSEt</span><span class="op">$</span><span class="va">RMSEt</span>,</span>
<span>    breaks <span class="op">=</span> <span class="va">breaks_vec</span>,</span>
<span>    x_label <span class="op">=</span> <span class="st">"Date"</span>,</span>
<span>    y_label <span class="op">=</span> <span class="st">"RMSE"</span>,</span>
<span>    y_lim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>    horizontal_y <span class="op">=</span> <span class="fl">0</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">g2</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">fdmr</span><span class="fu">::</span><span class="fu">plot_timeseries</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">Biast</span>,</span>
<span>    x <span class="op">=</span> <span class="va">Biast</span><span class="op">$</span><span class="va">date</span>,</span>
<span>    y <span class="op">=</span> <span class="va">Biast</span><span class="op">$</span><span class="va">Biast</span>,</span>
<span>    breaks <span class="op">=</span> <span class="va">breaks_vec</span>,</span>
<span>    x_label <span class="op">=</span> <span class="st">"Date"</span>,</span>
<span>    y_label <span class="op">=</span> <span class="st">"Bias"</span>,</span>
<span>    y_lim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.01</span>, <span class="fl">0.01</span><span class="op">)</span>,</span>
<span>    horizontal_y <span class="op">=</span> <span class="fl">0</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">g3</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">fdmr</span><span class="fu">::</span><span class="fu">plot_timeseries</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">CPt</span>,</span>
<span>    x <span class="op">=</span> <span class="va">CPt</span><span class="op">$</span><span class="va">date</span>,</span>
<span>    y <span class="op">=</span> <span class="va">CPt</span><span class="op">$</span><span class="va">CPt</span>,</span>
<span>    breaks <span class="op">=</span> <span class="va">breaks_vec</span>,</span>
<span>    x_label <span class="op">=</span> <span class="st">"Date"</span>,</span>
<span>    y_label <span class="op">=</span> <span class="st">"Coverage probability"</span>,</span>
<span>    y_lim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>    horizontal_y <span class="op">=</span> <span class="fl">0.95</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu">gridExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span><span class="va">g1</span>, <span class="va">g2</span>, <span class="va">g3</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Table3: A summary of the RMSE, bias and coverage probabilities.</caption>
<thead><tr class="header">
<th>Metric</th>
<th>Median</th>
<th>Mean</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\(\text{RMSE}_t\)</span></td>
<td>0.0024</td>
<td>0.0024</td>
</tr>
<tr class="even">
<td><span class="math inline">\(\text{Bias}_t\)</span></td>
<td>-0.0010</td>
<td>-0.0008</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(\text{CP}_t\)</span></td>
<td>0.9665</td>
<td>0.9224</td>
</tr>
<tr class="even">
<td><span class="math inline">\(\text{R-RMSE}_t\)</span></td>
<td>0.1566</td>
<td>0.1553</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(\text{R-Bias}_t\)</span></td>
<td>-0.1102</td>
<td>-0.0352</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level2" number="10">
<h2 id="discussion">
<span class="header-section-number">10</span> Discussion<a class="anchor" aria-label="anchor" href="#discussion"></a>
</h2>
<p>The study provides valuable insights into the spread and evolution of COVID-19 occurrences at the MSOA level in mainland England from March 7, 2020 to March 26, 2022. It found that there are significant health inequalities in COVID infection across England, with the magnitude of these inequalities appearing to have increased over time, which emphasizes the need for effective strategies to address the disparities in COVID-19 risk between different neighbourhoods. The COVID infection risk in England has fluctuated over time with an overall upward trend, and people appear to be at higher risk of COVID infection in June, July, December, and January, which is likely due to June and July are popular months for travelling, outdoor activities and social gatherings in the UK, and December and January are associated with holiday celebrations (Christmas and New Year’s holiday), family gatherings, and travel. These events often involve close contact with others, which can increase the risk of COVID-19 transmission. Colder and drier conditions during the winter months could also make the COVID-19 virus more transmissible (<span class="citation">Mecenas et al. (<a href="#ref-mecenas2020effects" role="doc-biblioref">2020</a>)</span>, <span class="citation">Wang et al. (<a href="#ref-wang2021impact" role="doc-biblioref">2021</a>)</span>). The low estimated infection risks and small variation in the first weeks of the study period is probably due to the limited capacity for COVID-19 testing in the first wave of the pandemic. Testing was only available to priority groups and was not comprehensive, meaning that many infected people were not diagnosed with the virus. This likely led to under-reporting of confirmed COVID-19 cases, which in turn led to low infection rates and small variation.</p>
<p>The results from the model have shown clear evidence that socioeconomic deprivation is positively associated with increased COVID-19 incidence, which aligns with the findings in <span class="citation">Oluyomi et al. (<a href="#ref-oluyomi2021covid" role="doc-biblioref">2021</a>)</span>, <span class="citation">Kulu and Dorey (<a href="#ref-kulu2021infection" role="doc-biblioref">2021</a>)</span> that the virus has hit harder in areas of higher deprivation. This is likely due to individuals living in deprived areas having limited access healthcare facilities and resources, exhibiting higher prevalence of underlying health conditions, and relying more heavily on public transportation, which all contribute to higher infection rates.</p>
<p>Ethnicity was found to have a strong association with COVID-19 infection. Chinese and African populations were found to be associated with lower risk of infections, whereas Indian and Pakistani ethnic groups, Caribbean population, and white British population were associated with higher risk of infections. The lower infection rates in Chinese might be attributed to their greater emphasis on collective responsibility and community health, which have helped to encourage adherence to public health guidelines and prevent the spread of the virus, while white British individuals appear to be less likely to adhere to recommended COVID-19 related health behaviours compared to other ethnic groups <a href="https://www.iser.essex.ac.uk/blog/" class="external-link">https://www.iser.essex.ac.uk/blog/2021/06/14/are-there-ethnic-differences-in-adherence-to-recommended-health-behaviours-related-to-covid-19</a>.</p>
<p>Neighborhoods with a greater percentage of adults aged 65 and older, and those with a greater percentage of adults aged 18-29, were found to have a lower risk of infections, while the populations between 30 and 44 years old, and between 45 and 64 years old, were positively associated with the risk of infections. These findings may be explained from aspects of vaccination rates, lifestyle and health status. For example, older people are among the first groups to be prioritized for COVID-19 vaccination in the UK, leading to lower COVID infection rates. Young adults (aged 18-29) may be more likely to comply with public health guidelines and regulations, such as social distancing and wearing masks, to to avoid exposure to the virus. Additionally, younger adults are more likely to have jobs that allow them to work from home, reducing their exposure to the virus in public spaces. Conversely, middle-aged adults (aged 45-64 years old) may be more likely to work in essential jobs that require them to interact with the public, increasing their exposure to the virus.</p>
<p>Elevated <span class="math inline">\(\text{PM}_{2.5}\)</span> and <span class="math inline">\(\text{NO}_2\)</span> levels were also found to be positively associated with COVID-19 infections. Exposure to air pollution can cause inflammation and damage to the respiratory system, which may increase susceptibility to respiratory infections such as COVID-19 (<span class="citation">Fattorini and Regoli (<a href="#ref-fattorini2020role" role="doc-biblioref">2020</a>)</span>, <span class="citation">Comunian et al. (<a href="#ref-comunian2020air" role="doc-biblioref">2020</a>)</span>). Air pollution has been shown to worsen underlying health conditions such as diabetes, cardiovascular, and respiratory diseases, which are known risk factors for severe illness from COVID-19 (<span class="citation">Semczuk-Kaczmarek et al. (<a href="#ref-semczuk2021association" role="doc-biblioref">2021</a>)</span>).</p>
<p>It is important to note that the relationship between COVID-19 infection risk and race, age, air pollution and socioeconomic status is complex and multifactorial. While the results showed that the risk factors considered in the study have a well-established relationship with COVID-19 infections, there is not necessarily a causal relationship. More research is needed to understand the mechanisms behind these associations. Nonetheless, these findings suggest that targeted interventions for specific age and race groups may be necessary to control the spread of COVID-19 in different neighborhoods, and reducing air pollution levels could be an important public health intervention for mitigating the spread of COVID-19.</p>
<p>Our analysis has highlighted the associations between COVID-19 infection and a set of socioeconomic, demographic and environmental factors. There are several areas for future work that could further expand our understanding of the spread and evolution of COVID-19. It would be beneficial to extend the study period to include more recent data in order to examine any potential changes in the associations between COVID-19 risk and the various factors identified in the study. The analysis can be extended to examine the impacts of other potential factors, such as comorbidities and COVID-19 vaccination rates, that may contribute to the spread of COVID-19. Including these factors in future studies could provide a more comprehensive understanding of the determinants of COVID-19 risk. Such information is useful for policy makers in determining the most effective strategies for controlling the spread of COVID-19 and reducing health inequalities in England. Finally, it would be important to extend the study to other countries and regions to examine whether the results from this study are generalizable to other settings. This could provide valuable insights into the global spread of COVID-19 and inform the development of more effective strategies and targeted actions for preventing the spread of the virus.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-akinwumiju2022geospatial" class="csl-entry">
Akinwumiju, Akinola S, Olawale Oluwafemi, Yahaya D Mohammed, and Jacob W Mobolaji. 2022. <span>“Geospatial Evaluation of COVID-19 Mortality: Influence of Socio-Economic Status and Underlying Health Conditions in Contiguous USA.”</span> <em>Applied Geography</em> 141: 102671.
</div>
<div id="ref-al2021demographic" class="csl-entry">
Al Kindi, Khalifa M, Adhra Al-Mawali, Amira Akharusi, Duhai Alshukaili, Noura Alnasiri, Talal Al-Awadhi, Yassine Charabi, and Ahmed M El Kenawy. 2021. <span>“Demographic and Socioeconomic Determinants of COVID-19 Across Oman-a Geospatial Modelling Approach.”</span> <em>Geospatial Health</em> 16 (1).
</div>
<div id="ref-berg2021long" class="csl-entry">
Berg, Kevin, Paul Romer Present, and Kristy Richardson. 2021. <span>“Long-Term Air Pollution and Other Risk Factors Associated with COVID-19 at the Census Tract Level in Colorado.”</span> <em>Environmental Pollution</em> 287: 117584.
</div>
<div id="ref-choi2021studying" class="csl-entry">
Choi, Kate H, Patrick Denice, Michael Haan, and Anna Zajacova. 2021. <span>“Studying the Social Determinants of COVID-19 in a Data Vacuum.”</span> <em>Canadian Review of Sociology/Revue Canadienne de Sociologie</em> 58 (2): 146–64.
</div>
<div id="ref-comunian2020air" class="csl-entry">
Comunian, Silvia, Dario Dongo, Chiara Milani, and Paola Palestini. 2020. <span>“Air Pollution and COVID-19: The Role of Particulate Matter in the Spread and Increase of COVID-19’s Morbidity and Mortality.”</span> <em>International Journal of Environmental Research and Public Health</em> 17 (12): 4487.
</div>
<div id="ref-fattorini2020role" class="csl-entry">
Fattorini, Daniele, and Francesco Regoli. 2020. <span>“Role of the Chronic Air Pollution Levels in the Covid-19 Outbreak Risk in Italy.”</span> <em>Environmental Pollution</em> 264: 114732.
</div>
<div id="ref-harris2021measuring" class="csl-entry">
Harris, Richard, and Chris Brunsdon. 2021. <span>“Measuring the Exposure of Black, Asian and Other Ethnic Groups to COVID-Infected Neighbourhoods in English Towns and Cities.”</span> <em>Applied Spatial Analysis and Policy</em>, 1–26.
</div>
<div id="ref-kim2021covid" class="csl-entry">
Kim, Byoungjun, Andrew G Rundle, Alicia T Singham Goodwin, Christopher N Morrison, Charles C Branas, Wafaa El-Sadr, and Dustin T Duncan. 2021. <span>“COVID-19 Testing, Case, and Death Rates and Spatial Socio-Demographics in New York City: An Ecological Analysis as of June 2020.”</span> <em>Health &amp; Place</em> 68: 102539.
</div>
<div id="ref-kulu2021infection" class="csl-entry">
Kulu, Hill, and Peter Dorey. 2021. <span>“Infection Rates from Covid-19 in Great Britain by Geographical Units: A Model-Based Estimation from Mortality Data.”</span> <em>Health &amp; Place</em> 67: 102460.
</div>
<div id="ref-lee2022quantifying" class="csl-entry">
Lee, Duncan, Chris Robertson, Carole McRae, and Jessica Baker. 2022. <span>“Quantifying the Impact of Air Pollution on Covid-19 Hospitalisation and Death Rates in Scotland.”</span> <em>Spatial and Spatio-Temporal Epidemiology</em> 42: 100523.
</div>
<div id="ref-lindgren2015bayesian" class="csl-entry">
Lindgren, Finn, and Håvard Rue. 2015. <span>“Bayesian Spatial Modelling with r-INLA.”</span> <em>Journal of Statistical Software</em> 63: 1–25.
</div>
<div id="ref-mecenas2020effects" class="csl-entry">
Mecenas, Paulo, Renata Travassos da Rosa Moreira Bastos, Antonio Carlos Rosário Vallinoto, and David Normando. 2020. <span>“Effects of Temperature and Humidity on the Spread of COVID-19: A Systematic Review.”</span> <em>PLoS One</em> 15 (9): e0238339.
</div>
<div id="ref-oluyomi2021covid" class="csl-entry">
Oluyomi, Abiodun O, Sarah M Gunter, Lauren M Leining, Kristy O Murray, and Chris Amos. 2021. <span>“COVID-19 Community Incidence and Associated Neighborhood-Level Characteristics in Houston, Texas, USA.”</span> <em>International Journal of Environmental Research and Public Health</em> 18 (4): 1495.
</div>
<div id="ref-semczuk2021association" class="csl-entry">
Semczuk-Kaczmarek, Karolina, Anna Rys-Czaporowska, Janusz Sierdzinski, Lukasz Dominik Kaczmarek, Filip Marcin Szymanski, and Anna Edyta Platek. 2021. <span>“Association Between Air Pollution and COVID-19 Mortality and Morbidity.”</span> <em>Internal and Emergency Medicine</em>, 1–7.
</div>
<div id="ref-sun2021spatial" class="csl-entry">
Sun, Yeran, Xuke Hu, and Jing Xie. 2021. <span>“Spatial Inequalities of COVID-19 Mortality Rate in Relation to Socioeconomic and Environmental Factors Across England.”</span> <em>Science of the Total Environment</em> 758: 143595.
</div>
<div id="ref-wang2021impact" class="csl-entry">
Wang, Jingyuan, Ke Tang, Kai Feng, Xin Lin, Weifeng Lv, Kun Chen, and Fei Wang. 2021. <span>“Impact of Temperature and Relative Humidity on the Transmission of COVID-19: A Modelling Study in China and the United States.”</span> <em>BMJ Open</em> 11 (2): e043863.
</div>
<div id="ref-wang2020high" class="csl-entry">
Wang, Jingyuan, Ke Tang, Kai Feng, Weifeng Lv, et al. 2020. <span>“High Temperature and High Humidity Reduce the Transmission of COVID-19.”</span> <em>Available at SSRN</em> 3551767: 2020b.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Gareth Jones, Sam Royston, Xueqing Yin, John Aiken, Jonathan Bamber.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
