<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="fdmr">
<title>Data preprocessing • fdmr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Data preprocessing">
<meta property="og:description" content="fdmr">
<meta property="og:image" content="https://4dmodeller.github.io/fdmr/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">fdmr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-tutorials">Tutorials</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-tutorials">
    <a class="dropdown-item" href="../articles/covid.html">COVID-19</a>
    <a class="dropdown-item" href="../articles/covid_mcmc.html">COVID-19 MCMC</a>
    <a class="dropdown-item" href="../articles/covid_ST_mcmc.html">COVID-19 MCMC (Space-time)</a>
    <a class="dropdown-item" href="../articles/hydro.html">Hydrology</a>
    <a class="dropdown-item" href="../articles/priors.html"></a>
    <a class="dropdown-item" href="../articles/mapping.html">Mapping</a>
    <a class="dropdown-item" href="../articles/meshbuilder.html">Meshing</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://4dmodeller.github.io/4DM_Hackathon/">Hackathon</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/4DModeller/fdmr/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Data preprocessing</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/4DModeller/fdmr/blob/HEAD/vignettes/data_preprocessing.Rmd" class="external-link"><code>vignettes/data_preprocessing.Rmd</code></a></small>
      <div class="d-none name"><code>data_preprocessing.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="aim-and-data-description">Aim and data description<a class="anchor" aria-label="anchor" href="#aim-and-data-description"></a>
</h2>
<p>In this tutorial, we will provide a short tutorial about data
pre-processing, which involves transforming raw data into the desired
format and object for running the Bayesian Hierarchical Model (BHM) in
the fdmr package. To illustrate the process, we will use COVID-19
infection data as a practical example.</p>
<p>In the <a href="https://4dmodeller.github.io/fdmr/articles/covid.html">COVID-19
tutorial</a>, we aim to fit a Bayesian spatio-temporal model to predict
the COVID-19 infection rates across mainland England over space and
time, and investigate the impacts of socioeconomic, demographic and
environmental factors on COVID-19 infection. The study region is
mainland England, which is partitioned into 6789 Middle Layer Super
Output Areas (MSOAs). The raw shapefile of the study region is obtained
from the <a href="https://geoportal.statistics.gov.uk/datasets/ons::msoa-dec-2011-boundaries-super-generalised-clipped-bsc-ew-v3/explore?location=52.782096%2C-2.465779%2C7.81" class="external-link">ONS
Open Geography Portal</a>, which stores the location, shape and
attributes of geographic features for the MSOAs.</p>
<p>First we’ll retrieve the tutorial dataset
<code>preprocessing</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">fdmr</span><span class="fu">::</span><span class="fu"><a href="../reference/retrieve_tutorial_data.html">retrieve_tutorial_data</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="st">"preprocessing"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Tutorial data extracted to  /home/runner/fdmr/tutorial_data/preprocessing</span></span></code></pre>
<p>Then we load in the shapefile into R, and store it in an object named
<code>sp_data</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">shapefilepath</span> <span class="op">&lt;-</span> <span class="fu">fdmr</span><span class="fu">::</span><span class="fu"><a href="../reference/get_tutorial_datapath.html">get_tutorial_datapath</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="st">"preprocessing"</span>, filename <span class="op">=</span> <span class="st">"MSOA_(Dec_2011)_Boundaries_Super_Generalised_Clipped_(BSC)_EW_V3.shp"</span><span class="op">)</span></span>
<span><span class="va">sp_data</span> <span class="op">&lt;-</span> <span class="fu">rgdal</span><span class="fu">::</span><span class="fu"><a href="http://rgdal.r-forge.r-project.org/reference/rgdal-deprecated.html" class="external-link">readOGR</a></span><span class="op">(</span>dsn <span class="op">=</span> <span class="va">shapefilepath</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## The legacy packages maptools, rgdal, and rgeos, underpinning the sp package,</span></span>
<span><span class="co">## which was just loaded, will retire in October 2023.</span></span>
<span><span class="co">## Please refer to R-spatial evolution reports for details, especially</span></span>
<span><span class="co">## https://r-spatial.org/r/2023/05/15/evolution4.html.</span></span>
<span><span class="co">## It may be desirable to make the sf package available;</span></span>
<span><span class="co">## package maintainers should consider adding sf to Suggests:.</span></span>
<span><span class="co">## The sp package is now running under evolution status 2</span></span>
<span><span class="co">##      (status 2 uses the sf package in place of rgdal)</span></span></code></pre>
<pre><code><span><span class="co">## Please note that rgdal will be retired during October 2023,</span></span>
<span><span class="co">## plan transition to sf/stars/terra functions using GDAL and PROJ</span></span>
<span><span class="co">## at your earliest convenience.</span></span>
<span><span class="co">## See https://r-spatial.org/r/2023/05/15/evolution4.html and https://github.com/r-spatial/evolution</span></span>
<span><span class="co">## rgdal: version: 1.6-7, (SVN revision 1203)</span></span>
<span><span class="co">## Geospatial Data Abstraction Library extensions to R successfully loaded</span></span>
<span><span class="co">## Loaded GDAL runtime: GDAL 3.4.1, released 2021/12/27</span></span>
<span><span class="co">## Path to GDAL shared files: /usr/share/gdal</span></span>
<span><span class="co">## GDAL binary built with GEOS: TRUE </span></span>
<span><span class="co">## Loaded PROJ runtime: Rel. 8.2.1, January 1st, 2022, [PJ_VERSION: 821]</span></span>
<span><span class="co">## Path to PROJ shared files: /home/runner/.local/share/proj:/usr/share/proj</span></span>
<span><span class="co">## PROJ CDN enabled: FALSE</span></span>
<span><span class="co">## Linking to sp version:2.0-0</span></span>
<span><span class="co">## To mute warnings of possible GDAL/OSR exportToProj4() degradation,</span></span>
<span><span class="co">## use options("rgdal_show_exportToProj4_warnings"="none") before loading sp or rgdal.</span></span></code></pre>
<pre><code><span><span class="co">## OGR data source with driver: ESRI Shapefile </span></span>
<span><span class="co">## Source: "/home/runner/fdmr/tutorial_data/preprocessing/MSOA_(Dec_2011)_Boundaries_Super_Generalised_Clipped_(BSC)_EW_V3.shp", layer: "MSOA_(Dec_2011)_Boundaries_Super_Generalised_Clipped_(BSC)_EW_V3"</span></span>
<span><span class="co">## with 7201 features</span></span>
<span><span class="co">## It has 11 fields</span></span></code></pre>
<p>The type of the object <code>sp_data</code> is a
SpatialPolygonsDataFrame.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">sp_data</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "SpatialPolygonsDataFrame"</span></span>
<span><span class="co">## attr(,"package")</span></span>
<span><span class="co">## [1] "sp"</span></span></code></pre>
<p>Then we retrieve the projection attributes of the shapefile, i.e.,
<code>sp_data</code>, and transform it from its original coordinate
reference system (CRS) to a new CRS, which is the World Geodetic System
1984 (WGS84).</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">sp</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/sp/man/is.projected.html" class="external-link">proj4string</a></span><span class="op">(</span><span class="va">sp_data</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "+proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717 +x_0=400000 +y_0=-100000 +ellps=airy +units=m +no_defs"</span></span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sp_data</span> <span class="op">&lt;-</span> <span class="fu">sp</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/sp/man/spTransform.html" class="external-link">spTransform</a></span><span class="op">(</span><span class="va">sp_data</span>, <span class="fu">sp</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/sp/man/CRS-class.html" class="external-link">CRS</a></span><span class="op">(</span><span class="st">"+proj=longlat +datum=WGS84 +no_defs"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: PROJ support is provided by the sf and terra packages among others</span></span></code></pre>
<p>In the COVID-19 tutorial, the raw COVID-19 infections data and the
related covariate data were obtained from the official UK Government
COVID-19 dashboard and the Office for National Statistics (ONS). The
data were initially downloaded, organised and saved in a CSV file
format. The CSV file can be imported into R using the
<code><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">utils::read.csv()</a></code> function.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">covid19_data_filepath</span> <span class="op">&lt;-</span> <span class="fu">fdmr</span><span class="fu">::</span><span class="fu"><a href="../reference/get_tutorial_datapath.html">get_tutorial_datapath</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="st">"preprocessing"</span>, filename <span class="op">=</span> <span class="st">"covid19_data.csv"</span><span class="op">)</span></span>
<span><span class="va">covid19_data</span> <span class="op">&lt;-</span> <span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="va">covid19_data_filepath</span><span class="op">)</span></span></code></pre></div>
<p>The type of the object <code>covid19_data</code> is a data.frame.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">covid19_data</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "data.frame"</span></span></code></pre>
<p>The first 6 rows of the data set can be viewed using the following
code</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">covid19_data</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    MSOA11CD     date week     LONG      LAT cases Population   IMD</span></span>
<span><span class="co">## 1 E02002415 1/1/2022    1 -1.54813 53.77558    57       7698 68.39</span></span>
<span><span class="co">## 2 E02002391 1/1/2022    1 -1.66579 53.80466   203       7380 20.85</span></span>
<span><span class="co">## 3 E02002377 1/1/2022    1 -1.51938 53.81505    78       7955 52.34</span></span>
<span><span class="co">## 4 E02002431 1/1/2022    1 -1.58525 53.74190   204       8366 27.40</span></span>
<span><span class="co">## 5 E02002998 1/1/2022    1 -2.37911 51.37245    77       6023 12.12</span></span>
<span><span class="co">## 6 E02002999 1/1/2022    1 -2.39800 51.37034    83       5597 19.13</span></span>
<span><span class="co">##   carebeds.ratio AandETRUE perc.chinese perc.indian perc.bangladeshi</span></span>
<span><span class="co">## 1    0.000000000         0    0.7112918    1.041534      12.66353360</span></span>
<span><span class="co">## 2    0.014004309         0    0.4419192    1.022727       0.01262626</span></span>
<span><span class="co">## 3    0.001402525         0    0.6257489    3.608042      20.48994808</span></span>
<span><span class="co">## 4    0.003969340         0    1.0094136    2.302370       0.01134173</span></span>
<span><span class="co">## 5    0.013117143         0    1.3052209    1.857430       0.31793842</span></span>
<span><span class="co">## 6    0.000000000         0    1.1537096    1.100461       0.65672701</span></span>
<span><span class="co">##   perc.pakistani    perc.ba   perc.bc   perc.wb     age1     age2     age3</span></span>
<span><span class="co">## 1     22.8883526 18.4554808 1.4098819 20.157500 21.17433 23.13588 19.32970</span></span>
<span><span class="co">## 2      0.5808081  1.1237374 0.1262626 91.136364 15.01355 21.31436 26.76152</span></span>
<span><span class="co">## 3     27.7592864  9.8655306 4.2604181  9.253095 21.87304 22.95412 16.07794</span></span>
<span><span class="co">## 4      0.7258705  1.4630827 0.3515935 85.210389 17.77432 21.92207 24.98207</span></span>
<span><span class="co">## 5      0.1171352  0.6860776 0.4685408 80.722892 38.53561 14.36161 18.61199</span></span>
<span><span class="co">## 6      0.1597444  0.3727370 0.3727370 84.700035 18.31338 18.59925 23.36966</span></span>
<span><span class="co">##        age4     pm25       no2</span></span>
<span><span class="co">## 1  5.520915 8.909063 18.108010</span></span>
<span><span class="co">## 2 16.463415 7.430964 15.525150</span></span>
<span><span class="co">## 3  6.712759 7.913701 18.095600</span></span>
<span><span class="co">## 4 13.387521 7.540963 16.344490</span></span>
<span><span class="co">## 5 13.132990 7.082593  7.628312</span></span>
<span><span class="co">## 6 19.403252 6.926548  7.073514</span></span></code></pre>
<p>The data frame contains 23 columns. <code>MSOA11CD</code> represents
the spatial identifier for each data observation. Variable
<code>cases</code> is the response variable, which is the weekly
reported number of COVID-19 cases in each of the 6789 MSOAs in main
England over the period from 2022-01-01 to 2022-03-26. Variable
<code>date</code> indicates the start date of each observation week when
the COVID-19 infections data for each MSOA were reported. Variable
<code>week</code> indicates the week index number that each data
observation was collected from. Columns <code>LONG</code> and
<code>LAT</code> indicate the longitude and latitude for each MSOA.
Variable <code>Population</code> indicates the population size for each
MSOA. The remaining columns store the data for each covariate in each
MSOA and week.</p>
<p>Therefore, the expected observation and measurement data format for a
spatio-temporal Bayesian hierarchical model as in the COVID-19 tutorial
should be a data frame that includes one column for the response data
(e.g., <code>cases</code>), two columns for the spatial location of each
observation (e.g., <code>LONG</code> and <code>LAT</code>), and one
column containing time point indices indicating when each observation
was collected (e.g., <code>week</code> = 1, 2, …). If the model
incorporates covariates, then the covariate data should also be included
in the same data frame, and each covariate is stored in one column.
Users can use any variable names for the columns, as long as they ensure
consistency with those used when defining the model formula and fitting
the model.</p>
<p>With <code>sp_data</code> and <code>covid19_data</code> in the
expected data object and format, we now possess all the essential
information required for the fitting the BHM and visualising the
results. More details regarding the model fitting process can be found
at in the <a href="https://4dmodeller.github.io/fdmr/articles/covid.html">COVID-19
tutorial</a>.</p>
</div>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://github.com/gareth-j/" class="external-link">Gareth Jones</a>, <a href="https://www.researchgate.net/profile/Xueqing_Yin" class="external-link">Xueqing Yin</a>, <a href="https://mnky9800n.github.io/" class="external-link">John Aiken</a>, Jonathan Bamber.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
