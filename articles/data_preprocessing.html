<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Data pre-processing • fdmr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Data pre-processing">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">fdmr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-tutorials" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Tutorials</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-tutorials">
<li><h6 class="dropdown-header" data-toc-skip>Getting started</h6></li>
    <li><a class="dropdown-item" href="../articles/getting_started.html">Installation</a></li>
    <li><a class="dropdown-item" href="../articles/data_preprocessing.html">Data pre-processing</a></li>
    <li><a class="dropdown-item" href="../articles/expected_data_structure.html">Expected data structure</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>End to end tutorials</h6></li>
    <li><a class="dropdown-item" href="../articles/decision_tree.html">How to choose how to model</a></li>
    <li><a class="dropdown-item" href="../articles/simulation_gaussian_data.html">Simulation Tutorial (Gaussian data)</a></li>
    <li><a class="dropdown-item" href="../articles/simulation_poisson_data.html">Simulation Tutorial (Poisson data)</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Shiny apps</h6></li>
    <li><a class="dropdown-item" href="../articles/meshbuilder.html">Mesh building</a></li>
    <li><a class="dropdown-item" href="../articles/modelbuilder.html">Model builder</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>In depth tutorials</h6></li>
    <li><a class="dropdown-item" href="../articles/covid.html">COVID-19</a></li>
    <li><a class="dropdown-item" href="../articles/covid_mcmc.html">COVID-19 MCMC</a></li>
    <li><a class="dropdown-item" href="../articles/covid_ST_mcmc.html">COVID-19 MCMC (Space-time)</a></li>
    <li><a class="dropdown-item" href="../articles/hydro.html">Hydrology</a></li>
    <li><a class="dropdown-item" href="../articles/priors.html">Priors exploration</a></li>
    <li><a class="dropdown-item" href="../articles/ohc_tutorial.html">Ocean heat content mapping</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>FAQ</h6></li>
    <li><a class="dropdown-item" href="../articles/inla_FAQ.html">INLA Crash FAQ</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://4dmodeller.github.io/4DM_Hackathon/">Hackathon</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/4DModeller/fdmr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Data pre-processing</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/4DModeller/fdmr/blob/main/vignettes/data_preprocessing.Rmd" class="external-link"><code>vignettes/data_preprocessing.Rmd</code></a></small>
      <div class="d-none name"><code>data_preprocessing.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="aim-and-data-description">Aim and data description<a class="anchor" aria-label="anchor" href="#aim-and-data-description"></a>
</h2>
<p>In this tutorial, we will provide a short tutorial about data
pre-processing, which involves transforming raw data into the desired
format and object for running the Bayesian Hierarchical Model (BHM) in
the fdmr package. To illustrate the process, we will use COVID-19
infection data as a practical example.</p>
<p>In the <a href="https://4dmodeller.github.io/fdmr/articles/covid.html">COVID-19
tutorial</a>, we aim to fit a Bayesian spatio-temporal model to predict
the COVID-19 infection rates across mainland England over space and
time, and investigate the impacts of socioeconomic, demographic and
environmental factors on COVID-19 infection. The study region is
mainland England, which is partitioned into 6789 Middle Layer Super
Output Areas (MSOAs). The raw shapefile of the study region is obtained
from the <a href="https://geoportal.statistics.gov.uk/datasets/ons::msoa-dec-2011-boundaries-super-generalised-clipped-bsc-ew-v3/explore?location=52.782096%2C-2.465779%2C7.81" class="external-link">ONS
Open Geography Portal</a>, which stores the location, shape and
attributes of geographic features for the MSOAs.</p>
<p>First we’ll retrieve the tutorial dataset
<code>preprocessing</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">fdmr</span><span class="fu">::</span><span class="fu"><a href="../reference/retrieve_tutorial_data.html">retrieve_tutorial_data</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="st">"preprocessing"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Tutorial data extracted to  /home/runner/fdmr/tutorial_data/preprocessing</span></span></code></pre>
<p>Then we load in the shapefile into R using <a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link"><code>sf::read_sf</code></a>,
and store it in an object named <code>sp_data</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">shapefilepath</span> <span class="op">&lt;-</span> <span class="fu">fdmr</span><span class="fu">::</span><span class="fu"><a href="../reference/get_tutorial_datapath.html">get_tutorial_datapath</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="st">"preprocessing"</span>, filename <span class="op">=</span> <span class="st">"MSOA_(Dec_2011)_Boundaries_Super_Generalised_Clipped_(BSC)_EW_V3.shp"</span><span class="op">)</span></span>
<span><span class="va">sp_data</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">read_sf</a></span><span class="op">(</span>dsn <span class="op">=</span> <span class="va">shapefilepath</span><span class="op">)</span></span></code></pre></div>
<p>The type of the object <code>sp_data</code> is <code>sf</code> which
behind the scenes is a <code>tibble_df</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">sp_data</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "sf"         "tbl_df"     "tbl"        "data.frame"</span></span></code></pre>
<p>Then we retrieve the projection attributes of the shapefile, i.e.,
<code>sp_data</code>, and transform it from its original coordinate
reference system (CRS) to a new CRS, which is the World Geodetic System
1984 (WGS84). Finally, we convert it to a
<code>SpatialPolygonsDataFrame</code> using <a href="https://r-spatial.github.io/sf/reference/coerce-methods.html" class="external-link"><code>sf::as_Spatial</code></a>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sp_data</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">sp_data</span>, <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="st">"+proj=longlat +datum=WGS84"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>In the COVID-19 tutorial, the raw COVID-19 infections data and the
related covariate data were obtained from the official UK Government
COVID-19 dashboard and the Office for National Statistics (ONS). The
data were initially downloaded, organised and saved in a CSV file
format. The CSV file can be imported into R using the
<code><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">utils::read.csv()</a></code> function.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">covid19_data_filepath</span> <span class="op">&lt;-</span> <span class="fu">fdmr</span><span class="fu">::</span><span class="fu"><a href="../reference/get_tutorial_datapath.html">get_tutorial_datapath</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="st">"preprocessing"</span>, filename <span class="op">=</span> <span class="st">"covid19_data.csv"</span><span class="op">)</span></span>
<span><span class="va">covid19_data</span> <span class="op">&lt;-</span> <span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="va">covid19_data_filepath</span><span class="op">)</span></span></code></pre></div>
<p>The type of the object <code>covid19_data</code> is a data.frame.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">covid19_data</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "data.frame"</span></span></code></pre>
<p>The first 6 rows of the data set can be viewed using the following
code</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">covid19_data</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    MSOA11CD     date week     LONG      LAT cases Population   IMD</span></span>
<span><span class="co">## 1 E02002415 1/1/2022    1 -1.54813 53.77558    57       7698 68.39</span></span>
<span><span class="co">## 2 E02002391 1/1/2022    1 -1.66579 53.80466   203       7380 20.85</span></span>
<span><span class="co">## 3 E02002377 1/1/2022    1 -1.51938 53.81505    78       7955 52.34</span></span>
<span><span class="co">## 4 E02002431 1/1/2022    1 -1.58525 53.74190   204       8366 27.40</span></span>
<span><span class="co">## 5 E02002998 1/1/2022    1 -2.37911 51.37245    77       6023 12.12</span></span>
<span><span class="co">## 6 E02002999 1/1/2022    1 -2.39800 51.37034    83       5597 19.13</span></span>
<span><span class="co">##   carebeds.ratio AandETRUE perc.chinese perc.indian perc.bangladeshi</span></span>
<span><span class="co">## 1    0.000000000         0    0.7112918    1.041534      12.66353360</span></span>
<span><span class="co">## 2    0.014004309         0    0.4419192    1.022727       0.01262626</span></span>
<span><span class="co">## 3    0.001402525         0    0.6257489    3.608042      20.48994808</span></span>
<span><span class="co">## 4    0.003969340         0    1.0094136    2.302370       0.01134173</span></span>
<span><span class="co">## 5    0.013117143         0    1.3052209    1.857430       0.31793842</span></span>
<span><span class="co">## 6    0.000000000         0    1.1537096    1.100461       0.65672701</span></span>
<span><span class="co">##   perc.pakistani    perc.ba   perc.bc   perc.wb     age1     age2     age3</span></span>
<span><span class="co">## 1     22.8883526 18.4554808 1.4098819 20.157500 21.17433 23.13588 19.32970</span></span>
<span><span class="co">## 2      0.5808081  1.1237374 0.1262626 91.136364 15.01355 21.31436 26.76152</span></span>
<span><span class="co">## 3     27.7592864  9.8655306 4.2604181  9.253095 21.87304 22.95412 16.07794</span></span>
<span><span class="co">## 4      0.7258705  1.4630827 0.3515935 85.210389 17.77432 21.92207 24.98207</span></span>
<span><span class="co">## 5      0.1171352  0.6860776 0.4685408 80.722892 38.53561 14.36161 18.61199</span></span>
<span><span class="co">## 6      0.1597444  0.3727370 0.3727370 84.700035 18.31338 18.59925 23.36966</span></span>
<span><span class="co">##        age4     pm25       no2</span></span>
<span><span class="co">## 1  5.520915 8.909063 18.108010</span></span>
<span><span class="co">## 2 16.463415 7.430964 15.525150</span></span>
<span><span class="co">## 3  6.712759 7.913701 18.095600</span></span>
<span><span class="co">## 4 13.387521 7.540963 16.344490</span></span>
<span><span class="co">## 5 13.132990 7.082593  7.628312</span></span>
<span><span class="co">## 6 19.403252 6.926548  7.073514</span></span></code></pre>
<p>The data frame contains 23 columns. <code>MSOA11CD</code> represents
the spatial identifier for each data observation. Variable
<code>cases</code> is the response variable, which is the weekly
reported number of COVID-19 cases in each of the 6789 MSOAs in main
England over the period from 2022-01-01 to 2022-03-26. Variable
<code>date</code> indicates the start date of each observation week when
the COVID-19 infections data for each MSOA were reported. Variable
<code>week</code> indicates the week index number that each data
observation was collected from. Columns <code>LONG</code> and
<code>LAT</code> indicate the longitude and latitude for each MSOA.
Variable <code>Population</code> indicates the population size for each
MSOA. The remaining columns store the data for each covariate in each
MSOA and week.</p>
<p>Therefore, the expected observation and measurement data format for a
spatio-temporal Bayesian hierarchical model as in the COVID-19 tutorial
should be a data frame that includes one column for the response
variable (e.g., <code>cases</code>), two columns for the spatial
location of each observation (e.g., <code>LONG</code> and
<code>LAT</code>), and one column containing time point indices
indicating when each observation was collected (e.g., <code>week</code>
= 1, 2, …). If the model incorporates covariates, then the covariate
data should also be included in the same data frame, and each covariate
is stored in one column. Users can use any variable names for the
columns, as long as they ensure consistency with those used when
defining the model formula and fitting the model. The following table
provides a summary of the expected data format for running the BHM in
the <code>fdmr</code> package:</p>
<table class="table">
<colgroup>
<col width="12%">
<col width="12%">
<col width="12%">
<col width="12%">
<col width="12%">
<col width="12%">
<col width="12%">
<col width="12%">
</colgroup>
<thead><tr class="header">
<th>ID</th>
<th>LONG</th>
<th>LAT</th>
<th>Time</th>
<th>Response Variable</th>
<th>Covariate 1</th>
<th>Covariate 2</th>
<th>Covariate…</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="even">
<td>2</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
</tbody>
</table>
<p>With <code>sp_data</code> and <code>covid19_data</code> in the
expected data object and format, we now possess all the essential
information required for the fitting the BHM and visualising the
results. More details regarding the model fitting process can be found
at in the <a href="https://4dmodeller.github.io/fdmr/articles/covid.html">COVID-19
tutorial</a>.</p>
</div>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/gareth-j/" class="external-link">Gareth Jones</a>, <a href="https://www.researchgate.net/profile/Xueqing_Yin" class="external-link">Xueqing Yin</a>, <a href="https://mnky9800n.github.io/" class="external-link">John Aiken</a>, Jonathan Bamber.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
