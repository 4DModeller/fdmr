<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Mapping Ocean Heat Content from Synthetic Observations in Indian Ocean • fdmr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Mapping Ocean Heat Content from Synthetic Observations in Indian Ocean">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">fdmr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-tutorials" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Tutorials</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-tutorials">
<li><h6 class="dropdown-header" data-toc-skip>Getting started</h6></li>
    <li><a class="dropdown-item" href="../articles/getting_started.html">Installation</a></li>
    <li><a class="dropdown-item" href="../articles/data_preprocessing.html">Data pre-processing</a></li>
    <li><a class="dropdown-item" href="../articles/expected_data_structure.html">Expected data structure</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>End to end tutorials</h6></li>
    <li><a class="dropdown-item" href="../articles/decision_tree.html">How to choose how to model</a></li>
    <li><a class="dropdown-item" href="../articles/simulation_gaussian_data.html">Simulation Tutorial (Gaussian data)</a></li>
    <li><a class="dropdown-item" href="../articles/simulation_poisson_data.html">Simulation Tutorial (Poisson data)</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Shiny apps</h6></li>
    <li><a class="dropdown-item" href="../articles/meshbuilder.html">Mesh building</a></li>
    <li><a class="dropdown-item" href="../articles/modelbuilder.html">Model builder</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>In depth tutorials</h6></li>
    <li><a class="dropdown-item" href="../articles/covid.html">COVID-19</a></li>
    <li><a class="dropdown-item" href="../articles/covid_mcmc.html">COVID-19 MCMC</a></li>
    <li><a class="dropdown-item" href="../articles/covid_ST_mcmc.html">COVID-19 MCMC (Space-time)</a></li>
    <li><a class="dropdown-item" href="../articles/hydro.html">Hydrology</a></li>
    <li><a class="dropdown-item" href="../articles/priors.html">Priors exploration</a></li>
    <li><a class="dropdown-item" href="../articles/ohc_tutorial.html">Ocean heat content mapping</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>FAQ</h6></li>
    <li><a class="dropdown-item" href="../articles/inla_FAQ.html">INLA Crash FAQ</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://4dmodeller.github.io/4DM_Hackathon/">Hackathon</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/4DModeller/fdmr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Mapping Ocean Heat Content from Synthetic Observations in Indian Ocean</h1>
                        <h4 data-toc-skip class="author">Anrijs Abele,
Colin Morice, Man Ho Suen, Geoffrey Dawson</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/4DModeller/fdmr/blob/main/vignettes/ohc_tutorial.Rmd" class="external-link"><code>vignettes/ohc_tutorial.Rmd</code></a></small>
      <div class="d-none name"><code>ohc_tutorial.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Knowledge of the spatio-temporal evolution of ocean heat content
(OHC) is essential to our understanding of both past and future climate
change. At global scales, ocean heat uptake is a key element of the
global energy and sea level budgets and provides a powerful constraint
on climate sensitivity and past climate forcings. At regional scales,
OHC changes are important to our understanding of climate variability
and for the development, initialization, and evaluation of
seasonal-to-decadal prediction systems.</p>
<p>The world’s oceans have a huge volume so even small changes in
temperature can correspond to large changes in energy. 90% of the excess
energy trapped in the earth system by anthropogenic greenhouse gas
emissions goes into the oceans <span class="citation">(<a href="#ref-trenberth2014inbalance">Trenberth et al., 2014</a>)</span>.
The Indian Ocean serves as a significant reservoir of this extra energy,
despite its relatively small area <span class="citation">(<a href="#ref-duan2023storage">Duan et al., 2023</a>)</span>. <span class="citation">Desbruyères et al. (<a href="#ref-desbruyeres2017trends">2017</a>)</span> found that half of
the global top-layer (&lt;700 m) heat uptake is in the Indian Ocean.</p>
<div class="section level3">
<h3 id="measuring-ocean-heat-content">Measuring Ocean Heat Content<a class="anchor" aria-label="anchor" href="#measuring-ocean-heat-content"></a>
</h3>
<p>To measure heat content, we measure temperatures through the whole
volume of the upper oceans, with measurements at different depths as
well as at different locations.</p>
<p>Historically, measurement of ocean temperature at depth have been
obtained obtained using a range of instrument deployed from ships. More
recently, since the early 2000s, autonomous robotic floats, known as
Argo floats, have greatly increased the number of available observations
of the upper 2000m of the world’s oceans. These data sources provide
profiles of ocean temperatures from the surface downwards.</p>
</div>
<div class="section level3">
<h3 id="tutorial-data-source">Tutorial Data Source<a class="anchor" aria-label="anchor" href="#tutorial-data-source"></a>
</h3>
<p>This tutorial uses data from the MapEval4OceanHeat (ME4OH) project.
The data are derived from a 1/10th of a degree latitude-longitude ocean
simulation that has been sub-sampled to real world observed locations.
While the synthetic profile data are intended to be used to benchmark
ocean heat mapping methods, the data are used in this tutorial as a case
study for application of 4DModeller to map ocean heat content.</p>
<p>In this tutorial, we will use point data of ocean heat for the upper
layers of the ocean provided in the ME4OH data files (integrated
temperature profiles from the surface down to a depth of 306.25 m,
multiplied by water density and heat capacity).</p>
<p>The tutorial will use data from the Indian Ocean region.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">INLA</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.inlabru.org" class="external-link">inlabru</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/edzer/sp/" class="external-link">sp</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">gridExtra</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://scales.r-lib.org" class="external-link">scales</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="loading-data">Loading Data<a class="anchor" aria-label="anchor" href="#loading-data"></a>
</h3>
<p>Here we load the Indian Ocean shapefile and dataset. We smooth the
boundary to make the mesh creation easier.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">fdmr</span><span class="fu">::</span><span class="fu"><a href="../reference/retrieve_tutorial_data.html">retrieve_tutorial_data</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="st">"ohc"</span>, force_update <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Tutorial data extracted to  /home/runner/fdmr/tutorial_data/ohc</span></span></code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load the dataset</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">fdmr</span><span class="fu">::</span><span class="fu"><a href="../reference/load_tutorial_data.html">load_tutorial_data</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="st">"ohc"</span>, filename <span class="op">=</span> <span class="st">"df_indian_ocean_2005.rds"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load the polygon</span></span>
<span><span class="va">ocean_sf</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">fdmr</span><span class="fu">::</span><span class="fu"><a href="../reference/load_tutorial_data.html">load_tutorial_data</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="st">"ohc"</span>, filename <span class="op">=</span> <span class="st">"indian_ocean.rds"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Deal with CRS and smooth the boundary with a buffer</span></span>
<span><span class="va">ocean_crs</span> <span class="op">&lt;-</span> <span class="fu">fmesher</span><span class="fu">::</span><span class="fu"><a href="https://inlabru-org.github.io/fmesher/reference/fm_crs.html" class="external-link">fm_crs</a></span><span class="op">(</span><span class="va">ocean_sf</span><span class="op">)</span> </span>
<span><span class="fu">fmesher</span><span class="fu">::</span><span class="fu"><a href="https://inlabru-org.github.io/fmesher/reference/fm_crs.html" class="external-link">fm_crs</a></span><span class="op">(</span><span class="va">ocean_sf</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">ocean_sf2</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_combine.html" class="external-link">st_union</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_buffer</a></span><span class="op">(</span><span class="va">ocean_sf</span>, <span class="fl">1.05</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We plot the smoothed Indian Ocean polygon to check if there are any
issues.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">ocean_sf2</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="ohc_tutorial_files/figure-html/polygonPlot-1.png" alt="Smoothed polygon" width="700" id="fig-polygonplot-1"><p class="caption">
Smoothed polygon
</p>
</div>
<p>Then we convert it into a <code>sp</code> object.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">fmesher</span><span class="fu">::</span><span class="fu"><a href="https://inlabru-org.github.io/fmesher/reference/fm_crs.html" class="external-link">fm_crs</a></span><span class="op">(</span><span class="va">ocean_sf</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">ocean_crs</span></span>
<span><span class="va">ocean_sp</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/coerce-methods.html" class="external-link">as_Spatial</a></span><span class="op">(</span><span class="va">ocean_sf</span><span class="op">)</span></span></code></pre></div>
<p>We regularly sample some points
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>20</mn><mo>×</mo><mn>20</mn></mrow><annotation encoding="application/x-tex">20\times 20</annotation></semantics></math>)
to put in the mesh builder function under the <code>fdmr</code> package
to get a feeling of the parameter setting for the mesh.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ocean_pts</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_sample.html" class="external-link">st_sample</a></span><span class="op">(</span><span class="va">ocean_sf</span>, size <span class="op">=</span> <span class="fl">20</span><span class="op">*</span><span class="fl">20</span>, </span>
<span>                           type <span class="op">=</span> <span class="st">"random"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ocean_pts_sp</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/coerce-methods.html" class="external-link">as_Spatial</a></span><span class="op">(</span><span class="va">ocean_pts</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">ocean_pts_sp</span><span class="op">@</span><span class="va">coords</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"LONG"</span>, <span class="st">"LAT"</span><span class="op">)</span></span></code></pre></div>
<p>Here comes the mesh_builder function. We set the max edge and offset
a bit larger to cater the computation.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">fdmr</span><span class="fu">::</span><span class="fu"><a href="../reference/mesh_builder.html">mesh_builder</a></span><span class="op">(</span>spatial_data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">ocean_pts_sp</span><span class="op">)</span>,</span>
<span>                   max_edge <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>,<span class="fl">100</span><span class="op">)</span>,</span>
<span>                   offset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>,<span class="fl">100</span><span class="op">)</span>,</span>
<span>                   cutoff <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>We create the outer boundary by extending the outer boundary.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ocean_bnd</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_cast.html" class="external-link">st_cast</a></span><span class="op">(</span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/sf.html" class="external-link">st_sf</a></span><span class="op">(</span>geometry <span class="op">=</span> <span class="fu">fmesher</span><span class="fu">::</span><span class="fu"><a href="https://inlabru-org.github.io/fmesher/reference/fm_nonconvex_hull.html" class="external-link">fm_nonconvex_hull</a></span><span class="op">(</span><span class="va">ocean_sf2</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span>, </span>
<span>  <span class="st">"POLYGON"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We create the mesh for the Indian Ocean with the outer boundary. We
remove Sri Lanka and keep Madagascar in the cutoff.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">boundary</span> <span class="op">&lt;-</span> <span class="fu">fmesher</span><span class="fu">::</span><span class="fu"><a href="https://inlabru-org.github.io/fmesher/reference/fm_as_segm.html" class="external-link">fm_as_segm_list</a></span><span class="op">(</span><span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">ocean_sf2</span>, <span class="va">ocean_bnd</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mesh</span> <span class="op">&lt;-</span> <span class="fu">fmesher</span><span class="fu">::</span><span class="fu"><a href="https://inlabru-org.github.io/fmesher/reference/fm_mesh_2d.html" class="external-link">fm_mesh_2d_inla</a></span><span class="op">(</span>boundary <span class="op">=</span> <span class="va">boundary</span>, </span>
<span>                                 max.edge <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">7</span><span class="op">)</span>, </span>
<span>                                 offset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span>, </span>
<span>                                 cutoff <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">me4pts</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">df</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lon"</span>, <span class="st">"lat"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">ocean_sf2</span><span class="op">)</span> <span class="op">+</span> <span class="fu">inlabru</span><span class="fu">::</span><span class="fu"><a href="https://inlabru-org.github.io/inlabru/reference/gg.html" class="external-link">gg</a></span><span class="op">(</span><span class="va">mesh</span><span class="op">)</span> <span class="op">+</span> <span class="fu">inlabru</span><span class="fu">::</span><span class="fu"><a href="https://inlabru-org.github.io/inlabru/reference/gg.html" class="external-link">gg</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">me4pts</span>, size<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.title.x<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.title.y<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="ohc_tutorial_files/figure-html/mesh-1.png" alt="Mesh with original polygon and all datapoints" width="700" id="fig-mesh-1"><p class="caption">
Mesh with original polygon and all datapoints
</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="model">Model<a class="anchor" aria-label="anchor" href="#model"></a>
</h2>
<p>We considered one year of top layer density of the OHC (between 0 and
306.25 m depth) in 2005. Observations are indexed by the month of
occurrence, resulting in 12 indices (equal to the number of time
points). To pass the data to the function, we converted the data frame
to an <code>sp</code> object.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Transform latitudes and longtiudes to numeric</span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">lat</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">lat</span>, <span class="va">as.numeric</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">lon</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">lon</span>, <span class="va">as.numeric</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add sp coordinates</span></span>
<span><span class="va">df_f</span> <span class="op">&lt;-</span> <span class="va">df</span></span>
<span><span class="fu">sp</span><span class="fu">::</span><span class="fu"><a href="https://edzer.github.io/sp/reference/coordinates.html" class="external-link">coordinates</a></span><span class="op">(</span><span class="va">df_f</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'lon'</span>, <span class="st">'lat'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Determine the group size</span></span>
<span><span class="va">n_time</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">df_f</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">time</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="prior-selection">Prior selection<a class="anchor" aria-label="anchor" href="#prior-selection"></a>
</h3>
<p>To implement the SPDE approach, we define the range un uncertainty
priors. We assume that the probability of process spatial range
(physically, a distance where the correlation between two observations
falls to 0.1) being under 25 degrees in latitude is 0.2. We also set the
probability to 0.01 that the marginal standard deviation of the process
exceeds 1.</p>
<p>The process is assumed to be evolving temporally as an autoregressive
process of the first order (AR1) with the probability of the temporal
autocorrelation parameter being over 0 at 0.9.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prior_range</span> <span class="op">&lt;-</span> <span class="fl">25</span></span>
<span><span class="va">prior_Pgt</span> <span class="op">&lt;-</span> <span class="fl">0.2</span></span>
<span>  </span>
<span><span class="co"># Define the SPDE</span></span>
<span><span class="va">ohc_spde</span> <span class="op">&lt;-</span> <span class="fu">INLA</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.spde2.pcmatern.html" class="external-link">inla.spde2.pcmatern</a></span><span class="op">(</span><span class="va">mesh</span>, prior.range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">prior_range</span>, <span class="va">prior_Pgt</span><span class="op">)</span>, prior.sigma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.01</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define temporal parameter</span></span>
<span><span class="va">rhoprior</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>theta <span class="op">=</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>prior <span class="op">=</span> <span class="st">'pccor1'</span>, param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.9</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="define-the-model-formula">Define the model formula<a class="anchor" aria-label="anchor" href="#define-the-model-formula"></a>
</h3>
<p>We use a spatio-temporal model with only random effects and without
an intercept.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_formula</span> <span class="op">&lt;-</span> <span class="va">dohc_L1</span> <span class="op">~</span> <span class="op">-</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/f.html" class="external-link">f</a></span><span class="op">(</span></span>
<span>  main <span class="op">=</span> <span class="va">coordinates</span>,</span>
<span>  model <span class="op">=</span> <span class="va">ohc_spde</span>,</span>
<span>  group <span class="op">=</span> <span class="va">time</span>,</span>
<span>  ngroup <span class="op">=</span> <span class="va">n_time</span>,</span>
<span>  control.group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    model <span class="op">=</span> <span class="st">'ar1'</span>,</span>
<span>    hyper <span class="op">=</span> <span class="va">rhoprior</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="fit-the-model">Fit the model<a class="anchor" aria-label="anchor" href="#fit-the-model"></a>
</h3>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bru_model</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">inlabru</span><span class="fu">::</span><span class="fu"><a href="https://inlabru-org.github.io/inlabru/reference/bru.html" class="external-link">bru</a></span><span class="op">(</span><span class="va">model_formula</span>,</span>
<span>               data <span class="op">=</span> <span class="va">df_f</span>, </span>
<span>               family <span class="op">=</span> <span class="st">"gaussian"</span>, </span>
<span>               options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>                 verbose <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                 bru_verbose <span class="op">=</span> <span class="fl">4</span></span>
<span>                 <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="output">Output<a class="anchor" aria-label="anchor" href="#output"></a>
</h2>
<p>The <code>model_viewer</code> of 4Dmodeller interactively shows the
hyperparameters and predicted random field from the <code>INLA</code>
model fit. In further sections, we also plot the mean and standard
deviation of the predicted field for March and October as well as the
measures of temporal evolution.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/model_viewer.html">model_viewer</a></span><span class="op">(</span>model_output <span class="op">=</span> <span class="va">bru_model</span>, mesh <span class="op">=</span> <span class="va">mesh</span>, measurement_data <span class="op">=</span> <span class="va">df_f</span>, data_distribution <span class="op">=</span> <span class="st">"Gaussian"</span><span class="op">)</span></span></code></pre></div>
<p>To estimate posterior statistics from the resampled model. We only
use a small number of samples – 100 (the default) – to reduce the
computational expanse. It is possible to use this function to also
re-estimate the model fit with a new set of values.</p>
<blockquote>
<p><strong><em>NOTE:</em></strong> It takes approximately 20 min
(depending on the hardware) to run the prediction. You can instead run
the consecutive cell to load the prediction already calculated by
us.</p>
</blockquote>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">bru_model</span>, n.samples <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></code></pre></div>
<p>If you decided to run the cell above, you do not need to run the cell
below.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu">fdmr</span><span class="fu">::</span><span class="fu"><a href="../reference/load_tutorial_data.html">load_tutorial_data</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="st">"ohc"</span>, filename <span class="op">=</span> <span class="st">"prediction_2005_L1.rds"</span><span class="op">)</span></span>
<span><span class="va">mesh</span> <span class="op">&lt;-</span> <span class="fu">fdmr</span><span class="fu">::</span><span class="fu"><a href="../reference/load_tutorial_data.html">load_tutorial_data</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="st">"ohc"</span>, filename <span class="op">=</span> <span class="st">"mesh.rds"</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="spatial-fields">Spatial fields<a class="anchor" aria-label="anchor" href="#spatial-fields"></a>
</h3>
<p>First, we prepare the results for plotting.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Add month to predictor</span></span>
<span><span class="co">## Number of mesh nodes</span></span>
<span><span class="va">mn</span> <span class="op">&lt;-</span> <span class="va">mesh</span><span class="op">$</span><span class="va">n</span></span>
<span></span>
<span><span class="co">## Append the month index to the predictor</span></span>
<span><span class="va">Predictor</span> <span class="op">&lt;-</span> <span class="va">pred</span><span class="op">$</span><span class="va">Predictor</span></span>
<span><span class="va">months</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>month <span class="op">=</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">12</span>,<span class="fl">1</span><span class="op">)</span>, each <span class="op">=</span> <span class="va">mn</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Predictor</span><span class="op">$</span><span class="va">month</span> <span class="op">&lt;-</span> <span class="va">months</span></span>
<span></span>
<span><span class="co">## Create a list for each month with mean values</span></span>
<span><span class="va">mthpred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">sdpred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">12</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">mthpred</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">Predictor</span><span class="op">$</span><span class="va">mean</span><span class="op">[</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="va">mn</span><span class="op">*</span><span class="op">(</span><span class="va">i</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">:</span><span class="op">(</span><span class="va">mn</span><span class="op">*</span><span class="va">i</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">sdpred</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">Predictor</span><span class="op">$</span><span class="va">sd</span><span class="op">[</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="va">mn</span><span class="op">*</span><span class="op">(</span><span class="va">i</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">:</span><span class="op">(</span><span class="va">mn</span><span class="op">*</span><span class="va">i</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Set the world map as a background</span></span>
<span><span class="va">wmap</span> <span class="op">&lt;-</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/map_data.html" class="external-link">map_data</a></span><span class="op">(</span><span class="st">"world"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Assign the map coordinate extrema</span></span>
<span><span class="va">mesh_lon_min</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">mesh</span><span class="op">$</span><span class="va">loc</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">mesh_lon_max</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">mesh</span><span class="op">$</span><span class="va">loc</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">mesh_lat_min</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">mesh</span><span class="op">$</span><span class="va">loc</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">mesh_lat_max</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">mesh</span><span class="op">$</span><span class="va">loc</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a mask that only accepts the points over the ocean</span></span>
<span></span>
<span><span class="co">## Mesh node coords to sf object</span></span>
<span><span class="va">mesh_sf</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>LAT <span class="op">=</span> <span class="va">mesh</span><span class="op">$</span><span class="va">loc</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, LONG <span class="op">=</span> <span class="va">mesh</span><span class="op">$</span><span class="va">loc</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"LONG"</span>, <span class="st">"LAT"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## The mask</span></span>
<span><span class="va">mask_ocean</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html" class="external-link">st_intersects</a></span><span class="op">(</span><span class="va">ocean_sf</span>, <span class="va">mesh_sf</span>, sparse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create the legend name</span></span>
<span><span class="va">title</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/bquote.html" class="external-link">bquote</a></span><span class="op">(</span><span class="st">"DOHC"</span> <span class="op">~</span> <span class="op">(</span><span class="va">TJ</span> <span class="op">~</span> <span class="va">m</span><span class="op">^</span><span class="op">-</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">title_diff</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/bquote.html" class="external-link">bquote</a></span><span class="op">(</span><span class="st">"dDOHC"</span> <span class="op">~</span> <span class="op">(</span><span class="va">TJ</span> <span class="op">~</span> <span class="va">m</span><span class="op">^</span><span class="op">-</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Then we plot the mean field for March and October.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mean_median</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">Predictor</span><span class="op">$</span><span class="va">mean</span><span class="op">[</span><span class="va">Predictor</span><span class="op">$</span><span class="va">month</span> <span class="op">==</span> <span class="fl">3</span><span class="op">]</span>, <span class="va">Predictor</span><span class="op">$</span><span class="va">mean</span><span class="op">[</span><span class="va">Predictor</span><span class="op">$</span><span class="va">month</span> <span class="op">==</span> <span class="fl">10</span><span class="op">]</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">mean_min</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">Predictor</span><span class="op">$</span><span class="va">mean</span><span class="op">[</span><span class="va">Predictor</span><span class="op">$</span><span class="va">month</span> <span class="op">==</span> <span class="fl">3</span><span class="op">]</span>, <span class="va">Predictor</span><span class="op">$</span><span class="va">mean</span><span class="op">[</span><span class="va">Predictor</span><span class="op">$</span><span class="va">month</span> <span class="op">==</span> <span class="fl">10</span><span class="op">]</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">mean_max</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">Predictor</span><span class="op">$</span><span class="va">mean</span><span class="op">[</span><span class="va">Predictor</span><span class="op">$</span><span class="va">month</span> <span class="op">==</span> <span class="fl">3</span><span class="op">]</span>, <span class="va">Predictor</span><span class="op">$</span><span class="va">mean</span><span class="op">[</span><span class="va">Predictor</span><span class="op">$</span><span class="va">month</span> <span class="op">==</span> <span class="fl">10</span><span class="op">]</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_march</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">inlabru</span><span class="fu">::</span><span class="fu"><a href="https://inlabru-org.github.io/inlabru/reference/gg.html" class="external-link">gg</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">mesh</span>, </span>
<span>              color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">Predictor</span><span class="op">$</span><span class="va">mean</span><span class="op">[</span><span class="va">Predictor</span><span class="op">$</span><span class="va">month</span> <span class="op">==</span> <span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span>              <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html" class="external-link">geom_polygon</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">wmap</span>, </span>
<span>                        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span><span class="op">)</span>, </span>
<span>                        fill <span class="op">=</span> <span class="st">'grey'</span>, </span>
<span>                        alpha <span class="op">=</span> <span class="fl">1.0</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">mesh_lon_min</span>, <span class="va">mesh_lon_max</span><span class="op">)</span>, </span>
<span>                       ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">mesh_lat_min</span>, <span class="va">mesh_lat_max</span><span class="op">)</span>, </span>
<span>                       expand <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Mean March"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradient2</a></span><span class="op">(</span>name <span class="op">=</span> <span class="va">title</span>, </span>
<span>                                low <span class="op">=</span> <span class="st">"blue"</span>,</span>
<span>                                high <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>                                midpoint <span class="op">=</span> <span class="va">mean_median</span>,</span>
<span>                                limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">mean_min</span>, <span class="va">mean_max</span><span class="op">)</span>,</span>
<span>                                oob <span class="op">=</span> <span class="va">squish</span></span>
<span>                                <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"bottom"</span>, </span>
<span>                 legend.key.width  <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">1.8</span>, <span class="st">"lines"</span><span class="op">)</span>,</span>
<span>                 plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>, </span>
<span>                 axis.title.x<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>                 axis.title.y<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>                 legend.title.align <span class="op">=</span> <span class="fl">0.5</span></span>
<span>                 <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span></span>
<span>    fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_colourbar.html" class="external-link">guide_colorbar</a></span><span class="op">(</span>title.position <span class="op">=</span> <span class="st">"left"</span>,</span>
<span>                          title.vjust <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                          title.hjust <span class="op">=</span> <span class="fl">1</span></span>
<span>                          <span class="op">)</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: The `legend.title.align` argument of `theme()` is deprecated as of ggplot2</span></span>
<span><span class="co">## 3.5.0.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Please use theme(legend.title = element_text(hjust)) instead.</span></span>
<span><span class="co">## <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span></span>
<span><span class="co">## <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span></span>
<span><span class="co">## <span style="color: #555555;">generated.</span></span></span></code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_october</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">inlabru</span><span class="fu">::</span><span class="fu"><a href="https://inlabru-org.github.io/inlabru/reference/gg.html" class="external-link">gg</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">mesh</span>, </span>
<span>              color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">Predictor</span><span class="op">$</span><span class="va">mean</span><span class="op">[</span><span class="va">Predictor</span><span class="op">$</span><span class="va">month</span> <span class="op">==</span> <span class="fl">10</span><span class="op">]</span><span class="op">)</span></span>
<span>              <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html" class="external-link">geom_polygon</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">wmap</span>, </span>
<span>                        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span><span class="op">)</span>, </span>
<span>                        fill <span class="op">=</span> <span class="st">'grey'</span>, </span>
<span>                        alpha <span class="op">=</span> <span class="fl">1.0</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">mesh_lon_min</span>, <span class="va">mesh_lon_max</span><span class="op">)</span>, </span>
<span>                       ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">mesh_lat_min</span>, <span class="va">mesh_lat_max</span><span class="op">)</span>, </span>
<span>                       expand <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Mean October"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradient2</a></span><span class="op">(</span>name <span class="op">=</span> <span class="va">title</span>, </span>
<span>                                low <span class="op">=</span> <span class="st">"blue"</span>,</span>
<span>                                high <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>                                midpoint <span class="op">=</span> <span class="va">mean_median</span>,</span>
<span>                                limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">mean_min</span>, <span class="va">mean_max</span><span class="op">)</span>,</span>
<span>                                oob <span class="op">=</span> <span class="va">squish</span></span>
<span>                                <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>, </span>
<span>                 legend.key.width  <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">1.8</span>, <span class="st">"lines"</span><span class="op">)</span>,</span>
<span>                 plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>, </span>
<span>                 axis.title.x<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>                 axis.title.y<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>                 legend.title.align <span class="op">=</span> <span class="fl">0.5</span></span>
<span>                 <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span></span>
<span>    fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_colourbar.html" class="external-link">guide_colorbar</a></span><span class="op">(</span>title.position <span class="op">=</span> <span class="st">"left"</span>,</span>
<span>                          title.vjust <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                          title.hjust <span class="op">=</span> <span class="fl">1</span></span>
<span>                          <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="fu">gridExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span><span class="va">plot_march</span>, <span class="va">plot_october</span>, ncol<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="ohc_tutorial_files/figure-html/meanPlots-1.png" alt="Mean field for L1 in 2005: (left) March, (right) October" width="768" id="fig-meanplots-1"><p class="caption">
Mean field for L1 in 2005: (left) March, (right) October
</p>
</div>
<p>The map reproduces main features of ocean circulation, including the
Subantarctic front (around
45–50<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mo>∘</mo></msup><annotation encoding="application/x-tex">^\circ</annotation></semantics></math>S
where a transition between blue and violet occurs) <span class="citation">(<a href="#ref-giglio2016subantarctic">Giglio &amp;
Johnson, 2016</a>; <a href="#ref-orsi1995acc">Orsi et al.,
1995</a>)</span>, Agulhas Current near southern African coast and
Agulhas Return Current emanating from it eastwards at
40<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mo>∘</mo></msup><annotation encoding="application/x-tex">^\circ</annotation></semantics></math>S
<span class="citation">(<a href="#ref-hood2024io">Hood et al.,
2024</a>)</span>. It also shows a region of increased OHC between
12<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mo>∘</mo></msup><annotation encoding="application/x-tex">^\circ</annotation></semantics></math>
and
26<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mo>∘</mo></msup><annotation encoding="application/x-tex">^\circ</annotation></semantics></math>S,
coinciding with the subtropical gyre <span class="citation">(<a href="#ref-phillips2024circulation">Philips et al., 2024</a>)</span>.
The maps show decreased upper-level OHC between
5<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mo>∘</mo></msup><annotation encoding="application/x-tex">^\circ</annotation></semantics></math>
and
10<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mo>∘</mo></msup><annotation encoding="application/x-tex">^\circ</annotation></semantics></math>S,
in particular, at the Seychelles-Chagos thermocline ridge (SCTR) <span class="citation">(<a href="#ref-hood2024io">Hood et al.,
2024</a>)</span>. Another centre of higher top-level OHC is in the
Arabian Sea while OHC is relatively lower in the Bay of Bengal <span class="citation">(<a href="#ref-huang2002eof">Huang &amp; Kinter,
2002</a>)</span>.</p>
<p>The differences between March and October are especially different in
the Arabian Sea. The western part of the basin and also at the Indian
coast has a lower OHC in March compared to October. Similarly, in Bay of
Bengal higher OHC appears in the central for October and the western
part in March. As expected, the heat content is relatively low due to
weaker mixing during inter-monsoon <span class="citation">(<a href="#ref-dandapat2021mld">Dandapat et al., 2021</a>)</span>. The
difference between March and October could also be explained by
increased riverine freshwater influx as well as precipitation and
cloudiness <span class="citation">(<a href="#ref-ali2018nio">Ali et al.,
2018</a>)</span> in October compared to March <span class="citation">(<a href="#ref-sandeep2018freshwater">Sandeep et al., 2018</a>)</span>,
which causes a reduction in the OHC storage immediately at the plume
area due to higher heat capacity of freshwater <span class="citation">(<a href="#ref-dandapat2020runoff">Dandapat et al.,
2020</a>)</span> and also where freshwater is advected <span class="citation">(<a href="#ref-jaishree2023seasdyn">Jaishree et al.,
2023</a>; <a href="#ref-zhang2023bengal">Zhang et al., 2023</a>)</span>
along the coastline.</p>
<p>Similarly, we show the standard deviation for March and October.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stdev_median</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">Predictor</span><span class="op">$</span><span class="va">sd</span><span class="op">[</span><span class="va">Predictor</span><span class="op">$</span><span class="va">month</span> <span class="op">==</span> <span class="fl">3</span><span class="op">]</span>, <span class="va">Predictor</span><span class="op">$</span><span class="va">sd</span><span class="op">[</span><span class="va">Predictor</span><span class="op">$</span><span class="va">month</span> <span class="op">==</span> <span class="fl">10</span><span class="op">]</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">stdev_max</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">Predictor</span><span class="op">$</span><span class="va">sd</span><span class="op">[</span><span class="va">Predictor</span><span class="op">$</span><span class="va">month</span> <span class="op">==</span> <span class="fl">3</span><span class="op">]</span>, <span class="va">Predictor</span><span class="op">$</span><span class="va">sd</span><span class="op">[</span><span class="va">Predictor</span><span class="op">$</span><span class="va">month</span> <span class="op">==</span> <span class="fl">10</span><span class="op">]</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">n_march</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">time</span> <span class="op">==</span> <span class="fl">3</span>, <span class="op">]</span><span class="op">)</span></span>
<span><span class="va">n_october</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">time</span> <span class="op">==</span> <span class="fl">10</span>, <span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_march</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">inlabru</span><span class="fu">::</span><span class="fu"><a href="https://inlabru-org.github.io/inlabru/reference/gg.html" class="external-link">gg</a></span><span class="op">(</span><span class="va">mesh</span>, </span>
<span>              color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">Predictor</span><span class="op">$</span><span class="va">sd</span><span class="op">[</span><span class="va">Predictor</span><span class="op">$</span><span class="va">month</span> <span class="op">==</span> <span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html" class="external-link">geom_polygon</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">wmap</span>, </span>
<span>                        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span><span class="op">)</span>, </span>
<span>                        fill <span class="op">=</span> <span class="st">'grey'</span>, </span>
<span>                        alpha <span class="op">=</span> <span class="fl">1.0</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">mesh_lon_min</span>, <span class="va">mesh_lon_max</span><span class="op">)</span>, </span>
<span>                       ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">mesh_lat_min</span>, <span class="va">mesh_lat_max</span><span class="op">)</span>, </span>
<span>                       expand <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">time</span> <span class="op">==</span> <span class="fl">3</span>, <span class="op">]</span>,</span>
<span>                      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">lon</span>, </span>
<span>                          y <span class="op">=</span> <span class="va">lat</span><span class="op">)</span>, </span>
<span>                      size <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Stdev March (n = "</span>, <span class="fu"><a href="https://rdrr.io/r/base/toString.html" class="external-link">toString</a></span><span class="op">(</span><span class="va">n_march</span><span class="op">)</span>, <span class="st">")"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradient2</a></span><span class="op">(</span>name <span class="op">=</span> <span class="va">title</span>,</span>
<span>                                low <span class="op">=</span> <span class="st">'navyblue'</span>,</span>
<span>                                mid <span class="op">=</span> <span class="st">'darkmagenta'</span>,</span>
<span>                                high <span class="op">=</span> <span class="st">'darkorange1'</span>,</span>
<span>                                midpoint <span class="op">=</span> <span class="va">stdev_median</span>,</span>
<span>                                limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">stdev_max</span><span class="op">)</span>,</span>
<span>                                oob <span class="op">=</span> <span class="va">squish</span></span>
<span>                                <span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>, </span>
<span>                 legend.key.width  <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">1.8</span>, <span class="st">"lines"</span><span class="op">)</span>,</span>
<span>                 plot.title <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>                 axis.title.x <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>                 axis.title.y <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span></span>
<span>                 <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span></span>
<span>    fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_colourbar.html" class="external-link">guide_colorbar</a></span><span class="op">(</span>title.position <span class="op">=</span> <span class="st">"left"</span>,</span>
<span>                          title.vjust <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                          title.hjust <span class="op">=</span> <span class="fl">1</span></span>
<span>                          <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  </span>
<span></span>
<span><span class="va">plot_october</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">inlabru</span><span class="fu">::</span><span class="fu"><a href="https://inlabru-org.github.io/inlabru/reference/gg.html" class="external-link">gg</a></span><span class="op">(</span><span class="va">mesh</span>, </span>
<span>              color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">Predictor</span><span class="op">$</span><span class="va">sd</span><span class="op">[</span><span class="va">Predictor</span><span class="op">$</span><span class="va">month</span> <span class="op">==</span> <span class="fl">10</span><span class="op">]</span><span class="op">)</span></span>
<span>              <span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html" class="external-link">geom_polygon</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">wmap</span>, </span>
<span>                        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span><span class="op">)</span>, </span>
<span>                        fill <span class="op">=</span> <span class="st">'grey'</span>, </span>
<span>                        alpha <span class="op">=</span> <span class="fl">1.0</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">mesh_lon_min</span>, <span class="va">mesh_lon_max</span><span class="op">)</span>, </span>
<span>                       ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">mesh_lat_min</span>, <span class="va">mesh_lat_max</span><span class="op">)</span>, </span>
<span>                       expand <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">time</span> <span class="op">==</span> <span class="fl">10</span>, <span class="op">]</span>,</span>
<span>                      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">lon</span>, </span>
<span>                          y <span class="op">=</span> <span class="va">lat</span><span class="op">)</span>, </span>
<span>                      size <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Stdev October (n = "</span>, <span class="fu"><a href="https://rdrr.io/r/base/toString.html" class="external-link">toString</a></span><span class="op">(</span><span class="va">n_october</span><span class="op">)</span>, <span class="st">")"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradient2</a></span><span class="op">(</span>name <span class="op">=</span> <span class="va">title</span>,</span>
<span>                                low <span class="op">=</span> <span class="st">'navyblue'</span>,</span>
<span>                                mid <span class="op">=</span> <span class="st">'darkmagenta'</span>,</span>
<span>                                high <span class="op">=</span> <span class="st">'darkorange1'</span>,</span>
<span>                                midpoint <span class="op">=</span> <span class="va">stdev_median</span>,</span>
<span>                                limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">stdev_max</span><span class="op">)</span>,</span>
<span>                                oob <span class="op">=</span> <span class="va">squish</span></span>
<span>                                <span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>, </span>
<span>                 legend.key.width  <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">1.8</span>, <span class="st">"lines"</span><span class="op">)</span>,</span>
<span>                 plot.title <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>                 axis.title.x <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>                 axis.title.y <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span></span>
<span>                 <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_colourbar.html" class="external-link">guide_colorbar</a></span><span class="op">(</span>title.position <span class="op">=</span> <span class="st">"left"</span>,</span>
<span>                                        title.vjust <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                                        title.hjust <span class="op">=</span> <span class="fl">1</span></span>
<span>                                        <span class="op">)</span></span>
<span>                  <span class="op">)</span></span>
<span>  </span>
<span></span>
<span><span class="fu">gridExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span><span class="va">plot_march</span>, <span class="va">plot_october</span>, ncol<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="ohc_tutorial_files/figure-html/stdevPlots-1.png" alt="Standard deviation field for L1 in 2005: (left) March, (right) October" width="768" id="fig-stdevplots-1"><p class="caption">
Standard deviation field for L1 in 2005: (left) March, (right) October
</p>
</div>
<p>The standard deviation is higher in areas with a low number of
profiles; especially, if there are no profiles in the vicinity like
during March in the Great Australian Bight. Despite the number of
profiles being larger in October than in March, the standard deviations
over the whole field remained similar. This can be explained by the
distribution of those extra profiles–mostly in a close proximity to
other profiles.</p>
<p>We also further explore the resampled posterior standard
deviation.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mc_serr_median</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">Predictor</span><span class="op">$</span><span class="va">mean.mc_std_err</span><span class="op">[</span><span class="va">Predictor</span><span class="op">$</span><span class="va">month</span> <span class="op">==</span> <span class="fl">3</span><span class="op">]</span>, <span class="va">Predictor</span><span class="op">$</span><span class="va">mean.mc_std_err</span><span class="op">[</span><span class="va">Predictor</span><span class="op">$</span><span class="va">month</span> <span class="op">==</span> <span class="fl">10</span><span class="op">]</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">mc_serr_max</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">Predictor</span><span class="op">$</span><span class="va">mean.mc_std_err</span><span class="op">[</span><span class="va">Predictor</span><span class="op">$</span><span class="va">month</span> <span class="op">==</span> <span class="fl">3</span><span class="op">]</span>, <span class="va">Predictor</span><span class="op">$</span><span class="va">mean.mc_std_err</span><span class="op">[</span><span class="va">Predictor</span><span class="op">$</span><span class="va">month</span> <span class="op">==</span> <span class="fl">10</span><span class="op">]</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_march</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">inlabru</span><span class="fu">::</span><span class="fu"><a href="https://inlabru-org.github.io/inlabru/reference/gg.html" class="external-link">gg</a></span><span class="op">(</span><span class="va">mesh</span>, </span>
<span>              color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">Predictor</span><span class="op">$</span><span class="va">mean.mc_std_err</span><span class="op">[</span><span class="va">Predictor</span><span class="op">$</span><span class="va">month</span> <span class="op">==</span> <span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html" class="external-link">geom_polygon</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">wmap</span>, </span>
<span>                        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span><span class="op">)</span>, </span>
<span>                        fill <span class="op">=</span> <span class="st">'grey'</span>, </span>
<span>                        alpha <span class="op">=</span> <span class="fl">1.0</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">mesh_lon_min</span>, <span class="va">mesh_lon_max</span><span class="op">)</span>, </span>
<span>                       ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">mesh_lat_min</span>, <span class="va">mesh_lat_max</span><span class="op">)</span>, </span>
<span>                       expand <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Sterr of mean March"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradient2</a></span><span class="op">(</span>name <span class="op">=</span> <span class="va">title</span>,</span>
<span>                                low <span class="op">=</span> <span class="st">'navyblue'</span>,</span>
<span>                                mid <span class="op">=</span> <span class="st">'darkmagenta'</span>,</span>
<span>                                high <span class="op">=</span> <span class="st">'darkorange1'</span>,</span>
<span>                                midpoint <span class="op">=</span> <span class="va">mc_serr_median</span>,</span>
<span>                                limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">mc_serr_max</span><span class="op">)</span>,</span>
<span>                                oob <span class="op">=</span> <span class="va">squish</span></span>
<span>                                <span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>, </span>
<span>                 legend.key.width  <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">1.8</span>, <span class="st">"lines"</span><span class="op">)</span>,</span>
<span>                 plot.title <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>                 axis.title.x <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>                 axis.title.y <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span></span>
<span>                 <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span></span>
<span>    fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_colourbar.html" class="external-link">guide_colorbar</a></span><span class="op">(</span>title.position <span class="op">=</span> <span class="st">"left"</span>,</span>
<span>                          title.vjust <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                          title.hjust <span class="op">=</span> <span class="fl">1</span></span>
<span>                          <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  </span>
<span></span>
<span><span class="va">plot_october</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">inlabru</span><span class="fu">::</span><span class="fu"><a href="https://inlabru-org.github.io/inlabru/reference/gg.html" class="external-link">gg</a></span><span class="op">(</span><span class="va">mesh</span>, </span>
<span>              color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">Predictor</span><span class="op">$</span><span class="va">mean.mc_std_err</span><span class="op">[</span><span class="va">Predictor</span><span class="op">$</span><span class="va">month</span> <span class="op">==</span> <span class="fl">10</span><span class="op">]</span><span class="op">)</span></span>
<span>              <span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html" class="external-link">geom_polygon</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">wmap</span>, </span>
<span>                        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span><span class="op">)</span>, </span>
<span>                        fill <span class="op">=</span> <span class="st">'grey'</span>, </span>
<span>                        alpha <span class="op">=</span> <span class="fl">1.0</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">mesh_lon_min</span>, <span class="va">mesh_lon_max</span><span class="op">)</span>, </span>
<span>                       ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">mesh_lat_min</span>, <span class="va">mesh_lat_max</span><span class="op">)</span>, </span>
<span>                       expand <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Sterr of mean October "</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradient2</a></span><span class="op">(</span>name <span class="op">=</span> <span class="va">title</span>,</span>
<span>                                low <span class="op">=</span> <span class="st">'navyblue'</span>,</span>
<span>                                mid <span class="op">=</span> <span class="st">'darkmagenta'</span>,</span>
<span>                                high <span class="op">=</span> <span class="st">'darkorange1'</span>,</span>
<span>                                midpoint <span class="op">=</span> <span class="va">mc_serr_median</span>,</span>
<span>                                limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">mc_serr_max</span><span class="op">)</span>,</span>
<span>                                oob <span class="op">=</span> <span class="va">squish</span></span>
<span>                                <span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>, </span>
<span>                 legend.key.width  <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">1.8</span>, <span class="st">"lines"</span><span class="op">)</span>,</span>
<span>                 plot.title <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>                 axis.title.x <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>                 axis.title.y <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span></span>
<span>                 <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_colourbar.html" class="external-link">guide_colorbar</a></span><span class="op">(</span>title.position <span class="op">=</span> <span class="st">"left"</span>,</span>
<span>                                        title.vjust <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                                        title.hjust <span class="op">=</span> <span class="fl">1</span></span>
<span>                                        <span class="op">)</span></span>
<span>                  <span class="op">)</span></span>
<span>  </span>
<span></span>
<span><span class="fu">gridExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span><span class="va">plot_march</span>, <span class="va">plot_october</span>, ncol<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="ohc_tutorial_files/figure-html/sterrPlots-1.png" alt="Resampled standard deviation of the mean field for L1 in 2005: (left) March, (right) October" width="768" id="fig-sterrplots-1"><p class="caption">
Resampled standard deviation of the mean field for L1 in 2005: (left)
March, (right) October
</p>
</div>
<p>As one can see, both the standard deviation and resampled standard
error of the mean are highest in the same areas. However, the magnitude
is much lower.</p>
<p>Finally, we evaluate the differences between synthetic observations
and predictions at the locations of those observations. First, we
calculate the predicted values at each location.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define the predictions and observations for March</span></span>
<span><span class="va">df_march</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">time</span> <span class="op">==</span> <span class="fl">3</span>, <span class="op">]</span></span>
<span><span class="va">df_sf_march</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">df_march</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lon"</span>, <span class="st">"lat"</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="va">pred_march</span> <span class="op">&lt;-</span> <span class="va">Predictor</span><span class="op">$</span><span class="va">mean</span><span class="op">[</span><span class="va">Predictor</span><span class="op">$</span><span class="va">month</span> <span class="op">==</span> <span class="fl">3</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Evaluate at observation locations</span></span>
<span><span class="va">pred_eval_march</span> <span class="op">&lt;-</span> <span class="fu">fmesher</span><span class="fu">::</span><span class="fu"><a href="https://inlabru-org.github.io/fmesher/reference/fm_evaluate.html" class="external-link">fm_evaluate</a></span><span class="op">(</span><span class="va">mesh</span>, <span class="va">pred_march</span>, loc <span class="op">=</span> <span class="va">df_sf_march</span><span class="op">$</span><span class="va">geometry</span><span class="op">)</span></span>
<span><span class="va">pred_diff_march</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>diff <span class="op">=</span> <span class="op">(</span><span class="va">df_march</span><span class="op">$</span><span class="va">dohc_L1</span> <span class="op">-</span> <span class="va">pred_eval_march</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pred_diff_march</span><span class="op">$</span><span class="va">Lat</span> <span class="op">&lt;-</span> <span class="va">df_march</span><span class="op">$</span><span class="va">lat</span></span>
<span><span class="va">pred_diff_march</span><span class="op">$</span><span class="va">Long</span> <span class="op">&lt;-</span> <span class="va">df_march</span><span class="op">$</span><span class="va">lon</span></span>
<span><span class="va">geom_diff_march</span>  <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">pred_diff_march</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Long"</span>, <span class="st">"Lat"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Do the same for October</span></span>
<span><span class="va">df_october</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">time</span> <span class="op">==</span> <span class="fl">10</span>, <span class="op">]</span></span>
<span><span class="va">df_sf_october</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">df_october</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lon"</span>, <span class="st">"lat"</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="va">pred_october</span> <span class="op">&lt;-</span> <span class="va">Predictor</span><span class="op">$</span><span class="va">mean</span><span class="op">[</span><span class="va">Predictor</span><span class="op">$</span><span class="va">month</span> <span class="op">==</span> <span class="fl">10</span><span class="op">]</span></span>
<span><span class="va">pred_eval_october</span> <span class="op">&lt;-</span> <span class="fu">fmesher</span><span class="fu">::</span><span class="fu"><a href="https://inlabru-org.github.io/fmesher/reference/fm_evaluate.html" class="external-link">fm_evaluate</a></span><span class="op">(</span><span class="va">mesh</span>, <span class="va">pred_october</span>, loc <span class="op">=</span> <span class="va">df_sf_october</span><span class="op">$</span><span class="va">geometry</span><span class="op">)</span></span>
<span><span class="va">pred_diff_october</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>diff <span class="op">=</span> <span class="op">(</span><span class="va">df_october</span><span class="op">$</span><span class="va">dohc_L1</span> <span class="op">-</span> <span class="va">pred_eval_october</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pred_diff_october</span><span class="op">$</span><span class="va">Lat</span> <span class="op">&lt;-</span> <span class="va">df_october</span><span class="op">$</span><span class="va">lat</span></span>
<span><span class="va">pred_diff_october</span><span class="op">$</span><span class="va">Long</span> <span class="op">&lt;-</span> <span class="va">df_october</span><span class="op">$</span><span class="va">lon</span></span>
<span><span class="va">geom_diff_october</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">pred_diff_october</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Long"</span>, <span class="st">"Lat"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Then we plot these differences.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">diff_suptitle_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/bquote.html" class="external-link">bquote</a></span><span class="op">(</span><span class="st">"Diff (synthetic - prediction)"</span><span class="op">~</span> <span class="fu">.</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/toString.html" class="external-link">toString</a></span><span class="op">(</span><span class="va">df_march</span><span class="op">$</span><span class="va">year</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fu">.</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/toString.html" class="external-link">toString</a></span><span class="op">(</span><span class="va">df_march</span><span class="op">$</span><span class="va">month</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">diff_suptitle_10</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/bquote.html" class="external-link">bquote</a></span><span class="op">(</span><span class="st">"Diff (synthetic - prediction)"</span><span class="op">~</span> <span class="fu">.</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/toString.html" class="external-link">toString</a></span><span class="op">(</span><span class="va">df_october</span><span class="op">$</span><span class="va">year</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fu">.</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/toString.html" class="external-link">toString</a></span><span class="op">(</span><span class="va">df_october</span><span class="op">$</span><span class="va">month</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">min_diff</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">pred_diff_march</span><span class="op">$</span><span class="va">diff</span>, <span class="va">pred_diff_october</span><span class="op">$</span><span class="va">diff</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">max_diff</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">pred_diff_march</span><span class="op">$</span><span class="va">diff</span>, <span class="va">pred_diff_october</span><span class="op">$</span><span class="va">diff</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_march</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html" class="external-link">geom_polygon</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">wmap</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>,</span>
<span>        y <span class="op">=</span> <span class="va">lat</span>,</span>
<span>        group <span class="op">=</span> <span class="va">group</span></span>
<span>    <span class="op">)</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">'grey'</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">1.0</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">geom_diff_march</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">diff</span><span class="op">)</span>,</span>
<span>                      size <span class="op">=</span> <span class="fl">1.0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">mesh_lon_min</span>, <span class="va">mesh_lon_max</span><span class="op">)</span>,</span>
<span>                    ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">mesh_lat_min</span>, <span class="va">mesh_lat_max</span><span class="op">)</span>,</span>
<span>                    expand <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="va">diff_suptitle_3</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_color_gradient2</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="va">title_diff</span>,</span>
<span>    low <span class="op">=</span> <span class="st">"blue"</span>,</span>
<span>    high <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>    midpoint <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">min_diff</span>, <span class="va">max_diff</span><span class="op">)</span>,</span>
<span>    oob <span class="op">=</span> <span class="va">squish</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"bottom"</span>,</span>
<span>                 legend.key.width  <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">2.5</span>, <span class="st">"lines"</span><span class="op">)</span>,</span>
<span>                 plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>                 axis.title.x<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                 axis.title.y<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                 legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span></span>
<span>    fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_colourbar.html" class="external-link">guide_colorbar</a></span><span class="op">(</span>title.position <span class="op">=</span> <span class="st">"left"</span>,</span>
<span>                          title.vjust <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                          title.hjust <span class="op">=</span> <span class="fl">1</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">plot_october</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html" class="external-link">geom_polygon</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">wmap</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>,</span>
<span>        y <span class="op">=</span> <span class="va">lat</span>,</span>
<span>        group <span class="op">=</span> <span class="va">group</span></span>
<span>    <span class="op">)</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">'grey'</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">1.0</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">geom_diff_october</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">diff</span><span class="op">)</span>,</span>
<span>                      size <span class="op">=</span> <span class="fl">1.0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">mesh_lon_min</span>, <span class="va">mesh_lon_max</span><span class="op">)</span>,</span>
<span>                    ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">mesh_lat_min</span>, <span class="va">mesh_lat_max</span><span class="op">)</span>,</span>
<span>                    expand <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="va">diff_suptitle_10</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_color_gradient2</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="va">title_diff</span>,</span>
<span>    low <span class="op">=</span> <span class="st">"blue"</span>,</span>
<span>    high <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>    midpoint <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">min_diff</span>, <span class="va">max_diff</span><span class="op">)</span>,</span>
<span>    oob <span class="op">=</span> <span class="va">squish</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"bottom"</span>,</span>
<span>                 legend.key.width  <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">2.5</span>, <span class="st">"lines"</span><span class="op">)</span>,</span>
<span>                 plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>                 axis.title.x<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                 axis.title.y<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                 legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span></span>
<span>    fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_colourbar.html" class="external-link">guide_colorbar</a></span><span class="op">(</span>title.position <span class="op">=</span> <span class="st">"left"</span>,</span>
<span>                          title.vjust <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                          title.hjust <span class="op">=</span> <span class="fl">1</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu">gridExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span><span class="va">plot_march</span>, <span class="va">plot_october</span>, ncol<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="ohc_tutorial_files/figure-html/differencePlots-1.png" alt="Differences between synthetic observations and predictions for L1 in 2005: (left) March, (right) October" width="768" id="fig-differenceplots-1"><p class="caption">
Differences between synthetic observations and predictions for L1 in
2005: (left) March, (right) October
</p>
</div>
<p>The differences show that there is no significant bias. The regions
with larger differences are typically around zones of higher mesoscale
activity, for instance, Agulhas and Agulhas Return Current, Leeuwin
Current near the Western Australian coastline, as well as western
Arabian Sea (Somali Current). There is a marked increase in differences
in the Arabian Sea in October compared to March, owing to a higher
number of eddies after the southwest monsoon in this region <span class="citation">(<a href="#ref-trott2017eddies">Trott et al.,
2017</a>)</span>.</p>
</div>
<div class="section level3">
<h3 id="temporal-evolution">Temporal evolution<a class="anchor" aria-label="anchor" href="#temporal-evolution"></a>
</h3>
<p>Next, we would like to show how the field evolves temporally. The
field-mean evolution of mean and standard deviation of the posterior
solution is shown in the plots below.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">meanFunc</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">[</span><span class="va">mask_ocean</span>,<span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">mean_mth</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">mthpred</span>, <span class="va">meanFunc</span><span class="op">)</span></span>
<span><span class="va">mean_std</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">sdpred</span>, <span class="va">meanFunc</span><span class="op">)</span></span>
<span></span>
<span><span class="va">list_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"Mean"</span> <span class="op">=</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">12</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">mean_mth</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="st">"Stdev"</span> <span class="op">=</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">12</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">mean_std</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">summ</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">list_summary</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">summ</span><span class="op">$</span><span class="va">parameter</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">list_summary</span><span class="op">)</span>, </span>
<span>                         times <span class="op">=</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">list_summary</span>, <span class="va">nrow</span><span class="op">)</span></span>
<span>                         <span class="op">)</span>, </span>
<span>               levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Mean"</span>, <span class="st">"Stdev"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">summ</span>, <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">parameter</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">'Month'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="va">title</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/pretty_breaks.html" class="external-link">pretty_breaks</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="ohc_tutorial_files/figure-html/temporalEval-1.png" alt="Area-averaged mean and standard deviation for the Indian Ocean in 2005" width="384" id="fig-temporaleval-1"><p class="caption">
Area-averaged mean and standard deviation for the Indian Ocean in 2005
</p>
</div>
<p>The plots show that the mean over ocean peaks between March and June
and reaches a minimum in September to October, in line with the southern
hemisphere (austral) seasonal cycle. The uncertainties are the highest
between November and May due to a lower number of measurements.</p>
<p>To show the temporal evolution across the Indian Ocean basin, we also
plotted March and October values of top-level DOHC along a transect. We
selected the TOGA/WOCE (Tropical Ocean Global Atmosphere/World Ocean
Circulation Experiment) transect IX12, which runs from the Gulf of Aden
to Freemantle in Western Australia. This transect is frequently (12–15
times a year) conducted by the commercial fleet that deploys expendable
bathythermographs (XBTs) along the route. The data has been collected
since 1983 until now.</p>
<p>We first define the locations of this transect and select some points
for further exploration.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># The bounding box</span></span>
<span><span class="va">min_lat_transect</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">34.5833</span></span>
<span><span class="va">max_lat_transect</span> <span class="op">&lt;-</span> <span class="fl">11.9</span></span>
<span><span class="va">min_lon_transect</span> <span class="op">&lt;-</span> <span class="fl">51.8167</span></span>
<span><span class="va">max_lon_transect</span> <span class="op">&lt;-</span> <span class="fl">114.6167</span></span>
<span></span>
<span><span class="co"># Set the matrix with selected points</span></span>
<span><span class="va">transect_points</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">56.42322</span>, <span class="fl">73.55196</span>, <span class="fl">86.11196</span>, <span class="fl">104.95196</span>, <span class="fl">8.4903437</span>, <span class="op">-</span><span class="fl">4.1880047</span>, <span class="op">-</span><span class="fl">13.4846647</span>, <span class="op">-</span><span class="fl">27.4296547</span><span class="op">)</span>, </span>
<span>    nrow <span class="op">=</span> <span class="fl">4</span>, </span>
<span>    ncol <span class="op">=</span> <span class="fl">2</span>, </span>
<span>    dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lon"</span>, <span class="st">"lat"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a line</span></span>
<span><span class="va">transect_matrix</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">max_lon_transect</span>, <span class="va">min_lon_transect</span>, <span class="va">min_lat_transect</span>, <span class="va">max_lat_transect</span><span class="op">)</span>, </span>
<span>    nrow <span class="op">=</span> <span class="fl">2</span>, </span>
<span>    ncol <span class="op">=</span> <span class="fl">2</span>, </span>
<span>    dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lon"</span>, <span class="st">"lat"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">transect_line</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span></span>
<span>    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_linestring</a></span><span class="op">(</span><span class="va">transect_matrix</span><span class="op">)</span>, </span>
<span>    crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Sample the line at 75 points</span></span>
<span><span class="va">tr_sample_a</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_sample.html" class="external-link">st_sample</a></span><span class="op">(</span><span class="va">transect_line</span>, size <span class="op">=</span> <span class="fl">75</span>, type <span class="op">=</span> <span class="st">"regular"</span><span class="op">)</span></span>
<span><span class="va">tr_points_a</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="va">tr_sample_a</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">tr_points_a</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lon"</span>, <span class="st">"lat"</span><span class="op">)</span></span></code></pre></div>
<p>The location on top of the mesh is shown in the figure below. A small
sample of points along the transect that we choose to further show the
change in time is also displayed.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">inlabru</span><span class="fu">::</span><span class="fu"><a href="https://inlabru-org.github.io/inlabru/reference/gg.html" class="external-link">gg</a></span><span class="op">(</span><span class="va">mesh</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html" class="external-link">geom_polygon</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">wmap</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>,</span>
<span>        y <span class="op">=</span> <span class="va">lat</span>,</span>
<span>        group <span class="op">=</span> <span class="va">group</span></span>
<span>        <span class="op">)</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">'grey'</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">1.0</span></span>
<span>    <span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span></span>
<span>    xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">mesh_lon_min</span>, <span class="va">mesh_lon_max</span><span class="op">)</span>,</span>
<span>    ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">mesh_lat_min</span>, <span class="va">mesh_lat_max</span><span class="op">)</span>, </span>
<span>    expand <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Mesh and transect IX12 with a selection of points"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">transect_matrix</span><span class="op">)</span>, </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">lon</span>, y <span class="op">=</span> <span class="va">lat</span><span class="op">)</span>, </span>
<span>    color <span class="op">=</span> <span class="st">"black"</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">transect_points</span><span class="op">)</span>, </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">lon</span>, y <span class="op">=</span> <span class="va">lat</span><span class="op">)</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"black"</span>, </span>
<span>    size <span class="op">=</span> <span class="fl">2</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span></span>
<span>    <span class="st">"text"</span>, </span>
<span>    x <span class="op">=</span> <span class="va">transect_points</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lon"</span><span class="op">)</span><span class="op">]</span>, </span>
<span>    y <span class="op">=</span> <span class="va">transect_points</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lat"</span><span class="op">)</span><span class="op">]</span> <span class="op">+</span> <span class="fl">3</span>, </span>
<span>    label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%d"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>    axis.title.x<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    axis.title.y<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="ohc_tutorial_files/figure-html/transectMap-1.png" alt="Transect IX12 on a map" width="576" id="fig-transectmap-1"><p class="caption">
Transect IX12 on a map
</p>
</div>
<p>Similarly as with the difference calculations above, we can determine
the predicted values at the sampled points along the transect and also
at the set of four points we choose to inspect more thoroughly.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create an empty list and matrices for evalutation</span></span>
<span><span class="va">monthlist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"January"</span>, <span class="st">"February"</span>, <span class="st">"March"</span>, <span class="st">"April"</span>, <span class="st">"May"</span>, <span class="st">"June"</span>, <span class="st">"July"</span>, <span class="st">"August"</span>, <span class="st">"September"</span>, <span class="st">"October"</span>, <span class="st">"November"</span>, <span class="st">"December"</span><span class="op">)</span></span>
<span><span class="va">eval_list</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span><span class="st">"list"</span>, <span class="fl">12</span><span class="op">)</span></span>
<span><span class="va">eval_point</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>, nrow <span class="op">=</span> <span class="fl">12</span>, ncol <span class="op">=</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">transect_points</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">std_min_point</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>, nrow <span class="op">=</span> <span class="fl">12</span>, ncol <span class="op">=</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">transect_points</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">std_max_point</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>, nrow <span class="op">=</span> <span class="fl">12</span>, ncol <span class="op">=</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">transect_points</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Evaluate field mean and standard deviation for each month at locations along the transect and select points</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">12</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">eval.part</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span><span class="st">"list"</span>, <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="va">eval.part</span><span class="op">$</span><span class="va">eval</span> <span class="op">&lt;-</span> <span class="fu">fmesher</span><span class="fu">::</span><span class="fu"><a href="https://inlabru-org.github.io/fmesher/reference/fm_evaluate.html" class="external-link">fm_evaluate</a></span><span class="op">(</span><span class="va">mesh</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">Predictor</span><span class="op">$</span><span class="va">mean</span><span class="op">[</span><span class="va">Predictor</span><span class="op">$</span><span class="va">month</span> <span class="op">==</span> <span class="va">i</span><span class="op">]</span><span class="op">)</span>, loc <span class="op">=</span> <span class="va">tr_points_a</span><span class="op">)</span></span>
<span>  <span class="va">eval.part</span><span class="op">$</span><span class="va">std</span> <span class="op">&lt;-</span> <span class="fu">fmesher</span><span class="fu">::</span><span class="fu"><a href="https://inlabru-org.github.io/fmesher/reference/fm_evaluate.html" class="external-link">fm_evaluate</a></span><span class="op">(</span><span class="va">mesh</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">Predictor</span><span class="op">$</span><span class="va">sd</span><span class="op">[</span><span class="va">Predictor</span><span class="op">$</span><span class="va">month</span> <span class="op">==</span> <span class="va">i</span><span class="op">]</span><span class="op">)</span>, loc <span class="op">=</span> <span class="va">tr_points_a</span><span class="op">)</span></span>
<span>  <span class="va">eval.part</span><span class="op">$</span><span class="va">ymin</span> <span class="op">&lt;-</span> <span class="va">eval.part</span><span class="op">$</span><span class="va">eval</span> <span class="op">-</span> <span class="va">eval.part</span><span class="op">$</span><span class="va">std</span></span>
<span>  <span class="va">eval.part</span><span class="op">$</span><span class="va">ymax</span> <span class="op">&lt;-</span> <span class="va">eval.part</span><span class="op">$</span><span class="va">eval</span> <span class="op">+</span> <span class="va">eval.part</span><span class="op">$</span><span class="va">std</span></span>
<span>  <span class="va">eval.part</span><span class="op">$</span><span class="va">Lat</span> <span class="op">&lt;-</span> <span class="va">tr_points_a</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lat"</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="va">eval.part</span><span class="op">$</span><span class="va">Long</span> <span class="op">&lt;-</span> <span class="va">tr_points_a</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lon"</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="va">eval.part</span><span class="op">$</span><span class="va">Month</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">monthlist</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">tr_points_a</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">eval_list</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">eval.part</span></span>
<span>  </span>
<span>  <span class="va">eval_mean</span> <span class="op">&lt;-</span> <span class="fu">fmesher</span><span class="fu">::</span><span class="fu"><a href="https://inlabru-org.github.io/fmesher/reference/fm_evaluate.html" class="external-link">fm_evaluate</a></span><span class="op">(</span><span class="va">mesh</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">Predictor</span><span class="op">$</span><span class="va">mean</span><span class="op">[</span><span class="va">Predictor</span><span class="op">$</span><span class="va">month</span> <span class="op">==</span> <span class="va">i</span><span class="op">]</span><span class="op">)</span>, loc <span class="op">=</span> <span class="va">transect_points</span><span class="op">)</span></span>
<span>  <span class="va">std_mean</span> <span class="op">&lt;-</span> <span class="fu">fmesher</span><span class="fu">::</span><span class="fu"><a href="https://inlabru-org.github.io/fmesher/reference/fm_evaluate.html" class="external-link">fm_evaluate</a></span><span class="op">(</span><span class="va">mesh</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">Predictor</span><span class="op">$</span><span class="va">sd</span><span class="op">[</span><span class="va">Predictor</span><span class="op">$</span><span class="va">month</span> <span class="op">==</span> <span class="va">i</span><span class="op">]</span><span class="op">)</span>, loc <span class="op">=</span> <span class="va">transect_points</span><span class="op">)</span></span>
<span>  <span class="va">eval_point</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="va">eval_mean</span></span>
<span>  <span class="va">std_min_point</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="va">eval_mean</span> <span class="op">-</span> <span class="va">std_mean</span></span>
<span>  <span class="va">std_max_point</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="va">eval_mean</span> <span class="op">+</span> <span class="va">std_mean</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Create and empty list to create timeseries at four points</span></span>
<span><span class="va">point_eval</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span><span class="st">"list"</span>, <span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add the string to determine whether the point is in northern or southern hemisphere</span></span>
<span><span class="va">ns_list</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">transect_points</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lat"</span><span class="op">)</span><span class="op">]</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sign.html" class="external-link">sign</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span><span class="st">"N"</span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span><span class="st">"S"</span><span class="op">}</span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a dataframe for each of the points in list</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">point_eval</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>      param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">i</span>, <span class="st">" ("</span>, <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">transect_points</span><span class="op">[</span><span class="va">i</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lat"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,  <span class="fu"><a href="https://rdrr.io/r/base/utf8Conversion.html" class="external-link">intToUtf8</a></span><span class="op">(</span><span class="fl">176</span><span class="op">)</span>, <span class="va">ns_list</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, <span class="st">", "</span>, <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">transect_points</span><span class="op">[</span><span class="va">i</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lon"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/utf8Conversion.html" class="external-link">intToUtf8</a></span><span class="op">(</span><span class="fl">176</span><span class="op">)</span>, <span class="st">"E)"</span><span class="op">)</span>,</span>
<span>      x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">12</span>,</span>
<span>      y <span class="op">=</span> <span class="va">eval_point</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span>,</span>
<span>      ymin <span class="op">=</span> <span class="va">std_min_point</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span>,</span>
<span>      ymax <span class="op">=</span> <span class="va">std_max_point</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>The plot below shows the predicted DOHC for the top layer in March
and October (austral autumn and spring, respectively) along the transect
shown in the previous plot. The line shows the mean field predictions
while the envelope – the standard deviation.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x_title</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Latitude ("</span>, <span class="fu"><a href="https://rdrr.io/r/base/utf8Conversion.html" class="external-link">intToUtf8</a></span><span class="op">(</span><span class="fl">176</span><span class="op">)</span>, <span class="st">"N)"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">eval_list</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Lat</span>, ymin <span class="op">=</span> <span class="va">ymin</span>, ymax <span class="op">=</span> <span class="va">ymax</span>, color <span class="op">=</span> <span class="va">Month</span>, fill <span class="op">=</span> <span class="va">Month</span>, linetype <span class="op">=</span> <span class="va">Month</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">eval_list</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Lat</span>, y <span class="op">=</span> <span class="va">eval</span>, color <span class="op">=</span> <span class="va">Month</span>, linetype <span class="op">=</span> <span class="va">Month</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">eval_list</span><span class="op">[</span><span class="fl">10</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Lat</span>, ymin <span class="op">=</span> <span class="va">ymin</span>, ymax <span class="op">=</span> <span class="va">ymax</span>, color <span class="op">=</span> <span class="va">Month</span>, fill <span class="op">=</span> <span class="va">Month</span>, linetype <span class="op">=</span> <span class="va">Month</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">eval_list</span><span class="op">[</span><span class="fl">10</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Lat</span>, y <span class="op">=</span> <span class="va">eval</span>, color <span class="op">=</span> <span class="va">Month</span>, linetype <span class="op">=</span> <span class="va">Month</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/pretty_breaks.html" class="external-link">pretty_breaks</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="va">x_title</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="va">title</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"DOHC along IX12 in 2005"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="ohc_tutorial_files/figure-html/transectPlot-1.png" alt="Timeseries for 2005 at selected points" width="576" id="fig-transectplot-1"><p class="caption">
Timeseries for 2005 at selected points
</p>
</div>
<p>The figure shows an increase in DOHC northward from the southernmost
point until
17<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mo>∘</mo></msup><annotation encoding="application/x-tex">^\circ</annotation></semantics></math>S
in the southern hemisphere. There the curve peaks for the first time and
then rapidly decays until
12<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mo>∘</mo></msup><annotation encoding="application/x-tex">^\circ</annotation></semantics></math>S.
The curve has a local minimum between
-13<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mo>∘</mo></msup><annotation encoding="application/x-tex">^\circ</annotation></semantics></math>S
and
-5<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mo>∘</mo></msup><annotation encoding="application/x-tex">^\circ</annotation></semantics></math>S,
after which DOHC starts to increase again, peaking at
7<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mo>∘</mo></msup><annotation encoding="application/x-tex">^\circ</annotation></semantics></math>N
and levelling off slightly afterwards. The seasonal (autumn/spring)
pattern shows that DOHC is higher in March than in October in most
places. The exception is the segment between
17<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mo>∘</mo></msup><annotation encoding="application/x-tex">^\circ</annotation></semantics></math>S
and
0<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mo>∘</mo></msup><annotation encoding="application/x-tex">^\circ</annotation></semantics></math>,
where curves match (descending limb) or where October values are higher
(local minimum). The whole segment is known to have a persistent
cooling, which has been present throughout the year for multiple decades
as shown in other studies <span class="citation">(<a href="#ref-duan2023storage">Duan et al., 2023</a>; <a href="#ref-roxy2020warming">Roxy et al., 2020</a>)</span>. The minimum
can be explained by the equatorial upwelling (associated with enhanced
vertical advection) in the so-called equatorial cold tongue (this
particular region is known as SCTR), which is caused by negative wind
stress curl due to surface wind divergence <span class="citation">(<a href="#ref-chen2015equatorial">Chen et al., 2015</a>)</span> between
equatorial westerlies and southeasterly trade wind <span class="citation">(<a href="#ref-mabarrok2023thermocline">Mubarrok et
al., 2023</a>)</span>. Wind stress is regulated by the Indian monsoon
due to the change in wind direction (from easterlies in boreal summer to
westerlies in boreal winter) <span class="citation">(<a href="#ref-yokoi2008sctr">Yokoi et al., 2008</a>)</span>. The segment
where both curves match is shown by <span class="citation">McKenna et
al. (<a href="#ref-mckenna2024sst">2024</a>)</span> to have a higher net
heat flux in March while net advection brings more heat in October due
to negative vertical advection in March (associated with the same
process as for the “cold tongue”) while the meridional heat advection is
stronger in October. Elsewhere, March OHC is higher than October OHC. In
the southern hemisphere, it is expected due to increased insolation
during the austral summer and the lag for the ocean to heat up. However,
we also observe higher OHC in the northern hemisphere, where maximum
values occur at the end of boreal winter. This segment has similar net
heat flux values because it peaks twice during the year and both peaks
are of similar magnitude <span class="citation">(<a href="#ref-mckenna2024sst">McKenna et al., 2024</a>)</span>. However,
advection contributes to more heat loss in October than in March. The
final (northernmost) segment lies close to land and is affected by
coastal upwelling near the Somali coast <span class="citation">(<a href="#ref-chatterjee2019somali">Chatterjee et al., 2019</a>; <a href="#ref-vic2014mesoscale">Vic et al., 2014</a>)</span>.</p>
<p>The panel below shows the mean and standard deviation at the four
sample locations along the transect shown on the map earlier. Compared
to the field mean, we can observe that temporal evolution is spatially
variable</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">point_eval</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"black"</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">'black'</span>, size <span class="op">=</span> <span class="fl">1.6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, ymin <span class="op">=</span> <span class="va">ymin</span>, ymax <span class="op">=</span> <span class="va">ymax</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">'grey'</span>, color <span class="op">=</span> <span class="st">'black'</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">param</span>, nrow <span class="op">=</span> <span class="fl">2</span>, ncol <span class="op">=</span> <span class="fl">2</span>, scales <span class="op">=</span> <span class="st">"fixed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/pretty_breaks.html" class="external-link">pretty_breaks</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">'Month'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="va">title</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"2005 timeseries along IX12"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="ohc_tutorial_files/figure-html/timeseriesPlots-1.png" alt="Timeseries for 2005 at selected points" width="576" id="fig-timeseriesplots-1"><p class="caption">
Timeseries for 2005 at selected points
</p>
</div>
<p>The northernmost point (1) has the highest DOHC values on average.
There is a pronounced seasonal cycle, which has a maximum plateau
(within standard deviation) from March to September and a more
pronounced trough reaching a minimum in November–December. The plateau
coincides with increased insolation when the sun is in zenith over the
northern hemisphere. However, it does not produce the typical biannual
maximum. The area is subject to monsoon winds, which cause seasonal
Somali Current reversal (southward during boreal summer) and the
creation of a small gyre (Great Whirl) <span class="citation">(<a href="#ref-lhegaret2018gyres">L’Hégaret et al., 2018</a>)</span>. The
winds reverse from southwesterly (JJA) to northeasterly (DJF), causing
enhanced boreal winter surface cooling in the northern Arabian Sea due
to the reduction in latent heat flux when the wind brings dry and cool
continental air from Asia <span class="citation">(<a href="#ref-schott2009circulation">Schott et al., 2009</a>)</span>. This
suggests that an interplay between insolation and wind-driven surface
cooling is likely causing the seasonal changes in this location. The
standard deviation envelope narrows slightly at the descending limb,
likely due to a higher number of observations in the area during that
time.</p>
<p>Point 2 has a relatively even profile with a lower average than at
point 1. There is a peak in June that levels off over a couple of months
until August. This could partly be caused by weaker equatorial upwelling
as well as increased net heat flux as discussed earlier. This location
is also near the South Equatorial Counter current, which is not present
at this particular point during the boreal summer <span class="citation">(<a href="#ref-wu2020gyrestructure">Wu et al.,
2020</a>)</span>. Thus, it is less affected by negative zonal heat
advection when the top-layer OHC values peak. The standard deviation
narrows near the peak, but is similar to point 1 elsewhere.</p>
<p>Point 3 are another relatively flat timeseries, which has a small
peak in January, levelling off until April. Within a standard deviation,
the rest of the values are similar. South Equatorial current is present
in the vicinity of point 3 and provides some heat advection. <span class="citation">McKenna et al. (<a href="#ref-mckenna2024sst">2024</a>)</span> shows that zonal and
meridional advection dampens the heat loss due to the net negative heat
flux during austral winter. The standard deviation is similar for all
timesteps.</p>
<p>The southernmost point (4) mostly has the lowest DOHC values on
average, which can be related to less solar radiation at higher
latitudes. There is also a prominent seasonal cycle with a maximum in
February and a minimum in November. The standard deviation is similar
for all months and also of similar magnitude as point 3.</p>
</div>
<div class="section level3">
<h3 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h3>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0" line-spacing="2">
<div id="ref-ali2018nio" class="csl-entry">
Ali, M. M., Singh, N., Kumar, M. S., Zheng, Y., Bourassa, M., Kishtawal,
C. M., &amp; Rao, C. V. (2018). Dominant modes of upper ocean heat
content in the north indian ocean. <em>Climate</em>, <em>6</em>(3).
</div>
<div id="ref-chatterjee2019somali" class="csl-entry">
Chatterjee, A., Kumar, B. P., Prakash, S., &amp; Singh, P. (2019).
Annihilation of the somali upwelling system during summer monsoon.
<em>Scientific Reports</em>, <em>9</em>.
</div>
<div id="ref-chen2015equatorial" class="csl-entry">
Chen, G., Han, W., Li, Y., Wang, D., &amp; Shinoda, T. (2015).
Intraseasonal variability of upwelling in the equatorial eastern indian
ocean. <em>Journal of Geophysical Research: Oceans</em>,
<em>120</em>(11), 7598–7615.
</div>
<div id="ref-dandapat2020runoff" class="csl-entry">
Dandapat, S., Gnanaseelan, C., &amp; Parekh, A. (2020). Impact of excess
and deficit river runoff on bay of bengal upper ocean characteristics
using an ocean general circulation model. <em>Deep-Sea Research Part II:
Topical Studies in Oceanography</em>, <em>172</em>.
</div>
<div id="ref-dandapat2021mld" class="csl-entry">
Dandapat, S., Chakraborty, A., Kuttippurath, J., Bhagawati, C., &amp;
Sen, R. (2021). A numerical study on the role of atmospheric forcing on
mixed layer depth variability in the bay of bengal using a regional
ocean model. <em>Ocean Dynamics</em>, <em>71</em>, 963–979.
</div>
<div id="ref-desbruyeres2017trends" class="csl-entry">
Desbruyères, D., McDonagh, E. L., &amp; Thierry, V. (2017). Global and
full-depth ocean temperature trends during the early twenty-first
century from argo and repeat hydrography. <em>Journal of Climate</em>,
<em>30</em>(6), 1985–1997.
</div>
<div id="ref-duan2023storage" class="csl-entry">
Duan, J., Li, Y., Lin, P., &amp; Wang, F. (2023). Heat storage in the
upper indian ocean: The role of wind-driven redistribution. <em>Journal
of Climate</em>, <em>36</em>(7), 2221–2242.
</div>
<div id="ref-giglio2016subantarctic" class="csl-entry">
Giglio, D., &amp; Johnson, G. C. (2016). Subantarctic and polar fronts
of the antarctic circumpolar current and southern ocean heat and
freshwater content variability: A view from argo. <em>Journal of
Physical Oceanography</em>, <em>46</em>(3), 749–768.
</div>
<div id="ref-hood2024io" class="csl-entry">
Hood, R. R., Ummenhofer, C. C., Philips, H. E., &amp; Sprintall, J.
(2024). Introduction to the indian ocean. In C. C. Ummenhofer &amp; R.
R. Hood (Eds.), <em>The indian ocean and its role in the global climate
system</em> (pp. 1–31). Elsevier.
</div>
<div id="ref-huang2002eof" class="csl-entry">
Huang, B., &amp; Kinter, J. L. (2002). Interannual variability in the
tropical indian ocean. <em>Journal of Geophysical Research: Oceans</em>,
<em>107</em>(C11).
</div>
<div id="ref-jaishree2023seasdyn" class="csl-entry">
Jaishree, D., Ravichandran, P. T., &amp; Thattal, D. V. (2023).
Exploring the dynamics of seasonal surface features using coastal and
regional ocean community model. <em>Global Journal of Environmental
Science and Management</em>, <em>9</em>(4), 741–752.
</div>
<div id="ref-lhegaret2018gyres" class="csl-entry">
L’Hégaret, P., Beal, L. M., Elipot, shane, &amp; Laurindo, L. (2018).
Shallow cross-equatorial gyres of the indian ocean driven by seasonally
reversing monsoon winds. <em>Journal of Geophysical Research:
Oceans</em>, <em>123</em>(12), 8902–8920.
</div>
<div id="ref-mckenna2024sst" class="csl-entry">
McKenna, S., Santoso, A., Gupta, A. S., &amp; Taschetto, A. S. (2024).
Understanding biases in indian ocean seasonal SST in CMIP6 models.
<em>Journal of Geophysical Research: Oceans</em>, <em>129</em>(2).
</div>
<div id="ref-mabarrok2023thermocline" class="csl-entry">
Mubarrok, S., Azmiuddin, F., &amp; Jang, C. J. (2023). Assessment of
thermocline depth bias in the seychelles-chagos thermocline ridge of the
southwestern indian ocean simulated by the CMIP6 models. <em>Frontiers
in Marine Science</em>, <em>10</em>.
</div>
<div id="ref-orsi1995acc" class="csl-entry">
Orsi, A. H., Whitworth, T., &amp; Nowlin, W. D. (1995). On the
meridional extent and fronts of the antarctic circumpolar current.
<em>Deep-Sea Research Part I</em>, <em>42</em>(5), 641–673.
</div>
<div id="ref-phillips2024circulation" class="csl-entry">
Philips, H. E., Menezes, V. V., Nagura, M., McPhaden, M. J.,
Vinayachandran, P. N., &amp; Beal, L. M. (2024). Indian ocean
circulation. In C. C. Ummenhofer &amp; R. R. Hood (Eds.), <em>The indian
ocean and its role in the global climate system</em> (pp. 169–203).
Elsevier.
</div>
<div id="ref-roxy2020warming" class="csl-entry">
Roxy, M. K., Gnanaseelan, C., Parekh, A., Chowdary, J. S., Singh, S.,
Modi, A., et al. (2020). Indian ocean warming. In R. Krishnan, J.
Sanjay, C. Gnanaseelan, M. Mujumdar, A. Kulkarni, &amp; S. Chakraborty
(Eds.), <em>Assessment of climate change over the indian region</em>
(pp. 191–206). Springer.
</div>
<div id="ref-sandeep2018freshwater" class="csl-entry">
Sandeep, K. K., Pant, V., Girishkumar, M. S., &amp; Rao, A. D. (2018).
Impact of riverine freshwater forcing on the sea surface salinity
simulations in the indian ocean. <em>Journal of Marine Systems</em>,
<em>185</em>, 40–58.
</div>
<div id="ref-schott2009circulation" class="csl-entry">
Schott, F. A., Xie, S.-P., &amp; McCreary, J. P. (2009). Indian ocean
circulation and climate variability. <em>Reviews of Geophysics</em>,
<em>47</em>(1).
</div>
<div id="ref-trenberth2014inbalance" class="csl-entry">
Trenberth, K. E., Fasullo, J. T., &amp; Balmaseda, M. A. (2014). Earth’s
energy imbalance. <em>Journal of Climate</em>, <em>27</em>(9),
3129–3144.
</div>
<div id="ref-trott2017eddies" class="csl-entry">
Trott, C. B., Subrahmanyam, B., &amp; Murty, V. S. N. (2017).
Variability of the somali current and eddies during the southwest
monsoon regimes. <em>Dynamics of Atmospheres and Oceans</em>,
<em>79</em>, 43–55.
</div>
<div id="ref-vic2014mesoscale" class="csl-entry">
Vic, C., Roullet, G., Carton, X., &amp; Capet, X. (2014). Mesoscale
dynamics in the arabian sea and a focus on the great whirl life cycle: A
numerical investigation using ROMS. <em>Journal of Geophysical Research:
Oceans</em>, <em>119</em>(9), 6422–6443.
</div>
<div id="ref-wu2020gyrestructure" class="csl-entry">
Wu, W., Yu, Y., Qian, Y.-K., Cheng, X., Wang, T., Zhang, L., &amp; Peng,
S. (2020). Structure and seasonal variation of the indian ocean tropical
gyre based on surface drifters. <em>Journal of Geophysical Research:
Oceans</em>, <em>125</em>(5).
</div>
<div id="ref-yokoi2008sctr" class="csl-entry">
Yokoi, T., Tozuka, T., &amp; Yamagata, T. (2008). Seasonal variation of
the seychelles dome. <em>Journal of Climate</em>, <em>21</em>(15),
3740–3754.
</div>
<div id="ref-zhang2023bengal" class="csl-entry">
Zhang, Z., Wang, J., Hao, J., Yuan, D., &amp; Wang, K. (2023). Surface
cross-equatorial pathways of seawater from the bay of bengal.
<em>Frontiers in Marine Science</em>, <em>10</em>.
</div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/gareth-j/" class="external-link">Gareth Jones</a>, <a href="https://www.researchgate.net/profile/Xueqing_Yin" class="external-link">Xueqing Yin</a>, <a href="https://mnky9800n.github.io/" class="external-link">John Aiken</a>, Jonathan Bamber.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
