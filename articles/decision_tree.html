<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="fdmr">
<title>How to choose a model • fdmr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="How to choose a model">
<meta property="og:description" content="fdmr">
<meta property="og:image" content="https://4dmodeller.github.io/fdmr/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">fdmr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-tutorials">Tutorials</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-tutorials">
    <h6 class="dropdown-header" data-toc-skip>Getting started</h6>
    <a class="dropdown-item" href="../articles/getting_started.html">Installation</a>
    <a class="dropdown-item" href="../articles/data_preprocessing.html">Data pre-processing</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>End to end tutorials</h6>
    <a class="dropdown-item" href="../articles/decision_tree.html">How to choose how to model</a>
    <a class="dropdown-item" href="../articles/simulation_gaussian_data.Rmd">Simulation Tutorial (Gaussian data)</a>
    <a class="dropdown-item" href="../articles/simulation_poisson_data.Rmd">Simulation Tutorial (Poisson data)</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Shiny apps</h6>
    <a class="dropdown-item" href="../articles/mapping.html">Map plotting</a>
    <a class="dropdown-item" href="../articles/meshbuilder.html">Mesh building</a>
    <a class="dropdown-item" href="../articles/priors_app.html">Model builder</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>In depth tutorials</h6>
    <a class="dropdown-item" href="../articles/covid.html">COVID-19</a>
    <a class="dropdown-item" href="../articles/covid_mcmc.html">COVID-19 MCMC</a>
    <a class="dropdown-item" href="../articles/covid_ST_mcmc.html">COVID-19 MCMC (Space-time)</a>
    <a class="dropdown-item" href="../articles/hydro.html">Hydrology</a>
    <a class="dropdown-item" href="../articles/priors.html">Priors exploration</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>FAQ</h6>
    <a class="dropdown-item" href="../articles/inla_FAQ.html">INLA Crash FAQ</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://4dmodeller.github.io/4DM_Hackathon/">Hackathon</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/4DModeller/fdmr/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>How to choose a model</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/4DModeller/fdmr/blob/HEAD/vignettes/decision_tree.Rmd" class="external-link"><code>vignettes/decision_tree.Rmd</code></a></small>
      <div class="d-none name"><code>decision_tree.Rmd</code></div>
    </div>

    
    
<p>4d-Modeller and INLA/inlabru allow you to use both fixed and random
effects in your model with SPDEs allowing you to model continuous random
processes in your data. Below we explain briefly each of these processes
and how to choose when to use them.</p>
<p>In this document we will use the following data for examples:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">INLA</span><span class="op">)</span> <span class="co"># for modeling later</span></span></code></pre></div>
<pre><code><span><span class="co">## Loading required package: Matrix</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: sp</span></span></code></pre>
<pre><code><span><span class="co">## The legacy packages maptools, rgdal, and rgeos, underpinning the sp package,</span></span>
<span><span class="co">## which was just loaded, were retired in October 2023.</span></span>
<span><span class="co">## Please refer to R-spatial evolution reports for details, especially</span></span>
<span><span class="co">## https://r-spatial.org/r/2023/05/15/evolution4.html.</span></span>
<span><span class="co">## It may be desirable to make the sf package available;</span></span>
<span><span class="co">## package maintainers should consider adding sf to Suggests:.</span></span></code></pre>
<pre><code><span><span class="co">## This is INLA_23.10.17 built 2023-10-16 18:20:04 UTC.</span></span>
<span><span class="co">##  - See www.r-inla.org/contact-us for how to get help.</span></span>
<span><span class="co">##  - See ?inla.doc for howto access documentation</span></span></code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/" class="external-link">MASS</a></span><span class="op">)</span>  <span class="co"># for true multivariate normal simulation</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">100</span>  <span class="co"># number of observations</span></span>
<span><span class="va">timesteps</span> <span class="op">&lt;-</span> <span class="fl">10</span>  <span class="co"># number of time steps</span></span>
<span></span>
<span><span class="co"># Create a basic time and space grid</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span>, length.out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span>, length.out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                  time <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">timesteps</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a covariance matrix</span></span>
<span><span class="va">cov_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0.5</span>, nrow <span class="op">=</span> <span class="va">n</span>, ncol <span class="op">=</span> <span class="va">n</span><span class="op">)</span>  <span class="co"># Example covariance matrix with 0.5 correlation</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">cov_matrix</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">1</span>  <span class="co"># Diagonal should be 1</span></span>
<span></span>
<span><span class="co"># Generate spatially and temporally correlated noise for each time step</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">time</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">noise</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MASS/man/mvrnorm.html" class="external-link">mvrnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1</span>, mu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n</span><span class="op">)</span>, Sigma <span class="op">=</span> <span class="va">cov_matrix</span><span class="op">)</span></span>
<span>  <span class="va">df</span><span class="op">$</span><span class="va">value</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">time</span> <span class="op">==</span> <span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">noise</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   x y time      value</span></span>
<span><span class="co">## 1 1 1    1 -0.8289255</span></span>
<span><span class="co">## 2 2 1    1 -0.6811949</span></span>
<span><span class="co">## 3 3 1    1 -1.7202577</span></span>
<span><span class="co">## 4 4 1    1 -0.4516269</span></span>
<span><span class="co">## 5 5 1    1 -1.0519665</span></span>
<span><span class="co">## 6 6 1    1 -1.3113588</span></span></code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, color <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">time</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="decision_tree_files/figure-html/unnamed-chunk-1-1.png" width="700"></p>
<div class="section level2">
<h2 id="fixed-effects">Fixed Effects<a class="anchor" aria-label="anchor" href="#fixed-effects"></a>
</h2>
<p>A fixed effect in a bayesian model is an effect whose value is fixed
in a location but has a probability distribution associated with it’s
uncertainty. A fixed effect represents a parameter or coefficient in a
model that is assumed to have a fixed, constant value across different
observations/locations. In a Bayesian model, a fixed effect is a special
case of a random effect where we assume the effect has zero
variance.</p>
<div class="section level3">
<h3 id="why-would-you-choose-a-fixed-effect">why would you choose a fixed effect?<a class="anchor" aria-label="anchor" href="#why-would-you-choose-a-fixed-effect"></a>
</h3>
<p>You would choose to model an effect as a fixed effect if you believe
the effect will always have the same outcome no matter the context of
that the observation is taken. For example, a unit of rain should fill a
reservoir by that an equivalent unit no matter the conditions given
constant climatic conditions with non-porous soil.</p>
</div>
<div class="section level3">
<h3 id="example-of-a-fixed-effect-in-r-inlainlabru">example of a fixed effect in r-inla/inlabru<a class="anchor" aria-label="anchor" href="#example-of-a-fixed-effect-in-r-inlainlabru"></a>
</h3>
<p>A fixed effect is represented in the fit equation as the variable
name. In the simulated data example, there are three columns
<code>x</code>, <code>y</code>, and <code>time</code>. You can see below
how these are written into the formula that is then passed to inla.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">formula</span> <span class="op">&lt;-</span> <span class="va">value</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">x</span> <span class="op">+</span> <span class="va">y</span> <span class="op">+</span> <span class="va">time</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.html" class="external-link">inla</a></span><span class="op">(</span><span class="va">formula</span>, data <span class="op">=</span> <span class="va">df</span>, family <span class="op">=</span> <span class="st">"gaussian"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">##    c("inla.core(formula = formula, family = family, contrasts = contrasts, </span></span>
<span><span class="co">##    ", " data = data, quantiles = quantiles, E = E, offset = offset, ", " </span></span>
<span><span class="co">##    scale = scale, weights = weights, Ntrials = Ntrials, strata = strata, </span></span>
<span><span class="co">##    ", " lp.scale = lp.scale, link.covariates = link.covariates, verbose = </span></span>
<span><span class="co">##    verbose, ", " lincomb = lincomb, selection = selection, control.compute </span></span>
<span><span class="co">##    = control.compute, ", " control.predictor = control.predictor, </span></span>
<span><span class="co">##    control.family = control.family, ", " control.inla = control.inla, </span></span>
<span><span class="co">##    control.fixed = control.fixed, ", " control.mode = control.mode, </span></span>
<span><span class="co">##    control.expert = control.expert, ", " control.hazard = control.hazard, </span></span>
<span><span class="co">##    control.lincomb = control.lincomb, ", " control.update = </span></span>
<span><span class="co">##    control.update, control.lp.scale = control.lp.scale, ", " </span></span>
<span><span class="co">##    control.pardiso = control.pardiso, only.hyperparam = only.hyperparam, </span></span>
<span><span class="co">##    ", " inla.call = inla.call, inla.arg = inla.arg, num.threads = </span></span>
<span><span class="co">##    num.threads, ", " keep = keep, working.directory = working.directory, </span></span>
<span><span class="co">##    silent = silent, ", " inla.mode = inla.mode, safe = FALSE, debug = </span></span>
<span><span class="co">##    debug, .parent.frame = .parent.frame)" ) </span></span>
<span><span class="co">## Time used:</span></span>
<span><span class="co">##     Pre = 0.712, Running = 0.326, Post = 0.0308, Total = 1.07 </span></span>
<span><span class="co">## Fixed effects:</span></span>
<span><span class="co">##               mean    sd 0.025quant 0.5quant 0.975quant   mode kld</span></span>
<span><span class="co">## (Intercept) -0.301 0.108     -0.514   -0.301     -0.088 -0.301   0</span></span>
<span><span class="co">## x            0.010 0.011     -0.011    0.010      0.031  0.010   0</span></span>
<span><span class="co">## y           -0.002 0.011     -0.023   -0.002      0.019 -0.002   0</span></span>
<span><span class="co">## time        -0.013 0.011     -0.034   -0.013      0.008 -0.013   0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Model hyperparameters:</span></span>
<span><span class="co">##                                         mean    sd 0.025quant 0.5quant</span></span>
<span><span class="co">## Precision for the Gaussian observations 1.02 0.046      0.934     1.02</span></span>
<span><span class="co">##                                         0.975quant mode</span></span>
<span><span class="co">## Precision for the Gaussian observations       1.11 1.02</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Marginal log-Likelihood:  -1445.73 </span></span>
<span><span class="co">##  is computed </span></span>
<span><span class="co">## Posterior summaries for the linear predictor and the fitted values are computed</span></span>
<span><span class="co">## (Posterior marginals needs also 'control.compute=list(return.marginals.predictor=TRUE)')</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="random-effects">Random Effects<a class="anchor" aria-label="anchor" href="#random-effects"></a>
</h2>
<p>A random effect in a bayesian model has an effect whose value is
drawn from a probability distribution and has associated uncertainty
drawn from it’s own distribution. There are two types of random effects
that can be modeled in inla, random effects of unobserved processes and
random effects constrained by observed processes.</p>
<div class="section level3">
<h3 id="random-effects-of-unobserved-processes">Random Effects of Unobserved Processes<a class="anchor" aria-label="anchor" href="#random-effects-of-unobserved-processes"></a>
</h3>
<p>Unobserved processes are processes that may be spatially or
temporally distributed that do not have data or a theoretical
description as to what they might be. Instead, it is considered variance
found within the data that is not representative of randomness and
instead some kind of unobserved process.</p>
<p>For example, patients being infected by COVID-19 were impacted by
social and demographic factors that helped to control infection rates <a href="link_to_covid_tutorial">link</a>. But what if in addition to
social and demographic factors, there was an unobserved migration of
people into a neighborhood thereby increasing the total number of
potential people who could be infected? This would create unobserved
variance in the data set (assuming we do not have neighborhood
population counts).</p>
<p>Below we show a model that defines a formula where the <code>f</code>
subroutine represents the unobserved variance occuring through time
while <code>x</code> and <code>y</code> are fixed effects.gi</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define a formula for the model</span></span>
<span><span class="co"># Load the INLA library</span></span>
<span></span>
<span><span class="co"># Define the formula for the INLA model</span></span>
<span><span class="va">formula</span> <span class="op">&lt;-</span> <span class="va">value</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">x</span> <span class="op">+</span> <span class="va">y</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/f.html" class="external-link">f</a></span><span class="op">(</span><span class="va">time</span>, model <span class="op">=</span> <span class="st">"rw1"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fit the INLA model</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.html" class="external-link">inla</a></span><span class="op">(</span><span class="va">formula</span>, data <span class="op">=</span> <span class="va">df</span>, family <span class="op">=</span> <span class="st">"gaussian"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print the summary of the INLA model</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">##    c("inla.core(formula = formula, family = family, contrasts = contrasts, </span></span>
<span><span class="co">##    ", " data = data, quantiles = quantiles, E = E, offset = offset, ", " </span></span>
<span><span class="co">##    scale = scale, weights = weights, Ntrials = Ntrials, strata = strata, </span></span>
<span><span class="co">##    ", " lp.scale = lp.scale, link.covariates = link.covariates, verbose = </span></span>
<span><span class="co">##    verbose, ", " lincomb = lincomb, selection = selection, control.compute </span></span>
<span><span class="co">##    = control.compute, ", " control.predictor = control.predictor, </span></span>
<span><span class="co">##    control.family = control.family, ", " control.inla = control.inla, </span></span>
<span><span class="co">##    control.fixed = control.fixed, ", " control.mode = control.mode, </span></span>
<span><span class="co">##    control.expert = control.expert, ", " control.hazard = control.hazard, </span></span>
<span><span class="co">##    control.lincomb = control.lincomb, ", " control.update = </span></span>
<span><span class="co">##    control.update, control.lp.scale = control.lp.scale, ", " </span></span>
<span><span class="co">##    control.pardiso = control.pardiso, only.hyperparam = only.hyperparam, </span></span>
<span><span class="co">##    ", " inla.call = inla.call, inla.arg = inla.arg, num.threads = </span></span>
<span><span class="co">##    num.threads, ", " keep = keep, working.directory = working.directory, </span></span>
<span><span class="co">##    silent = silent, ", " inla.mode = inla.mode, safe = FALSE, debug = </span></span>
<span><span class="co">##    debug, .parent.frame = .parent.frame)" ) </span></span>
<span><span class="co">## Time used:</span></span>
<span><span class="co">##     Pre = 0.532, Running = 0.369, Post = 0.0236, Total = 0.925 </span></span>
<span><span class="co">## Fixed effects:</span></span>
<span><span class="co">##               mean    sd 0.025quant 0.5quant 0.975quant   mode kld</span></span>
<span><span class="co">## (Intercept) -0.372 0.065     -0.499   -0.372     -0.245 -0.372   0</span></span>
<span><span class="co">## x            0.010 0.008     -0.005    0.010      0.025  0.010   0</span></span>
<span><span class="co">## y           -0.002 0.008     -0.017   -0.002      0.013 -0.002   0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Random effects:</span></span>
<span><span class="co">##   Name     Model</span></span>
<span><span class="co">##     time RW1 model</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Model hyperparameters:</span></span>
<span><span class="co">##                                         mean    sd 0.025quant 0.5quant</span></span>
<span><span class="co">## Precision for the Gaussian observations 2.00 0.090      1.826     2.00</span></span>
<span><span class="co">## Precision for time                      1.24 0.544      0.464     1.15</span></span>
<span><span class="co">##                                         0.975quant  mode</span></span>
<span><span class="co">## Precision for the Gaussian observations       2.18 1.993</span></span>
<span><span class="co">## Precision for time                            2.56 0.972</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Marginal log-Likelihood:  -1137.11 </span></span>
<span><span class="co">##  is computed </span></span>
<span><span class="co">## Posterior summaries for the linear predictor and the fitted values are computed</span></span>
<span><span class="co">## (Posterior marginals needs also 'control.compute=list(return.marginals.predictor=TRUE)')</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="random-effects-constrained-by-observed-processes">Random Effects Constrained by Observed Processes<a class="anchor" aria-label="anchor" href="#random-effects-constrained-by-observed-processes"></a>
</h3>
<p>Observed data can be used to constrain effects such that inla/inlabru
can be used to do data driven inversion, i.e., estimating processes that
cannot be observed directly. For example,</p>
<!-- TODO: come up with example -->
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.inlabru.org" class="external-link">inlabru</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Loading required package: fmesher</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'inlabru'</span></span></code></pre>
<pre><code><span><span class="co">## The following object is masked from 'package:MASS':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     shrimp</span></span></code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fit a simple model</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://inlabru-org.github.io/inlabru/reference/bru.html" class="external-link">bru</a></span><span class="op">(</span><span class="va">value</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="fu">observed</span><span class="op">(</span><span class="va">x</span> <span class="op">+</span> <span class="va">y</span>, model <span class="op">=</span> <span class="st">"linear"</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">df</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print the model summary</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## inlabru version: 2.9.0</span></span>
<span><span class="co">## INLA version: 23.10.17</span></span>
<span><span class="co">## Components:</span></span>
<span><span class="co">## observed: main = linear(x + y), group = exchangeable(1L), replicate = iid(1L)</span></span>
<span><span class="co">## Intercept: main = linear(1), group = exchangeable(1L), replicate = iid(1L)</span></span>
<span><span class="co">## Likelihoods:</span></span>
<span><span class="co">##   Family: 'gaussian'</span></span>
<span><span class="co">##     Data class: 'data.frame'</span></span>
<span><span class="co">##     Predictor: value ~ .</span></span>
<span><span class="co">## Time used:</span></span>
<span><span class="co">##     Pre = 0.422, Running = 0.333, Post = 0.064, Total = 0.819 </span></span>
<span><span class="co">## Fixed effects:</span></span>
<span><span class="co">##             mean    sd 0.025quant 0.5quant 0.975quant   mode kld</span></span>
<span><span class="co">## observed   0.004 0.008     -0.011    0.004      0.019  0.004   0</span></span>
<span><span class="co">## Intercept -0.372 0.090     -0.549   -0.372     -0.194 -0.372   0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Model hyperparameters:</span></span>
<span><span class="co">##                                         mean    sd 0.025quant 0.5quant</span></span>
<span><span class="co">## Precision for the Gaussian observations 1.02 0.046      0.934     1.02</span></span>
<span><span class="co">##                                         0.975quant mode</span></span>
<span><span class="co">## Precision for the Gaussian observations       1.11 1.02</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Deviance Information Criterion (DIC) ...............: 2822.37</span></span>
<span><span class="co">## Deviance Information Criterion (DIC, saturated) ....: 1005.42</span></span>
<span><span class="co">## Effective number of parameters .....................: 2.99</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Watanabe-Akaike information criterion (WAIC) ...: 2822.56</span></span>
<span><span class="co">## Effective number of parameters .................: 3.17</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Marginal log-Likelihood:  -1435.50 </span></span>
<span><span class="co">##  is computed </span></span>
<span><span class="co">## Posterior summaries for the linear predictor and the fitted values are computed</span></span>
<span><span class="co">## (Posterior marginals needs also 'control.compute=list(return.marginals.predictor=TRUE)')</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="comparing-the-output">Comparing the output<a class="anchor" aria-label="anchor" href="#comparing-the-output"></a>
</h3>
<p>Finally, we can compare the output of all the models using the DIC.
This is important as we would like to know the fittedness of each model
even if we have some theoretical belief that a model should be
specificied in a certain way.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">DICs</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in h(simpleError(msg, call)): error in evaluating the argument 'x' in selecting a method for function 'plot': object 'DICs' not found</span></span></code></pre>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://github.com/gareth-j/" class="external-link">Gareth Jones</a>, <a href="https://www.researchgate.net/profile/Xueqing_Yin" class="external-link">Xueqing Yin</a>, <a href="https://mnky9800n.github.io/" class="external-link">John Aiken</a>, Jonathan Bamber.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
