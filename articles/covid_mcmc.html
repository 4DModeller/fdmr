<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="fdmr">
<title>COVID-19 MCMC • fdmr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="COVID-19 MCMC">
<meta property="og:description" content="fdmr">
<meta property="og:image" content="https://4dmodeller.github.io/fdmr/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">fdmr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-tutorials">Tutorials</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-tutorials">
    <h6 class="dropdown-header" data-toc-skip>Getting started</h6>
    <a class="dropdown-item" href="../articles/getting_started.html">Installation</a>
    <a class="dropdown-item" href="../articles/data_preprocessing.html">Data pre-processing</a>
    <a class="dropdown-item" href="../articles/expected_data_structure.html">Expected data structure</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>End to end tutorials</h6>
    <a class="dropdown-item" href="../articles/decision_tree.html">How to choose how to model</a>
    <a class="dropdown-item" href="../articles/simulation_gaussian_data.html">Simulation Tutorial (Gaussian data)</a>
    <a class="dropdown-item" href="../articles/simulation_poisson_data.html">Simulation Tutorial (Poisson data)</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Shiny apps</h6>
    <a class="dropdown-item" href="../articles/meshbuilder.html">Mesh building</a>
    <a class="dropdown-item" href="../articles/modelbuilder.html">Model builder</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>In depth tutorials</h6>
    <a class="dropdown-item" href="../articles/covid.html">COVID-19</a>
    <a class="dropdown-item" href="../articles/covid_mcmc.html">COVID-19 MCMC</a>
    <a class="dropdown-item" href="../articles/covid_ST_mcmc.html">COVID-19 MCMC (Space-time)</a>
    <a class="dropdown-item" href="../articles/hydro.html">Hydrology</a>
    <a class="dropdown-item" href="../articles/priors.html">Priors exploration</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>FAQ</h6>
    <a class="dropdown-item" href="../articles/inla_FAQ.html">INLA Crash FAQ</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://4dmodeller.github.io/4DM_Hackathon/">Hackathon</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/4DModeller/fdmr/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>COVID-19 MCMC</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/4DModeller/fdmr/blob/HEAD/vignettes/covid_mcmc.Rmd" class="external-link"><code>vignettes/covid_mcmc.Rmd</code></a></small>
      <div class="d-none name"><code>covid_mcmc.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="modelling-covid-19-infection-across-england">Modelling COVID-19 infection across England<a class="anchor" aria-label="anchor" href="#modelling-covid-19-infection-across-england"></a>
</h2>
<p>In this tutorial we’ll cover some work on fitting a purely spatial
Bayesian model to predict the COVID-19 infection rate across
England.</p>
</div>
<div class="section level2">
<h2 id="study-aim-and-data-description">Study aim and data description<a class="anchor" aria-label="anchor" href="#study-aim-and-data-description"></a>
</h2>
<p>This study describes how to fit a purely spatial Bayesian
hierarchical model (BHM) based on Markov Chain Monte Carlo (MCMC)
simulation method to estimate the spatial pattern of COVID-19 infection
rate in England. The first thing is to load all the packages used in the
COVID-19 case study.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">INLA</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.inlabru.org" class="external-link">inlabru</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="install-carbayes">Install CARBayes<a class="anchor" aria-label="anchor" href="#install-carbayes"></a>
</h3>
<p>This tutorial requires the <a href="https://cran.r-project.org/web/packages/CARBayes/index.html" class="external-link">CARBayes
package</a>, please install it before continuing through the
tutorial.</p>
<div class="section level4">
<h4 id="retrieving-data">Retrieving data<a class="anchor" aria-label="anchor" href="#retrieving-data"></a>
</h4>
<p>The study region is mainland England, which is partitioned into 6789
neighbourhoods at the Middle Layer Super Output Area (MSOA) scale. The
infections data are the total reported number of COVID-19 cases in each
MSOA from Jan 8, 2022 to March 26, 2022. The shapefile of the study
region is a <code>SpatialPolygonsDataFrame</code>, which is used to map
the data. It stores the location, shape and attributes of geographic
features for the neighbourhoods. We’ll use
<code>retrieve_tutorial_data</code> to first retrieve the dataset for
this tutorial.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">fdmr</span><span class="fu">::</span><span class="fu"><a href="../reference/retrieve_tutorial_data.html">retrieve_tutorial_data</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="st">"covid_mcmc"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Tutorial data extracted to  /home/runner/fdmr/tutorial_data/covid_mcmc</span></span></code></pre>
<p>The COVID-19 data and the related covariate information are included
in our tutorial data package. We’ll load in the data using the
<code>load_tutorial_data</code> function.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s_covid</span> <span class="op">&lt;-</span> <span class="fu">fdmr</span><span class="fu">::</span><span class="fu"><a href="../reference/load_tutorial_data.html">load_tutorial_data</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="st">"covid_mcmc"</span>, filename <span class="op">=</span> <span class="st">"s_covid.rds"</span><span class="op">)</span></span></code></pre></div>
<p>Next we’ll use the <code>load_tutorial_data</code> function to load
in the spatial data we want.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sp_data</span> <span class="op">&lt;-</span> <span class="fu">fdmr</span><span class="fu">::</span><span class="fu"><a href="../reference/load_tutorial_data.html">load_tutorial_data</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="st">"covid_mcmc"</span>, filename <span class="op">=</span> <span class="st">"spatial_data.rds"</span><span class="op">)</span></span></code></pre></div>
<p>In this study, we use the areal unit modelling approach to fit the
BHM and then make model inference using MCMC method. To do this, we need
to construct a non-negative symmetric <span class="math inline">\(n
\times n\)</span> neighbourhood or adjacency matrix <span class="math inline">\(\boldsymbol{W}\)</span> that accounts for the
spatio-temporal autocorrelation structure, where <span class="math inline">\(n=6789\)</span> is the number of areal units. The
neighbourhood matrix specifies the spatial closeness between pairs of
areal units. The elements <span class="math inline">\(\{w_{ij}\}\)</span> in <span class="math inline">\(\boldsymbol{W}\)</span> can be either continuous
or binary, and a larger value of <span class="math inline">\(w_{ij}\)</span> represents that MSOAs <span class="math inline">\((i,j)\)</span> are spatially closer to each other.
Here we use the border sharing specification, so that <span class="math inline">\(w_{ij}=1\)</span> if MSOAs <span class="math inline">\((i,j)\)</span> share a common geographical border,
and <span class="math inline">\(w_{ij}=0\)</span> otherwise.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">W_nb</span> <span class="op">&lt;-</span> <span class="fu">spdep</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/poly2nb.html" class="external-link">poly2nb</a></span><span class="op">(</span><span class="va">sp_data</span>, row.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">sp_data</span><span class="op">@</span><span class="va">data</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">w</span> <span class="op">&lt;-</span> <span class="fu">spdep</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nb2mat.html" class="external-link">nb2mat</a></span><span class="op">(</span><span class="va">W_nb</span>, style <span class="op">=</span> <span class="st">"B"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="model-specification">Model specification<a class="anchor" aria-label="anchor" href="#model-specification"></a>
</h2>
<p>We use a Bayesian hierarchical model to predict the spatial COVID-19
infection rate at the MSOA level in England. Let <span class="math inline">\(Y_{i}\)</span> denote the total number of reported
COVID cases for neighbourhood <span class="math inline">\(i=1,\ldots,
n(=6789)\)</span> during the study period, and <span class="math inline">\(N_{i}\)</span> denote the (official) estimated
population living in MSOA <span class="math inline">\(i\)</span>. <span class="math inline">\(Y_{i}\)</span> is assumed to have a Poisson
distribution with parameters (<span class="math inline">\(N_{i}\)</span>, <span class="math inline">\(\theta_{i}\)</span>), where <span class="math inline">\(\theta_{i}\)</span> is the true unobserved
COVID-19 infection rate in MSAO <span class="math inline">\(i\)</span>.
We follow a standard path in modelling <span class="math inline">\(\theta_{i}\)</span> with a log link to the Poisson
and start with a model where the linear predictor decomposes additively
into a set of covariates and a Gaussian Markov Random Field process,
which characterises the infection of the disease after the covariate
effects have been accounted for. A general Bayesian hierarchical model
commonly specified is given by</p>
<p><span class="math display">\[\begin{align}
\nonumber  Y_{i}\vert N_{i}, \theta_{i} &amp;\sim
\text{Poisson}(N_{i}\theta_{i}),\ \  i=1,\ldots,n,\\
log(\theta_{i}
)&amp;=\boldsymbol{x_{i}^{\top}}\boldsymbol{\beta}+\phi_{i}.
\end{align}\]</span></p>
<p>The spatial random effects <span class="math inline">\(\{\phi_i\}\)</span> are included in the model to
account for any residual spatio-temporal autocorrelation after adjusting
for covariates <span class="math inline">\(\boldsymbol{x_{i}}\)</span>.
Here we utilise the spatial modelling structure “BYM”, proposed by <span class="citation">Besag, York, and Mollié (<a href="#ref-besag1991bayesian">1991</a>)</span>, to model <span class="math inline">\(\{\phi_i\}\)</span>. It is given by</p>
<p><span class="math display">\[\begin{align}
\nonumber \phi_i &amp;=\phi_i^{(1)}+\phi_i^{(2)}\\
\phi_i^{(1)}\vert\boldsymbol\phi_{-i}^{(1)}&amp;\sim \text{N}\left(
\frac{\sum_{j=1}^{n}w_{ij}\phi_j^{(1)}}{\sum_{j=1}^{n}w_{ij}},
\frac{\tau_1^2}{\sum_{j=1}^{n}w_{ij}}\right)\\
\nonumber \phi_i^{(2)}&amp;\sim \text{N}(0, \tau_2^2),
\end{align}\]</span></p>
<p>where <span class="math inline">\(\phi_i\)</span> now consists of two
components. <span class="math inline">\(\phi_i^{(1)}\)</span> is
assigned the intrinsic CAR prior (Besag et al., 1991), and <span class="math inline">\(\phi_i^{(2)}\)</span> is a set of independent and
identically normally distributed random effects, with mean zero and
common variance <span class="math inline">\(\tau_2^2\)</span>.</p>
</div>
<div class="section level2">
<h2 id="define-the-model-formula">Define the model formula<a class="anchor" aria-label="anchor" href="#define-the-model-formula"></a>
</h2>
<p>In order to fit the spatial model, a model formula needs to be
defined, by including the response in the left-hand side and the fixed
and random effects in the right-hand side. First, we consider the
scenario of including no covariates.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">form</span> <span class="op">&lt;-</span> <span class="va">total.cases</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/offset.html" class="external-link">offset</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">population</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="fit-the-model">Fit the model<a class="anchor" aria-label="anchor" href="#fit-the-model"></a>
</h2>
<p>Finally, we fit the spatial model using the function
<code>S.CARbym()</code> of the package <code>CARBayes</code> developed
by <span class="citation">Lee (<a href="#ref-lee2013carbayes">2013</a>)</span>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">MCMC_model</span> <span class="op">&lt;-</span> <span class="fu">CARBayes</span><span class="fu">::</span><span class="fu">S.CARbym</span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">form</span>,</span>
<span>  data <span class="op">=</span> <span class="va">s_covid</span>,</span>
<span>  family <span class="op">=</span> <span class="st">"poisson"</span>,</span>
<span>  W <span class="op">=</span> <span class="va">w</span>,</span>
<span>  burnin <span class="op">=</span> <span class="fl">10000</span>,</span>
<span>  n.sample <span class="op">=</span> <span class="fl">30000</span>,</span>
<span>  thin <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">F</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in loadNamespace(x): there is no package called 'CARBayes'</span></span></code></pre>
<p>For comparison purpose, we fit a separate BHM to the same dataset
using the INLA approach. Likewise, it uses the BYM to model the spatial
random effects.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s_covid</span><span class="op">$</span><span class="va">ID</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">s_covid</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">formula</span> <span class="op">&lt;-</span> <span class="va">total.cases</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/f.html" class="external-link">f</a></span><span class="op">(</span><span class="va">ID</span>,</span>
<span>  model <span class="op">=</span> <span class="st">"bym"</span>,</span>
<span>  graph <span class="op">=</span> <span class="va">w</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">INLA_model</span> <span class="op">&lt;-</span> <span class="fu">INLA</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.html" class="external-link">inla</a></span><span class="op">(</span><span class="va">formula</span>,</span>
<span>  data <span class="op">=</span> <span class="va">s_covid</span>,</span>
<span>  family <span class="op">=</span> <span class="st">"poisson"</span>,</span>
<span>  E <span class="op">=</span> <span class="va">s_covid</span><span class="op">$</span><span class="va">population</span>,</span>
<span>  control.compute <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    dic <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    waic <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    cpo <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Finally, we fit a BHM to the same dataset using the INLA-SPDE
approach.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">initial_range</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">sp_data</span><span class="op">@</span><span class="va">data</span><span class="op">[</span>, <span class="st">"LONG"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fl">5</span></span>
<span><span class="va">max_edge</span> <span class="op">&lt;-</span> <span class="va">initial_range</span> <span class="op">/</span> <span class="fl">8</span></span>
<span></span>
<span><span class="va">mesh</span> <span class="op">&lt;-</span> <span class="fu">fmesher</span><span class="fu">::</span><span class="fu"><a href="https://inlabru-org.github.io/fmesher/reference/fm_mesh_2d.html" class="external-link">fm_mesh_2d_inla</a></span><span class="op">(</span></span>
<span>  loc <span class="op">=</span> <span class="va">sp_data</span><span class="op">@</span><span class="va">data</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"LONG"</span>, <span class="st">"LAT"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  max.edge <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span> <span class="op">*</span> <span class="va">max_edge</span>,</span>
<span>  offset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">initial_range</span> <span class="op">/</span> <span class="fl">4</span>, <span class="va">initial_range</span><span class="op">)</span>,</span>
<span>  cutoff <span class="op">=</span> <span class="va">max_edge</span> <span class="op">/</span> <span class="fl">7</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">prior_range</span> <span class="op">&lt;-</span> <span class="va">initial_range</span></span>
<span><span class="va">spde</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.spde2.pcmatern.html" class="external-link">inla.spde2.pcmatern</a></span><span class="op">(</span></span>
<span>  mesh <span class="op">=</span> <span class="va">mesh</span>,</span>
<span>  prior.range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">prior_range</span>, <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>  prior.sigma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.01</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">s_covid_cp</span> <span class="op">&lt;-</span> <span class="va">s_covid</span></span>
<span><span class="fu">sp</span><span class="fu">::</span><span class="fu"><a href="https://edzer.github.io/sp/reference/coordinates.html" class="external-link">coordinates</a></span><span class="op">(</span><span class="va">s_covid_cp</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"LONG"</span>, <span class="st">"LAT"</span><span class="op">)</span></span>
<span><span class="va">cmp</span> <span class="op">&lt;-</span> <span class="va">total.cases</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="fu">Intercept</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/f.html" class="external-link">f</a></span><span class="op">(</span>main <span class="op">=</span> <span class="va">coordinates</span>, model <span class="op">=</span> <span class="va">spde</span><span class="op">)</span></span>
<span></span>
<span><span class="va">inlabru_model</span> <span class="op">&lt;-</span> <span class="fu">inlabru</span><span class="fu">::</span><span class="fu"><a href="https://inlabru-org.github.io/inlabru/reference/bru.html" class="external-link">bru</a></span><span class="op">(</span><span class="va">cmp</span>,</span>
<span>  data <span class="op">=</span> <span class="va">s_covid_cp</span>,</span>
<span>  family <span class="op">=</span> <span class="st">"poisson"</span>,</span>
<span>  E <span class="op">=</span> <span class="va">s_covid_cp</span><span class="op">$</span><span class="va">population</span>,</span>
<span>  control.family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"log"</span><span class="op">)</span>,</span>
<span>  options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="model-comparison">Model comparison<a class="anchor" aria-label="anchor" href="#model-comparison"></a>
</h2>
<p>In terms of model selection criteria, we show the different values
for each model based on DIC and WAIC. The model fitted using the
INLA-SPDE approach performs better than the other two models in terms of
the lowest DIC and WAIC values.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">modfit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  DIC <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">MCMC_model</span><span class="op">$</span><span class="va">modelfit</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">INLA_model</span><span class="op">$</span><span class="va">dic</span><span class="op">$</span><span class="va">dic</span>, <span class="va">inlabru_model</span><span class="op">$</span><span class="va">dic</span><span class="op">$</span><span class="va">dic</span><span class="op">)</span>,</span>
<span>  WAIC <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">MCMC_model</span><span class="op">$</span><span class="va">modelfit</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">INLA_model</span><span class="op">$</span><span class="va">waic</span><span class="op">$</span><span class="va">waic</span>, <span class="va">inlabru_model</span><span class="op">$</span><span class="va">waic</span><span class="op">$</span><span class="va">waic</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in eval(expr, envir, enclos): object 'MCMC_model' not found</span></span></code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">modfit</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MCMC"</span>, <span class="st">"INLA_BYM"</span>, <span class="st">"INLA_SPDE"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error: object 'modfit' not found</span></span></code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">modfit</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in eval(expr, envir, enclos): object 'modfit' not found</span></span></code></pre>
<p>We compare the posterior COVID-19 infection rate estimates between
the models. In general, all models provide similar posterior COVID-19
infection rate estimates.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mcmc_fitted_prev</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">MCMC_model</span><span class="op">$</span><span class="va">samples</span><span class="op">$</span><span class="va">beta</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">MCMC_model</span><span class="op">$</span><span class="va">samples</span><span class="op">$</span><span class="va">psi</span>, <span class="fl">2</span>, <span class="va">mean</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in h(simpleError(msg, call)): error in evaluating the argument 'x' in selecting a method for function 'mean': object 'MCMC_model' not found</span></span></code></pre>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mcmc_lc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">MCMC_model</span><span class="op">$</span><span class="va">samples</span><span class="op">$</span><span class="va">beta</span>, <span class="fl">0.025</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">MCMC_model</span><span class="op">$</span><span class="va">samples</span><span class="op">$</span><span class="va">psi</span>, <span class="fl">2</span>, <span class="va">quantile</span>, <span class="fl">0.025</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in eval(expr, envir, enclos): object 'MCMC_model' not found</span></span></code></pre>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mcmc_uc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">MCMC_model</span><span class="op">$</span><span class="va">samples</span><span class="op">$</span><span class="va">beta</span>, <span class="fl">0.975</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">MCMC_model</span><span class="op">$</span><span class="va">samples</span><span class="op">$</span><span class="va">psi</span>, <span class="fl">2</span>, <span class="va">quantile</span>, <span class="fl">0.975</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in eval(expr, envir, enclos): object 'MCMC_model' not found</span></span></code></pre>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">comb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  <span class="st">"INLA_BYM"</span> <span class="op">=</span> <span class="va">INLA_model</span><span class="op">$</span><span class="va">summary.fitted.values</span><span class="op">$</span><span class="va">mean</span>,</span>
<span>  <span class="st">"INLA_lc"</span> <span class="op">=</span> <span class="va">INLA_model</span><span class="op">$</span><span class="va">summary.fitted.values</span><span class="op">$</span><span class="va">`0.025quant`</span>,</span>
<span>  <span class="st">"INLA_uc"</span> <span class="op">=</span> <span class="va">INLA_model</span><span class="op">$</span><span class="va">summary.fitted.values</span><span class="op">$</span><span class="va">`0.975quant`</span>,</span>
<span>  <span class="st">"INLA_SPDE"</span> <span class="op">=</span> <span class="va">inlabru_model</span><span class="op">$</span><span class="va">summary.fitted.values</span><span class="op">$</span><span class="va">mean</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">s_covid</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  <span class="st">"INLA_SPDE_lc"</span> <span class="op">=</span> <span class="va">inlabru_model</span><span class="op">$</span><span class="va">summary.fitted.values</span><span class="op">$</span><span class="va">`0.025quant`</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">s_covid</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  <span class="st">"INLA_SPDE_uc"</span> <span class="op">=</span> <span class="va">inlabru_model</span><span class="op">$</span><span class="va">summary.fitted.values</span><span class="op">$</span><span class="va">`0.975quant`</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">s_covid</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  <span class="st">"MCMC"</span> <span class="op">=</span> <span class="va">mcmc_fitted_prev</span>,</span>
<span>  <span class="st">"MCMC_lc"</span> <span class="op">=</span> <span class="va">mcmc_lc</span>,</span>
<span>  <span class="st">"MCMC_uc"</span> <span class="op">=</span> <span class="va">mcmc_uc</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in eval(expr, envir, enclos): object 'mcmc_fitted_prev' not found</span></span></code></pre>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/pairs.html" class="external-link">pairs</a></span><span class="op">(</span><span class="va">comb</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MCMC"</span>, <span class="st">"INLA_SPDE"</span>, <span class="st">"INLA_BYM"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">19</span>, cex <span class="op">=</span> <span class="fl">0.3</span>, col <span class="op">=</span> <span class="st">"orange"</span>, lower.panel <span class="op">=</span> <span class="va">panel.smooth</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in eval(expr, envir, enclos): object 'comb' not found</span></span></code></pre>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html" class="external-link">boxplot</a></span><span class="op">(</span><span class="va">comb</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MCMC"</span>, <span class="st">"INLA_SPDE"</span>, <span class="st">"INLA_BYM"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in eval(expr, envir, enclos): object 'comb' not found</span></span></code></pre>
<p>The spatial patterns of the infection rate estimates for each model
are displayed below.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sp_data</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">est.rate.mcmc</span> <span class="op">&lt;-</span> <span class="va">mcmc_fitted_prev</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in eval(expr, envir, enclos): object 'mcmc_fitted_prev' not found</span></span></code></pre>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">domain</span> <span class="op">&lt;-</span> <span class="va">sp_data</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">est.rate.mcmc</span></span>
<span><span class="va">legend_values</span> <span class="op">&lt;-</span> <span class="va">sp_data</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">est.rate.mcmc</span></span>
<span></span>
<span><span class="fu">fdmr</span><span class="fu">::</span><span class="fu"><a href="../reference/plot_map_leaflet.html">plot_map_leaflet</a></span><span class="op">(</span></span>
<span>  polygon_data <span class="op">=</span> <span class="va">sp_data</span>,</span>
<span>  domain <span class="op">=</span> <span class="va">domain</span>,</span>
<span>  palette <span class="op">=</span> <span class="st">"Reds"</span>,</span>
<span>  legend_title <span class="op">=</span> <span class="st">"Rate"</span>,</span>
<span>  add_scale_bar <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  polygon_fill_opacity <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error: 'plot_map_leaflet' is not an exported object from 'namespace:fdmr'</span></span></code></pre>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sp_data</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">est.rate.inlabym</span> <span class="op">&lt;-</span> <span class="va">INLA_model</span><span class="op">$</span><span class="va">summary.fitted.values</span><span class="op">$</span><span class="va">mean</span></span>
<span></span>
<span><span class="va">domain</span> <span class="op">&lt;-</span> <span class="va">sp_data</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">est.rate.inlabym</span></span>
<span><span class="va">legend_values</span> <span class="op">&lt;-</span> <span class="va">sp_data</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">est.rate.inlabym</span></span>
<span></span>
<span><span class="fu">fdmr</span><span class="fu">::</span><span class="fu"><a href="../reference/plot_map_leaflet.html">plot_map_leaflet</a></span><span class="op">(</span></span>
<span>  polygon_data <span class="op">=</span> <span class="va">sp_data</span>,</span>
<span>  domain <span class="op">=</span> <span class="va">domain</span>,</span>
<span>  palette <span class="op">=</span> <span class="st">"Reds"</span>,</span>
<span>  legend_title <span class="op">=</span> <span class="st">"Rate"</span>,</span>
<span>  add_scale_bar <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  polygon_fill_opacity <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error: 'plot_map_leaflet' is not an exported object from 'namespace:fdmr'</span></span></code></pre>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sp_data</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">est.rate.inlaspde</span> <span class="op">&lt;-</span> <span class="va">inlabru_model</span><span class="op">$</span><span class="va">summary.fitted.values</span><span class="op">$</span><span class="va">mean</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">s_covid</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">domain</span> <span class="op">&lt;-</span> <span class="va">sp_data</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">est.rate.inlaspde</span></span>
<span><span class="va">legend_values</span> <span class="op">&lt;-</span> <span class="va">sp_data</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">est.rate.inlaspde</span></span>
<span></span>
<span><span class="fu">fdmr</span><span class="fu">::</span><span class="fu"><a href="../reference/plot_map_leaflet.html">plot_map_leaflet</a></span><span class="op">(</span></span>
<span>  polygon_data <span class="op">=</span> <span class="va">sp_data</span>,</span>
<span>  domain <span class="op">=</span> <span class="va">domain</span>,</span>
<span>  palette <span class="op">=</span> <span class="st">"Reds"</span>,</span>
<span>  legend_title <span class="op">=</span> <span class="st">"Rate"</span>,</span>
<span>  add_scale_bar <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  polygon_fill_opacity <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error: 'plot_map_leaflet' is not an exported object from 'namespace:fdmr'</span></span></code></pre>
<p>Now we consider the scenario of fitting the models with covariates of
interest. We select several risk factors used in the <a href="https://4dmodeller.github.io/fdmr/articles/covid.html">COVID-19
tutorial</a>. The models described above are fitted and compared again
after incorporating covariate information. First we fit the BHM using
MCMC method.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">form</span> <span class="op">&lt;-</span> <span class="va">total.cases</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/offset.html" class="external-link">offset</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">population</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">IMD</span> <span class="op">+</span> <span class="va">perc.wb</span> <span class="op">+</span> <span class="va">perc.ba</span> <span class="op">+</span> <span class="va">age1</span> <span class="op">+</span> <span class="va">pm25</span></span>
<span></span>
<span><span class="va">MCMC_model2</span> <span class="op">&lt;-</span> <span class="fu">CARBayes</span><span class="fu">::</span><span class="fu">S.CARbym</span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">form</span>,</span>
<span>  data <span class="op">=</span> <span class="va">s_covid</span>,</span>
<span>  family <span class="op">=</span> <span class="st">"poisson"</span>,</span>
<span>  W <span class="op">=</span> <span class="va">w</span>,</span>
<span>  burnin <span class="op">=</span> <span class="fl">10000</span>,</span>
<span>  n.sample <span class="op">=</span> <span class="fl">30000</span>,</span>
<span>  thin <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">F</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in loadNamespace(x): there is no package called 'CARBayes'</span></span></code></pre>
<p>Next we fit the BHM using the INLA-BYM approach.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">formula</span> <span class="op">&lt;-</span> <span class="va">total.cases</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/f.html" class="external-link">f</a></span><span class="op">(</span><span class="va">ID</span>,</span>
<span>  model <span class="op">=</span> <span class="st">"bym"</span>,</span>
<span>  graph <span class="op">=</span> <span class="va">w</span></span>
<span><span class="op">)</span> <span class="op">+</span> <span class="va">IMD</span> <span class="op">+</span> <span class="va">perc.wb</span> <span class="op">+</span> <span class="va">perc.ba</span> <span class="op">+</span> <span class="va">age1</span> <span class="op">+</span> <span class="va">pm25</span></span>
<span></span>
<span><span class="va">INLA_model2</span> <span class="op">&lt;-</span> <span class="fu">INLA</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.html" class="external-link">inla</a></span><span class="op">(</span><span class="va">formula</span>,</span>
<span>  data <span class="op">=</span> <span class="va">s_covid</span>,</span>
<span>  family <span class="op">=</span> <span class="st">"poisson"</span>,</span>
<span>  E <span class="op">=</span> <span class="va">s_covid</span><span class="op">$</span><span class="va">population</span>,</span>
<span>  control.compute <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    dic <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    waic <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    cpo <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Next we fit the BHM using the INLA-SPDE approach.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cmp</span> <span class="op">&lt;-</span> <span class="va">total.cases</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="fu">Intercept</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/f.html" class="external-link">f</a></span><span class="op">(</span>main <span class="op">=</span> <span class="va">coordinates</span>, model <span class="op">=</span> <span class="va">spde</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">IMD</span> <span class="op">+</span> <span class="va">perc.wb</span> <span class="op">+</span> <span class="va">perc.ba</span> <span class="op">+</span> <span class="va">age1</span> <span class="op">+</span> <span class="va">pm25</span></span>
<span></span>
<span><span class="va">inlabru_model2</span> <span class="op">&lt;-</span> <span class="fu">inlabru</span><span class="fu">::</span><span class="fu"><a href="https://inlabru-org.github.io/inlabru/reference/bru.html" class="external-link">bru</a></span><span class="op">(</span><span class="va">cmp</span>,</span>
<span>  data <span class="op">=</span> <span class="va">s_covid_cp</span>,</span>
<span>  family <span class="op">=</span> <span class="st">"poisson"</span>,</span>
<span>  E <span class="op">=</span> <span class="va">s_covid_cp</span><span class="op">$</span><span class="va">population</span>,</span>
<span>  control.family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"log"</span><span class="op">)</span>,</span>
<span>  options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The regression coefficients of the selected covariates for all models
are compared. In general, the models have similar regression
coefficients estimates.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">regr_est</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind.data.frame</a></span><span class="op">(</span></span>
<span>  <span class="st">"MCMC"</span> <span class="op">=</span> <span class="va">MCMC_model2</span><span class="op">$</span><span class="va">summary.results</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">MCMC_model2</span><span class="op">$</span><span class="va">summary.results</span><span class="op">)</span> <span class="op">-</span> <span class="fl">2</span><span class="op">)</span>, <span class="fl">1</span><span class="op">]</span>,</span>
<span>  <span class="st">"INLA_BYM"</span> <span class="op">=</span> <span class="va">INLA_model2</span><span class="op">$</span><span class="va">summary.fixed</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>,</span>
<span>  <span class="st">"INLA_SPDE"</span> <span class="op">=</span> <span class="va">inlabru_model2</span><span class="op">$</span><span class="va">summary.fixed</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in eval(expr, envir, enclos): object 'MCMC_model2' not found</span></span></code></pre>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">regr_est</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in eval(expr, envir, enclos): object 'regr_est' not found</span></span></code></pre>
<p>The modelling performance and results of the MCMC-BYM, INLA-BYM and
INLA-SPDE approaches can be affected by the choice of the spatial model,
the inference method and the data characteristics. MCMC-BYM and INLA-BYM
use different inference methods, with the latter being faster. In the
MCMC-BYM approach, spatial correlation structure is captured by a <span class="math inline">\(n\times n\)</span> adjacency matrix. Specifically,
if two locations are adjacent in geography, they are spatially
correlated, leading to data smoothing between them. However, the
INLA-SPDE approach uses the Matern model, where spatial correlation
depends on the distance between two locations, rather than their
geographic adjacency. Thus, even if two locations are not geographically
adjacent, they can still exhibit correlation.</p>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-besag1991bayesian" class="csl-entry">
Besag, Julian, Jeremy York, and Annie Mollié. 1991. <span>“Bayesian
Image Restoration, with Two Applications in Spatial Statistics.”</span>
<em>Annals of the Institute of Statistical Mathematics</em> 43: 1–20.
</div>
<div id="ref-lee2013carbayes" class="csl-entry">
Lee, Duncan. 2013. <span>“CARBayes: An r Package for Bayesian Spatial
Modeling with Conditional Autoregressive Priors.”</span> <em>Journal of
Statistical Software</em> 55 (13): 1–24.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/gareth-j/" class="external-link">Gareth Jones</a>, <a href="https://www.researchgate.net/profile/Xueqing_Yin" class="external-link">Xueqing Yin</a>, <a href="https://mnky9800n.github.io/" class="external-link">John Aiken</a>, Jonathan Bamber.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
