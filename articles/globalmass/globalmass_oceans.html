<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="fdmr">
<title>GlobalMass - Oceans • fdmr</title>
<script src="../../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../../pkgdown.js"></script><meta property="og:title" content="GlobalMass - Oceans">
<meta property="og:description" content="fdmr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../../index.html">fdmr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../../articles/FourDModelleR.html">Getting started</a>
    <a class="dropdown-item" href="../../articles/covid.html">COVID-19</a>
    <a class="dropdown-item" href="../../articles/globalmass/globalmass_oceans.html">GlobalMass - Oceans</a>
    <a class="dropdown-item" href="../../articles/hydro.html">Hydrology</a>
    <a class="dropdown-item" href="../../articles/slidertest.html">UNKNOWN TITLE</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/GlobalMass/processing/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>GlobalMass - Oceans</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/GlobalMass/processing/blob/HEAD/vignettes/globalmass/globalmass_oceans.Rmd" class="external-link"><code>vignettes/globalmass/globalmass_oceans.Rmd</code></a></small>
      <div class="d-none name"><code>globalmass_oceans.Rmd</code></div>
    </div>

    
    
<blockquote>
<p><strong><em>NOTE:</em></strong> This vignette is a work in progress
and some of the functionality shown below may not yet exist.</p>
</blockquote>
<p>You can run through this tutorial using an interactive R session or
an R Notebook. Please note this tutorial has been written expecting it
to be run on a Linux or macOS machine, it is untested on Windows.</p>
<div class="section level2">
<h2 id="getting-setup">Getting setup<a class="anchor" aria-label="anchor" href="#getting-setup"></a>
</h2>
<p>Let’s create a folder to store all the data created by the tutorial.
You can create this folder anywhere but here we make create a folder
called <code>gm_ocean_tutorial</code> under a <code>4DModeller</code>
directory in our home folder. The <code>-p</code> flag we use below
tells <code>mkdir</code> to create both directories at the same
time.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> ~/4DModeller/gm_oceans_tutorial</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ~/4DModeller/gm_oceans_tutorial</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="retrieving-tutorial-data">Retrieving tutorial data<a class="anchor" aria-label="anchor" href="#retrieving-tutorial-data"></a>
</h2>
<p>We’ll first start by making sure we have the data files required.
First visit the link you received and download the <code>.tar.bz2</code>
file using your web browser. We can easily download the file using
<code>wget</code></p>
<blockquote>
<p><strong><em>NOTE:</em></strong> This step will be made much simpler
for the user once we’ve got somewhere to store the data.</p>
</blockquote>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wget</span> <span class="op">&lt;</span>url-given<span class="op">&gt;</span></span></code></pre></div>
<p>The next step is to unpack the tutorial data. We provide a helper
function to unpack this data to a location FourDModelleR can easily
access. First import <code>FourDModelleR</code> and then call the
<code>retrieve_tutorial_data</code> function, passing the path to the
file you downloaded, here
<code>~/4DModeller/gm_oceans/tutorial_data.tar.bz2</code></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">FourDModelleR</span><span class="op">)</span></span>
<span><span class="va">tarball_path</span> <span class="op">&lt;-</span> <span class="st">"~/4DModeller/gm_oceans_tutorial/tutorial_data.tar.bz2"</span></span>
<span><span class="fu">FourDModelleR</span><span class="fu">::</span><span class="fu">retrieve_tutorial_data</span><span class="op">(</span>tarball_path <span class="op">=</span> <span class="va">tarball_path</span><span class="op">)</span></span></code></pre></div>
<p>The tutorial data has now been extracted to
<code>~/4DModeller/tutorial_data</code>. We can now move on to
processing some of the data to run the BHM.</p>
</div>
<div class="section level2">
<h2 id="creating-meshes">Creating meshes<a class="anchor" aria-label="anchor" href="#creating-meshes"></a>
</h2>
<p>To create the ocean mesh the <code>create_ocean_mesh</code> will look
for multiple shapefiles within a folder so we’ll just give it the path
of the <code>shapefiles</code> folder. We also need to tell the function
where to output the processed data, this can be any folder but here we
select the <code>gm_oceans_tutorial</code> folder we created earler.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">shapefile_folder</span> <span class="op">&lt;-</span> <span class="st">"~/4DModeller/tutorial_data/bhm_ocean/shapefiles"</span></span>
<span><span class="va">output_folder</span> <span class="op">&lt;-</span> <span class="st">"~/4DModeller/gm_oceans_tutorial/output_data"</span></span>
<span></span>
<span><span class="va">mesh_paths</span> <span class="op">&lt;-</span> <span class="fu">FourDModelleR</span><span class="fu">::</span><span class="fu">create_ocean_mesh</span><span class="op">(</span>shapefile_folder <span class="op">=</span> <span class="va">shapefile_folder</span>, output_folder <span class="op">=</span> <span class="va">output_folder</span><span class="op">)</span></span></code></pre></div>
<p>If we take a look at <code>mesh_paths</code> you’ll notice we get two
filepaths, one for the mesh and another for the mesh triangles file.
We’ll only use the mesh itself in this tutorial, so we take the first
element from the returned list and assign it to a variable for use
later.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mesh_paths</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ocean_mesh_filepath</span> <span class="op">&lt;-</span> <span class="va">mesh_paths</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span></code></pre></div>
<p>Now we’ve created our ocean mesh we’re ready to move on to creating
the data required by the BHM.</p>
</div>
<div class="section level2">
<h2 id="preprocessing-data">Preprocessing data<a class="anchor" aria-label="anchor" href="#preprocessing-data"></a>
</h2>
<div class="section level3">
<h3 id="argo">Argo<a class="anchor" aria-label="anchor" href="#argo"></a>
</h3>
<p>The data we need to run the BHM over glaciers and ice caps is stored
in the file
<code>Argo_MassSpecVol_ts_CMEMS_vector_Downsampled_2000m_2002_2020_flagvalid_dimrename.nc</code>.
This was one of the files unpacked by
<code>retrieve_tutorial_data</code> above and we can get the path to it
using <code>get_tutorial_datapath</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">argo_data_filepath</span> <span class="op">&lt;-</span> <span class="fu">FourDModelleR</span><span class="fu">::</span><span class="fu">get_tutorial_datapath</span><span class="op">(</span>filename <span class="op">=</span> <span class="st">"Argo_MassSpecVol_ts_CMEMS_vector_Downsampled_2000m_2002_2020_flagvalid_dimrename.nc"</span><span class="op">)</span></span></code></pre></div>
<p>Next we’ll use <code>process_ocean_argo</code> to process the data
into a format the BHM expects.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">processed_argo_filepath</span> <span class="op">&lt;-</span> <span class="fu">FourDModelleR</span><span class="fu">::</span><span class="fu">process_ocean_argo</span><span class="op">(</span>input_filepath <span class="op">=</span> <span class="va">argo_data_filepath</span>, output_folder <span class="op">=</span> <span class="va">output_folder</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="altimetry">Altimetry<a class="anchor" aria-label="anchor" href="#altimetry"></a>
</h3>
<p>Next we process the altimetry data using
<code>process_altimetry_proc_gmgia</code>. This function requires the
file
<code>Alt_ts_CMEMS_ArcticDTU_GMGIA_MeasErr_Filtered_vector_2005_2015.nc</code>
from the tutorial data pack we downloaded earlier. We get the path using
<code>get_tutorial_datapath</code> as above and then pass in this path
and <code>output_folder</code> to the processing function.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">alt_data_filepath</span> <span class="op">&lt;-</span> <span class="fu">FourDModelleR</span><span class="fu">::</span><span class="fu">get_tutorial_datapath</span><span class="op">(</span>filename <span class="op">=</span> <span class="st">"Alt_ts_CMEMS_ArcticDTU_GMGIA_MeasErr_Filtered_vector_2005_2015_dimrename.nc"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">processed_alt_filepath</span> <span class="op">&lt;-</span> <span class="fu">FourDModelleR</span><span class="fu">::</span><span class="fu">process_altimetry_proc_gmgia</span><span class="op">(</span>input_filepath <span class="op">=</span> <span class="va">alt_data_filepath</span>, output_folder <span class="op">=</span> <span class="va">output_folder</span><span class="op">)</span></span>
<span></span>
<span><span class="va">processed_alt_filepath</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="grace-data">GRACE data<a class="anchor" aria-label="anchor" href="#grace-data"></a>
</h3>
<p>We also need some GRACE data to pass to the BHM, this requires no
preprocessing so we just retrieve its filepath.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">grace_jpl_filepath</span> <span class="op">&lt;-</span> <span class="fu">FourDModelleR</span><span class="fu">::</span><span class="fu">get_tutorial_datapath</span><span class="op">(</span>filename <span class="op">=</span> <span class="st">"EWH_JPL_grace_global_GMGIA_to2015.RData"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">grace_jpl_filepath</span></span></code></pre></div>
<p>We now have all the components we need to pass to the BHM.</p>
<ol style="list-style-type: decimal">
<li>Ocean mesh</li>
<li>Processed Argo data</li>
<li>Processed altimetry data</li>
<li>GRACE JPL data</li>
</ol>
</div>
</div>
<div class="section level2">
<h2 id="running-the-bhm">Running the BHM<a class="anchor" aria-label="anchor" href="#running-the-bhm"></a>
</h2>
<blockquote>
<p><strong><em>NOTE:</em></strong> how best to present this, too much
filepath handling?</p>
</blockquote>
<p>To run the BHM we’ll use the <code>run_bhm_ocean</code> function and
pass in the data we’ve just created and the path to an output folder. We
also need to tell the function whether we’re using JPL or GSFC data,
here we’re using JPL.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_output</span> <span class="op">&lt;-</span> <span class="fu">FourDModelleR</span><span class="fu">::</span><span class="fu">run_bhm_ocean</span><span class="op">(</span></span>
<span>  mesh_filepath <span class="op">=</span> <span class="va">ocean_mesh_filepath</span>,</span>
<span>  grace_data_filepath <span class="op">=</span> <span class="va">grace_jpl_filepath</span>,</span>
<span>  altimetry_filepath <span class="op">=</span> <span class="va">processed_alt_filepath</span>,</span>
<span>  argo_data_fileapth <span class="op">=</span> <span class="va">processed_argo_filepath</span>,</span>
<span>  output_folder <span class="op">=</span> <span class="va">output_folder</span>,</span>
<span>  GRACE_dc <span class="op">=</span> <span class="st">"JPL"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The model will output to screen as it’s running and when completed
will output a summary of the model parameters. This output will also be
written to your specified output folder with a filename that looks like
<code>FourDModelleR_bhm_ocean_run_{timestamp}.log</code>.</p>
</div>
<div class="section level2">
<h2 id="analysing-the-model-output">Analysing the model output<a class="anchor" aria-label="anchor" href="#analysing-the-model-output"></a>
</h2>
<p>To analyse the model output you can use our
<code>FourDModelleR::create_report_*</code> functions…</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Gareth Jones, Sam Royston, Xueqing Yin, John Aiken, Jonathan Bamber.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
